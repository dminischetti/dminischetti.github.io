{{- $defaultTheme := site.Params.defaultTheme | default "auto" -}}
{{- $disableThemeToggle := site.Params.disableThemeToggle | default false -}}
{{- $isAuto := and (ne $defaultTheme "light") (ne $defaultTheme "dark") -}}

{{- if or (not $disableThemeToggle) $isAuto }}
<script>
(function () {
  const body = document.body;
  if (!body) return;

  const storageKey = "pref-theme";
  const themeMeta = document.querySelector('meta[name="theme-color"]');
  const updateMeta = (isDark) => {
    if (!themeMeta) return;
    themeMeta.setAttribute("content", isDark ? "#0f172a" : "#ffffff");
  };
  const applyTheme = (isDark) => {
    body.classList.toggle("dark", Boolean(isDark));
    updateMeta(Boolean(isDark));
  };

  const stored = localStorage.getItem(storageKey);

  {{- if eq $defaultTheme "light" }}
  applyTheme(stored === "dark");
  {{- else if eq $defaultTheme "dark" }}
  applyTheme(!(stored === "light"));
  {{- else }}
  if (stored === "dark") {
    applyTheme(true);
  } else if (stored === "light") {
    applyTheme(false);
  } else if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
    applyTheme(true);
  } else {
    applyTheme(false);
  }
  {{- end }}

  if (window.matchMedia) {
    const media = window.matchMedia('(prefers-color-scheme: dark)');
    media.addEventListener('change', (event) => {
      const pref = localStorage.getItem(storageKey);
      if (!pref) {
        applyTheme(event.matches);
      } else {
        updateMeta(event.matches);
      }
    });
  }

  const btn = document.getElementById("theme-toggle");
  if (btn) {
    btn.addEventListener("click", () => {
      window.setTimeout(() => {
        const isDark = body.classList.contains("dark");
        updateMeta(isDark);
        if (navigator.vibrate) navigator.vibrate(10);
      }, 0);
    });
  }
})();
</script>
{{- end }}

<header class="header" role="banner">
  <div class="header-inner">
    <div class="header-content">
      <!-- Logo -->
      <a href="/" class="logo" aria-label="Torna alla Homepage">
        <span class="logo-icon">DM</span>
        <span class="logo-text">Dominic Minischetti</span>
      </a>

      <!-- Back to Blog (solo nelle pagine articolo) -->
      {{ if .IsPage }}
      <a href="/blog" class="back-link" aria-label="Torna al Blog">
        <svg class="back-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M19 12H5M12 19l-7-7 7-7"/>
        </svg>
        <span>Blog</span>
      </a>
      {{ end }}
    </div>
  </div>

  <!-- Theme Toggle Button -->
  <button id="theme-toggle" class="theme-toggle" aria-label="Toggle Theme">
    <svg class="sun-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <circle cx="12" cy="12" r="5"></circle>
      <path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"></path>
    </svg>
    <svg class="moon-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
    </svg>
  </button>
</header>

