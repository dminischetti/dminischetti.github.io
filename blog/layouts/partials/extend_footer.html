<script>
(function () {
  const header = document.querySelector('.header');
  if (!header) return;
  const setScrolled = () => {
    const isScrolled = window.scrollY > 24;
    header.classList.toggle('is-scrolled', isScrolled);
  };
  setScrolled();
  window.addEventListener('scroll', () => requestAnimationFrame(setScrolled), { passive: true });
})();

(function () {
  const elements = document.querySelectorAll('.fade-in');
  if (!('IntersectionObserver' in window) || window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
    elements.forEach((el) => el.classList.add('is-visible'));
    return;
  }
  const observer = new IntersectionObserver(
    (entries, obs) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting) {
          entry.target.classList.add('is-visible');
          obs.unobserve(entry.target);
        }
      });
    },
    { rootMargin: '0px 0px -15%', threshold: 0.15 }
  );
  elements.forEach((el) => observer.observe(el));
})();

(function () {
  const header = document.querySelector('.header');
  const links = document.querySelectorAll('a[href^="#"]');
  const prefersReduced = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
  links.forEach((link) => {
    link.addEventListener('click', (event) => {
      const targetId = link.getAttribute('href');
      if (!targetId || targetId.length < 2) return;
      const target = document.querySelector(targetId);
      if (!target) return;
      event.preventDefault();
      const headerOffset = header ? header.offsetHeight + 12 : 0;
      const top = target.getBoundingClientRect().top + window.scrollY - headerOffset;
      if (prefersReduced) {
        window.scrollTo(0, top);
      } else {
        window.scrollTo({ top, behavior: 'smooth' });
      }
      if (history.pushState) {
        history.pushState(null, '', targetId);
      }
    });
  });
})();
</script>
