{{ define "main" }}
  {{ $hero := site.Params.hero }}
  <div class="home">
    <section class="home-hero fade-in" id="top">
      <div class="section-wrapper">
        <div class="home-hero-grid">
          <div class="hero-copy">
            {{ with $hero.badge }}<span class="hero-badge">{{ . }}</span>{{ end }}
            {{ with $hero.title }}<h1 class="hero-title">{{ . | markdownify }}</h1>{{ end }}
            {{ with $hero.subtitle }}<p class="hero-subtitle">{{ . }}</p>{{ end }}
            {{ with $hero.experience }}
              <div class="hero-companies">
                {{ range . }}<span>{{ . }}</span>{{ end }}
              </div>
            {{ end }}
            <div class="hero-actions">
              {{ with $hero.primaryCTA }}
                {{ $url := .url }}
                {{ $href := cond (or (strings.HasPrefix $url "http") (strings.HasPrefix $url "mailto:") (strings.HasPrefix $url "tel:") (strings.HasPrefix $url "#")) $url ($url | relURL) }}
                <a class="primary" href="{{ $href }}">{{ .label }}</a>
              {{ end }}
              {{ with $hero.secondaryCTA }}
                {{ $url := .url }}
                {{ $href := cond (or (strings.HasPrefix $url "http") (strings.HasPrefix $url "mailto:") (strings.HasPrefix $url "tel:") (strings.HasPrefix $url "#")) $url ($url | relURL) }}
                <a class="secondary" href="{{ $href }}">{{ .label }}</a>
              {{ end }}
            </div>
          </div>
          {{ with $hero.image }}
            {{ $imageAlt := or $hero.imageAlt (printf "%s portrait" (site.Params.author | default site.Title)) }}
            <div class="hero-image-wrapper">
              <img class="hero-image" src="{{ . | relURL }}" alt="{{ $imageAlt }}" loading="eager" width="420" height="520" />
            </div>
          {{ end }}
        </div>
      </div>
    </section>

    {{ with site.Params.sections.about }}
      <section class="home-section fade-in" id="about">
        <div class="section-wrapper">
          <div class="section-header">
            <span class="section-eyebrow">About</span>
            <h2 class="section-title">{{ .title }}</h2>
            {{ with .description }}<p class="section-description">{{ . }}</p>{{ end }}
          </div>
          {{ with .body }}
            <div class="about-body">{{ . | markdownify }}</div>
          {{ end }}
        </div>
      </section>
    {{ end }}

    {{ with site.Params.sections.focus }}
      <section class="home-section fade-in" id="focus">
        <div class="section-wrapper">
          <div class="section-header">
            <span class="section-eyebrow">Focus</span>
            <h2 class="section-title">{{ .title }}</h2>
            {{ with .description }}<p class="section-description">{{ . }}</p>{{ end }}
          </div>
          {{ with .cards }}
            <div class="focus-grid">
              {{ range . }}
                <article class="focus-card fade-in">
                  <h3>{{ .title }}</h3>
                  {{ with .description }}<p>{{ . }}</p>{{ end }}
                  {{ with .topics }}
                    <ul>
                      {{ range . }}<li>{{ . }}</li>{{ end }}
                    </ul>
                  {{ end }}
                </article>
              {{ end }}
            </div>
          {{ end }}
        </div>
      </section>
    {{ end }}

    {{ $articles := site.Params.sections.articles }}
    {{ $posts := first 6 (sort (where site.RegularPages "Type" "posts") "Date" "desc") }}
    {{ if gt (len $posts) 0 }}
      <section class="home-section fade-in" id="articles">
        <div class="section-wrapper">
          <div class="section-header">
            <span class="section-eyebrow">{{ $articles.eyebrow | default "Latest writing" }}</span>
            <h2 class="section-title">{{ $articles.title | default "Recent Articles" }}</h2>
            {{ with $articles.description }}<p class="section-description">{{ . }}</p>{{ end }}
          </div>
          <div class="post-grid">
            {{ range $posts }}
              <article class="post-card fade-in">
                <a class="post-card-title" href="{{ .RelPermalink }}">{{ .Title }}</a>
                <div class="post-card-meta">
                  <span>{{ .Date | time.Format "Jan 2, 2006" }}</span>
                  {{ with .ReadingTime }}<span>{{ . }} min read</span>{{ end }}
                </div>
                {{ $summary := .Params.description | default (.Summary | default "") }}
                {{ if $summary }}<p>{{ $summary | plainify | truncate 180 }}</p>{{ end }}
                {{ with .Params.tags }}
                  <div class="post-card-tags">
                    {{ range first 4 . }}<span>{{ . }}</span>{{ end }}
                  </div>
                {{ end }}
                <a class="post-card-link" href="{{ .RelPermalink }}">Read the article →</a>
              </article>
            {{ end }}
          </div>
          {{ with $articles.moreLabel }}
            {{ $url := $articles.moreURL | default "/posts/" }}
            {{ $href := cond (or (strings.HasPrefix $url "http") (strings.HasPrefix $url "mailto:") (strings.HasPrefix $url "tel:") (strings.HasPrefix $url "#")) $url ($url | relURL) }}
            <div class="hero-actions" style="margin-top: clamp(2rem, 5vw, 3rem);">
              <a class="secondary" href="{{ $href }}">{{ . }}</a>
            </div>
          {{ end }}
        </div>
      </section>
    {{ end }}

    {{ with site.Params.sections.projects }}
      <section class="home-section fade-in" id="projects">
        <div class="section-wrapper">
          <div class="section-header">
            <span class="section-eyebrow">{{ .eyebrow | default "Case Studies" }}</span>
            <h2 class="section-title">{{ .title }}</h2>
            {{ with .description }}<p class="section-description">{{ . }}</p>{{ end }}
          </div>
          {{ with .items }}
            <div class="project-grid">
              {{ range . }}
                <article class="project-card fade-in">
                  <h3>{{ .name }}</h3>
                  {{ with .summary }}<p>{{ . }}</p>{{ end }}
                  {{ with .tags }}
                    <div class="project-tags">
                      {{ range . }}<span>{{ . }}</span>{{ end }}
                    </div>
                  {{ end }}
                  {{ with .link }}
                    {{ $url := .url }}
                    {{ $href := cond (or (strings.HasPrefix $url "http") (strings.HasPrefix $url "mailto:") (strings.HasPrefix $url "tel:") (strings.HasPrefix $url "#")) $url ($url | relURL) }}
                    <a class="project-link" href="{{ $href }}">{{ .label }} →</a>
                  {{ end }}
                </article>
              {{ end }}
            </div>
          {{ end }}
        </div>
      </section>
    {{ end }}

    {{ with site.Params.sections.contact }}
      <section class="home-section fade-in" id="contact">
        <div class="section-wrapper">
          <div class="contact-panel">
            <div class="contact-panel-content">
              <div>
                <h2>{{ .title }}</h2>
                {{ with .message }}<p>{{ . }}</p>{{ end }}
              </div>
              <div class="contact-actions">
                {{ with .primaryCTA }}
                  {{ $url := .url }}
                  {{ $href := cond (or (strings.HasPrefix $url "http") (strings.HasPrefix $url "mailto:") (strings.HasPrefix $url "tel:") (strings.HasPrefix $url "#")) $url ($url | relURL) }}
                  <a class="primary" href="{{ $href }}">{{ .label }}</a>
                {{ end }}
                {{ with .secondaryCTA }}
                  {{ $url := .url }}
                  {{ $href := cond (or (strings.HasPrefix $url "http") (strings.HasPrefix $url "mailto:") (strings.HasPrefix $url "tel:") (strings.HasPrefix $url "#")) $url ($url | relURL) }}
                  <a class="secondary" href="{{ $href }}">{{ .label }}</a>
                {{ end }}
              </div>
            </div>
          </div>
        </div>
      </section>
    {{ end }}

    {{ with .Content }}
      <section class="home-section fade-in">
        <div class="section-wrapper">
          <div class="prose-block">{{ . }}</div>
        </div>
      </section>
    {{ end }}
  </div>
{{ end }}
