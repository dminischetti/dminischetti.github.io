{{- /* Footer custom content area start */ -}}
{{- /*     Insert any custom code: web-analytics, resources, etc. */ -}}

<script>
  // Scroll 80%
  window.addEventListener('scroll', () => {
    const scrollDepth = window.scrollY / (document.body.scrollHeight - window.innerHeight);
    if (scrollDepth > 0.8 && !window.scrollTracked) {
      gtag('event', 'scroll_80_percent', {
        'event_category': 'Scroll',
        'event_label': document.title
      });
      window.scrollTracked = true;
    }
  });

  // Scroll intermedi (25%, 50%, 75%)
  let scrollLevels = [0.25, 0.5, 0.75];
  window.addEventListener('scroll', () => {
    let scroll = window.scrollY / (document.body.scrollHeight - window.innerHeight);
    scrollLevels = scrollLevels.filter(level => {
      if (scroll > level) {
        gtag('event', `scroll_${Math.round(level * 100)}_percent`, {
          'event_category': 'Scroll',
          'event_label': document.title
        });
        return false;
      }
      return true;
    });
  });

  // Utente di ritorno
  if (document.cookie.includes('_ga')) {
    gtag('event', 'returning_user', {
      'event_category': 'User',
      'event_label': 'Returning'
    });
  }

  // Click su link esterni
  document.querySelectorAll('a[href^="http"]').forEach(link => {
    if (link.hostname !== location.hostname) {
      link.addEventListener('click', () => {
        gtag('event', 'outbound_click', {
          'event_category': 'Outbound',
          'event_label': link.href
        });
      });
    }
  });

  // Tempo attivo sulla pagina (ogni 30s)
  let timeOnPage = 0;
  setInterval(() => {
    timeOnPage += 30;
    gtag('event', 'time_on_page', {
      'event_category': 'Engagement',
      'value': timeOnPage
    });
  }, 30000);
</script>

{{ if .IsPage }}
<script>
  gtag('event', 'view_post', {
    'event_category': 'Content',
    'event_label': '{{ .Title }}',
    'post_tags': '{{ delimit .Params.tags ", " }}',
    'post_categories': '{{ delimit .Params.categories ", " }}'
  });
</script>
{{ end }}

{{- /* Footer custom content area end */ -}}