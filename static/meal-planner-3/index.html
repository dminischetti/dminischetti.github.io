<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Meal Planner</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:system-ui,-apple-system,sans-serif;background:linear-gradient(135deg,#1a0f2e,#2a1f3e);color:#f0f0f0;min-height:100vh;padding-bottom:80px}
.container{max-width:600px;margin:0 auto;padding:0 16px}
.header{background:rgba(255,255,255,.1);backdrop-filter:blur(10px);padding:20px;position:sticky;top:0;z-index:100;display:flex;justify-content:space-between;align-items:center;border-bottom:1px solid rgba(255,255,255,.2)}
.header h1{font-size:24px;background:linear-gradient(135deg,#8b5cf6,#ec4899);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.week-nav{text-align:center;padding:20px;margin:20px 0;background:rgba(255,255,255,.05);border-radius:12px;font-size:18px;font-weight:700}
.day-card{background:rgba(255,255,255,.05);border:1px solid rgba(255,255,255,.2);border-radius:12px;padding:16px;margin-bottom:12px;cursor:pointer;transition:all .3s}
.day-card:hover{transform:translateY(-2px);box-shadow:0 4px 12px rgba(0,0,0,.3)}
.day-card.incomplete{border-style:dashed;opacity:.9}
.day-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
.day-title{font-size:16px;font-weight:700}
.day-date{font-size:12px;color:#aaa;margin-top:4px}
.chip{display:inline-block;padding:2px 8px;background:linear-gradient(135deg,#8b5cf6,#a855f7);border-radius:12px;font-size:11px;color:#fff;font-weight:700}
.meal-item{display:flex;gap:12px;padding:12px;margin:8px 0;background:rgba(255,255,255,.05);border-radius:8px;border:1px solid rgba(255,255,255,.1);align-items:center;cursor:pointer;transition:all .2s}
.meal-item:hover{background:rgba(255,255,255,.1);transform:translateX(4px)}
.meal-item.empty{opacity:.6}
.meal-icon{width:40px;height:40px;display:flex;align-items:center;justify-content:center;border-radius:8px;font-size:20px}
.meal-icon.lunch{background:linear-gradient(135deg,#f59e0b,#fbbf24)}
.meal-icon.dinner{background:linear-gradient(135deg,#3b82f6,#06b6d4)}
.meal-icon.breakfast{background:linear-gradient(135deg,#ec4899,#f59e0b)}
.meal-content{flex:1}
.meal-title{font-weight:700;font-size:14px}
.meal-description{font-size:12px;color:#aaa;margin-top:2px}
.btn{padding:12px 20px;border:none;border-radius:8px;cursor:pointer;font-weight:700;transition:all .2s;background:rgba(255,255,255,.1);color:#fff;border:1px solid rgba(255,255,255,.2)}
.btn:hover{transform:translateY(-1px);box-shadow:0 2px 8px rgba(0,0,0,.2)}
.btn-primary{background:linear-gradient(135deg,#8b5cf6,#a855f7);border:none}
.btn-icon{width:44px;height:44px;display:flex;align-items:center;justify-content:center;border-radius:8px;background:rgba(255,255,255,.1);border:1px solid rgba(255,255,255,.2);cursor:pointer;transition:all .2s}
.btn-icon:hover{background:rgba(255,255,255,.2)}
.type-toggle{padding:6px 12px;border-radius:20px;background:rgba(255,255,255,.1);border:1px solid rgba(255,255,255,.2);color:#aaa;font-size:12px;font-weight:700;cursor:pointer;transition:all .2s}
.type-toggle.active{color:#fff;box-shadow:0 2px 8px rgba(0,0,0,.2)}
.type-toggle.active.quick{background:linear-gradient(135deg,#a855f7,#ec4899);border:none}
.type-toggle.active.delivery{background:linear-gradient(135deg,#3b82f6,#06b6d4);border:none}
.type-toggles{display:flex;gap:8px}
.modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,.8);display:none;align-items:flex-end;z-index:1000}
.modal-overlay.show{display:flex}
.modal{width:100%;max-width:500px;margin:0 auto;background:#2a1f3e;border-radius:20px 20px 0 0;max-height:85vh;overflow:hidden}
.modal-header{padding:20px;text-align:center;border-bottom:1px solid rgba(255,255,255,.1)}
.modal-title{font-size:20px;font-weight:700}
.modal-subtitle{font-size:14px;color:#aaa;margin-top:4px}
.modal-body{max-height:60vh;overflow-y:auto;padding:0}
.modal-footer{display:flex;gap:8px;padding:12px;background:rgba(255,255,255,.05);border-top:1px solid rgba(255,255,255,.1)}
.bento-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;padding:12px}
.bento-item{padding:12px 8px;background:rgba(255,255,255,.05);border:1px solid rgba(255,255,255,.2);border-radius:12px;cursor:pointer;text-align:center;font-size:13px;transition:all .2s;display:flex;flex-direction:column;align-items:center;gap:4px;min-height:72px;position:relative}
.bento-item:hover{background:rgba(255,255,255,.1);transform:scale(1.05)}
.bento-item.selected{background:rgba(139,92,246,.2);border-color:#8b5cf6}
.bento-item.selected::before{content:'‚úì';position:absolute;top:4px;right:4px;width:20px;height:20px;background:linear-gradient(135deg,#8b5cf6,#a855f7);color:#fff;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:12px}
.bento-emoji{font-size:24px}
.controls{display:flex;gap:8px;padding:12px;align-items:center;justify-content:space-between}
.input-group{padding:12px}
.input-label{display:block;font-weight:700;margin-bottom:8px;color:#aaa;font-size:14px}
.input{width:100%;padding:12px;background:rgba(255,255,255,.05);border:1px solid rgba(255,255,255,.2);border-radius:8px;color:#fff;font-size:14px}
.input:focus{outline:0;border-color:#8b5cf6;box-shadow:0 0 0 3px rgba(139,92,246,.2)}
.store-section{margin:12px;padding:16px;background:rgba(255,255,255,.05);border:1px solid rgba(255,255,255,.2);border-radius:12px}
.store-title{font-weight:700;font-size:16px;margin-bottom:12px}
.grocery-item{display:flex;align-items:center;gap:12px;padding:12px;margin-bottom:8px;background:rgba(255,255,255,.05);border:1px solid rgba(255,255,255,.1);border-radius:8px}
.checkbox{width:24px;height:24px;background:rgba(255,255,255,.05);border:2px solid rgba(255,255,255,.3);border-radius:6px;cursor:pointer;display:flex;align-items:center;justify-content:center}
.checkbox.checked{background:linear-gradient(135deg,#10b981,#34d399);border-color:#10b981}
.checkbox.checked::after{content:'‚úì';color:#fff;font-weight:700;font-size:14px}
.grocery-item.checked .grocery-item-text{opacity:.5;text-decoration:line-through}
.toast{position:fixed;bottom:100px;left:50%;transform:translateX(-50%);padding:12px 24px;background:#2a1f3e;color:#fff;font-size:14px;font-weight:700;border-radius:20px;box-shadow:0 4px 12px rgba(0,0,0,.3);opacity:0;visibility:hidden;transition:all .3s;z-index:2000;border:1px solid rgba(255,255,255,.2)}
.toast.show{opacity:1;visibility:visible}
.week-nav-bar{position:fixed;top:50%;transform:translateY(-50%);width:40px;height:80px;display:flex;align-items:center;justify-content:center;background:rgba(255,255,255,.1);backdrop-filter:blur(10px);border:1px solid rgba(255,255,255,.2);cursor:pointer;font-size:18px;color:#aaa;z-index:90}
.week-nav-bar:hover{background:rgba(255,255,255,.2);color:#fff}
.week-nav-left{left:0;border-radius:0 12px 12px 0;border-left:none}
.week-nav-right{right:0;border-radius:12px 0 0 12px;border-right:none}
.weekend-card{margin:12px 0;padding:16px;display:flex;align-items:center;justify-content:space-between;background:rgba(255,255,255,.05);border:1px solid rgba(255,255,255,.2);border-radius:12px}
.toggle-switch{position:relative;width:48px;height:26px;background:rgba(255,255,255,.1);border:1px solid rgba(255,255,255,.2);border-radius:13px;cursor:pointer}
.toggle-switch.active{background:#8b5cf6;border-color:#8b5cf6}
.toggle-knob{position:absolute;top:2px;left:2px;width:22px;height:22px;background:#fff;border-radius:50%;transition:transform .3s}
.toggle-switch.active .toggle-knob{transform:translateX(22px)}
.bottom-bar{position:fixed;bottom:0;left:0;right:0;background:rgba(255,255,255,.1);backdrop-filter:blur(10px);border-top:1px solid rgba(255,255,255,.2);z-index:101}
.bottom-actions{display:grid;grid-template-columns:repeat(4,1fr);gap:4px;padding:8px;max-width:700px;margin:0 auto}
.bar-btn{display:flex;flex-direction:column;align-items:center;gap:4px;padding:8px;background:rgba(255,255,255,.05);border:1px solid rgba(255,255,255,.2);border-radius:8px;color:#aaa;font-size:11px;font-weight:700;cursor:pointer;transition:all .2s}
.bar-btn:hover{background:rgba(255,255,255,.1);transform:translateY(-1px)}
.bar-ico{font-size:18px}
body.light{background:linear-gradient(135deg,#f3f4f6,#e5e7eb);color:#1f2937}
body.light .header,body.light .week-nav,body.light .day-card,body.light .meal-item,body.light .btn,body.light .btn-icon,body.light .type-toggle,body.light .modal,body.light .bento-item,body.light .input,body.light .store-section,body.light .grocery-item,body.light .weekend-card,body.light .bottom-bar,body.light .bar-btn,body.light .week-nav-bar{background:rgba(0,0,0,.05);border-color:rgba(0,0,0,.1);color:#1f2937}
body.light .modal{background:#fff}
body.light .toast{background:#fff;color:#1f2937;border-color:rgba(0,0,0,.1)}
body.light .day-date,body.light .meal-description,body.light .modal-subtitle,body.light .input-label,body.light .type-toggle,body.light .bar-btn,body.light .week-nav-bar{color:#6b7280}
body.light .input{color:#1f2937}
body.light .checkbox{background:#fff;border-color:#d1d5db}
</style>
</head>
<body>
<header class="header">
<h1>Meal Planner</h1>
<button id="themeToggle" class="btn-icon">üåô</button>
</header>
<div class="container">
<div class="week-nav" id="weekDate">Loading...</div>
<div id="daysList"></div>
</div>
<button class="week-nav-bar week-nav-left" id="prevWeek">‚óÑ</button>
<button class="week-nav-bar week-nav-right" id="nextWeek">‚ñ∫</button>
<div class="bottom-bar">
<div class="bottom-actions">
<button class="bar-btn" id="randomizeBtn"><span class="bar-ico">üé≤</span><span>Randomize</span></button>
<button class="bar-btn" id="shoppingBtn"><span class="bar-ico">üõí</span><span>Shopping</span></button>
<button class="bar-btn" id="shareBtn"><span class="bar-ico">üì§</span><span>Share All</span></button>
<button class="bar-btn" id="clearBtn"><span class="bar-ico">üóëÔ∏è</span><span>Clear</span></button>
</div>
</div>
<div id="modalOverlay" class="modal-overlay">
<div class="modal">
<div class="modal-header">
<h2 class="modal-title" id="modalTitle"></h2>
<p class="modal-subtitle" id="modalSubtitle"></p>
</div>
<div class="modal-body" id="modalBody"></div>
<div class="modal-footer" id="modalFooter"></div>
</div>
</div>
<div id="toast" class="toast"></div>
<script>
const D={
i:{ravioli:"Ravioli,ü•ü",sage:"Sage,üåø",spaghetti:"Spaghetti,üçù",lemons:"Lemons,üçã",ditalini:"Ditalini,üçù",chickpeas:"Chickpeas,ü´ò",tuna:"Tuna,üêü",pasta:"Pasta,üçù",tomato_sauce:"Tomato sauce,üçÖ",flatbreads:"Flatbreads,ü´ì",prosciutto:"Prosciutto,ü•©",provolone_cheese:"Provolone cheese,üßÄ",eggs:"Eggs,ü•ö",pesto:"Pesto,üåø",cherry_tomatoes:"Cherry tomatoes,üçÖ",lentils:"Lentils,ü´ò",croutons:"Croutons,üçû",bacon:"Bacon,ü•ì",beans:"Beans,ü´ò",salmon:"Salmon,üç£",rice:"Rice,üçö",zucchini:"Zucchini,ü•í",ground_beef:"Ground beef,ü•©",bread:"Bread,üçû",breadcrumbs:"Breadcrumbs,üçû",chicken_breast:"Chicken breast,üçó",cod:"Cod,üêü",hamburger_buns:"Hamburger buns,üçî",american_cheese_slices:"American cheese slices,üßÄ",lettuce:"Lettuce,ü•¨",tomatoes:"Tomatoes,üçÖ",breaded_cutlets:"Breaded cutlets,ü•©",sausages:"Sausages,üå≠",vegetable_soup_mix:"Vegetable soup mix,ü•ï",chicken_thighs:"Chicken thighs,üçó",veal_cutlets:"Veal cutlets,ü•©",fresh_mozzarella:"Fresh mozzarella,üßÄ",cordon_bleu:"Cordon bleu,ü•©",hot_dogs:"Hot dogs,üå≠",dumplings:"Dumplings,ü•ü",fish_sticks:"Fish sticks,üêü",whole_chicken:"Whole chicken,üçó",shredded_mozzarella:"Shredded mozzarella,üßÄ",eggplant:"Eggplant,üçÜ",beef:"Beef,ü•©",potatoes:"Potatoes,ü•î",onion:"Onion,üßÖ",carrots:"Carrots,ü•ï",tortellini:"Tortellini,ü•ü",cream:"Cream,ü•õ",meat_sauce:"Meat sauce,üçñ",flour:"Flour,üåæ",milk:"Milk,ü•õ",broth:"Broth,üç≤",polenta:"Polenta,üåΩ",ricotta:"Ricotta,üßÄ",spinach:"Spinach,ü•¨",lasagna_noodles:"Lasagna noodles,üçù",steak:"Steak,ü•©",broccoli:"Broccoli,ü•¶",tater_tots:"Tater tots,ü•î",beets:"Beets,ü•¨",corn:"Corn,üåΩ",cucumbers:"Cucumbers,ü•í",butter:"Butter,üßà",pesto_sauce:"Pesto sauce,üåø",jam:"Jam,üçì",yogurt:"Yogurt,ü•õ",cannelloni:"Cannelloni,ü•ü"},
m:{none:"None,‚ùå,",custom:"Custom,‚úèÔ∏è,",ravioli_burro_e_salvia:"Ravioli burro e salvia,ü•ü,ravioli|sage,v",spaghetti_al_limone:"Spaghetti al limone,üçù,spaghetti|lemons,v",pasta_e_ceci:"Pasta e ceci,üçù,ditalini|chickpeas,v",pasta_col_tonno:"Pasta col tonno,üêü,spaghetti|tuna,f",pasta_sugo_tonno:"Pasta sugo tonno,üêü,pasta|tuna|tomato_sauce,f",piadine_prosciutto_provolone:"Piadine prosciutto provolone,ü•™,flatbreads|prosciutto|provolone_cheese,m",uova_fritte:"Uova fritte,üç≥,eggs,v",pasta_al_pesto:"Pasta al pesto,üåø,pasta|pesto_sauce,v",pasta_coi_pomodorini:"Pasta coi pomodorini,üçÖ,pasta|cherry_tomatoes,v",lenticchie:"Lenticchie,ü•ò,lentils|croutons,v",spaghetti_aglio_e_olio:"Spaghetti aglio e olio,üßÑ,spaghetti,v",carbonara:"Carbonara,ü•ì,spaghetti|eggs|bacon,m",frittata_di_pasta:"Frittata di pasta,üç≥,eggs,v",pasta_e_fagioli:"Pasta e fagioli,ü´ò,pasta|beans,v",salmone_col_riso:"Salmone col riso,üç£,salmon|rice,f",frittata_di_zucchine:"Frittata di zucchine,ü•í,eggs|zucchini,v",polpette:"Polpette,üßÜ,ground_beef|eggs|bread|breadcrumbs,m",pollo_al_limone:"Pollo al limone,üçó,chicken_breast|lemons,m",merluzzo:"Merluzzo,üêü,cod,f",hamburger:"Hamburger,üçî,hamburger_buns|ground_beef|american_cheese_slices|lettuce|tomatoes,m",cotolette:"Cotolette,ü•©,breaded_cutlets|breadcrumbs|eggs,m",salsicce:"Salsicce,üå≠,sausages,m",minestrone:"Minestrone,üç≤,vegetable_soup_mix|pasta|beans,v",pollo_al_forno:"Pollo al forno,üçó,chicken_thighs,m",scaloppine_al_limone:"Scaloppine al limone,ü•©,veal_cutlets|lemons,m",caprese:"Caprese,üßÄ,fresh_mozzarella|tomatoes,v",cordon_bleu:"Cordon bleu,ü•©,cordon_bleu,m",w√ºrstel:"W√ºrstel,üå≠,hot_dogs,m",dumplings:"Dumplings,ü•ü,dumplings,m",fish_sticks:"Fish sticks,üêü,fish_sticks,f",pollo_allo_spiedo:"Pollo allo spiedo,üçó,whole_chicken,m",pasta_al_forno:"Pasta al forno,üçù,pasta|tomato_sauce|shredded_mozzarella,v",parmigiana_di_melanzane:"Parmigiana di melanzane,üçÜ,eggplant|tomato_sauce|shredded_mozzarella,v",zucchine_ripiene:"Zucchine ripiene,ü•í,zucchini|ground_beef|bread,m",lasagna:"Lasagna,üçù,lasagna_noodles|meat_sauce,m",spezzatino_con_patate:"Spezzatino con patate,ü•ò,beef|potatoes|onion|carrots,m",tortellini_con_la_panna:"Tortellini con la panna,ü•ü,tortellini|cream,v",tortellini_col_sugo:"Tortellini col sugo,ü•ü,tortellini|tomato_sauce,v",pasta_col_rag√π:"Pasta col rag√π,üçù,pasta|meat_sauce,m",polpettone:"Polpettone,ü•©,ground_beef|eggs|bacon|bread,m",scrimpelle_mbuss:"Scrimpelle mbuss,ü•û,eggs|flour|milk|broth,v",polenta_col_sugo:"Polenta col sugo,üåΩ,polenta|tomato_sauce|sausages,m",cannelloni:"Cannelloni,ü•ü,cannelloni|ricotta|spinach,v",bistecca:"Bistecca,ü•©,steak,m",pizza_delivery:"Pizza Delivery,üçï,,o",greco_delivery:"Greco Delivery,ü•ô,,o",chinese_delivery:"Chinese Delivery,ü•°,,o",vietnamese_delivery:"Vietnamese Delivery,üçú,,o",ramen_delivery:"Ramen Delivery,üçú,,o",pur√®_di_patate:"Pur√® di patate,ü•î,potatoes,v",broccoli_al_vapore:"Broccoli al vapore,ü•¶,broccoli,v",insalata_di_pomodori:"Insalata di pomodori,üçÖ,tomatoes,v",tater_tots:"Tater tots,ü•î,tater_tots,v",barbabietole:"Barbabietole,ü•¨,beets,v",insalata_di_mais:"Insalata di mais,üåΩ,corn,v",patate_lesse:"Patate lesse,ü•î,potatoes,v",carote_al_forno:"Carote al forno,ü•ï,carrots,v",carote_a_insalata:"Carote a insalata,ü•ï,carrots,v",zucchine_trifolate:"Zucchine trifolate,ü•í,zucchini,v",insalata_di_cetrioli:"Insalata di cetrioli,ü•í,cucumbers,v",insalata:"Insalata,ü•ó,lettuce,v",uova_e_pane_tostato:"Uova e pane tostato,üç≥,eggs|bread|butter,v",pancake_casalinghi:"Pancake casalinghi,ü•û,flour|milk|eggs|butter,v",toast_burro_marmellata:"Toast burro e marmellata,üçû,bread|butter|jam,v",yogurt_simplice:"Yogurt semplice,ü•õ,yogurt,v",toast_prosciutto_provolone:"Toast prosciutto & provolone,ü•™,bread|prosciutto|provolone_cheese,m"},
c:{lunch:"none|ravioli_burro_e_salvia|spaghetti_al_limone|pasta_e_ceci|pasta_col_tonno|pasta_sugo_tonno|piadine_prosciutto_provolone|uova_fritte|pasta_al_pesto|pasta_coi_pomodorini|lenticchie|spaghetti_aglio_e_olio|carbonara|frittata_di_pasta|pasta_e_fagioli|custom",dinnerRegular:"none|salmone_col_riso|frittata_di_zucchine|polpette|pollo_al_limone|merluzzo|hamburger|cotolette|salsicce|minestrone|pollo_al_forno|scaloppine_al_limone|caprese|custom",dinnerQuick:"none|cordon_bleu|w√ºrstel|dumplings|fish_sticks|pollo_allo_spiedo|custom",delivery:"none|pizza_delivery|greco_delivery|chinese_delivery|vietnamese_delivery|ramen_delivery|custom",dinnerWeekend:"none|pasta_al_forno|parmigiana_di_melanzane|zucchine_ripiene|lasagna|spezzatino_con_patate|tortellini_con_la_panna|tortellini_col_sugo|pasta_col_rag√π|polpettone|scrimpelle_mbuss|polenta_col_sugo|cannelloni|bistecca|custom",side:"none|pur√®_di_patate|broccoli_al_vapore|insalata_di_pomodori|tater_tots|barbabietole|insalata_di_mais|patate_lesse|carote_al_forno|carote_a_insalata|zucchine_trifolate|insalata_di_cetrioli|insalata|custom",breakfastWeekend:"none|uova_e_pane_tostato|pancake_casalinghi|toast_burro_marmellata|yogurt_simplice|toast_prosciutto_provolone|custom"},
s:{Aldi:"bacon|beets|cannelloni|carrots|chicken_thighs|breaded_cutlets|croutons|dumplings|beans|fish_sticks|lemons|corn|shredded_mozzarella|potatoes|chicken_breast|flatbreads|tomatoes|cherry_tomatoes|provolone_cheese|prosciutto|ravioli|sausages|american_cheese_slices|spinach|tater_tots|tortellini|eggs|hot_dogs|zucchini|ground_beef|ricotta|milk|pesto_sauce|yogurt|jam|bread|butter|flour",Wegmans:"steak|broccoli|cucumbers|onion|hamburger_buns|butter|lettuce|lentils|eggplant|cod|whole_chicken|sage|salmon|bread|tomato_sauce",Amazon:"pasta|tuna|breadcrumbs|rice",Other:""}
};
const M={},ME={},MI={},MC={},S={};
Object.entries(D.i).forEach(([k,v])=>{const[n,e]=v.split(',');MI[n]=e});
Object.entries(D.m).forEach(([k,v])=>{const[n,e,i]=v.split(',');M[n]={n,e,i:i?i.split('|').map(x=>D.i[x]?.split(',')[0]||x):[]};ME[n]=e});
Object.entries(D.c).forEach(([k,v])=>MC[k]=v.split('|').map(x=>M[x]?.n||x));
Object.entries(D.s).forEach(([k,v])=>S[k]=v.split('|').map(x=>D.i[x]?.split(',')[0]||x));
class MP{
constructor(){this.s=this.load()||this.init();this.migrate();this.d=null;this.setup()}
migrate(){this.s.days.forEach(d=>{d.breakfast??=null;d.customBreakfast??=null})}
init(){const w=this.getWeekStart(new Date()),n=['Monday','Tuesday','Wednesday','Thursday','Friday','Saturday','Sunday'];return{weekStart:w.toISOString(),showWeekend:true,theme:'dark',days:n.map((n,i)=>({name:n,date:new Date(w.getTime()+i*864e5).toISOString(),breakfast:null,lunch:null,dinner:null,side:null,dinnerType:'regular',customBreakfast:null,customLunch:null,customDinner:null,customSide:null}))}}
getWeekStart(d){const dt=new Date(d),dy=dt.getDay(),df=dt.getDate()-dy+(dy===0?-6:1);return new Date(dt.setDate(df)).setHours(0,0,0,0),dt}
getKey(d){return`meal_plan_${this.getWeekStart(d).toISOString().slice(0,10)}`}
load(){try{return JSON.parse(localStorage.getItem(this.getKey(new Date())))}catch{return null}}
save(){try{localStorage.setItem(this.getKey(new Date(this.s.weekStart)),JSON.stringify(this.s))}catch{}}
setup(){this.applyTheme();this.render();this.attachListeners()}
applyTheme(){document.body.className=this.s.theme;document.getElementById('themeToggle').textContent=this.s.theme==='dark'?'üåô':'‚òÄÔ∏è'}
toggleTheme(){this.s.theme=this.s.theme==='dark'?'light':'dark';this.applyTheme();this.save()}
nav(dir){const c=new Date(this.s.weekStart),o=dir==='next'?7:-7,n=new Date(c.getTime()+o*864e5);n.setHours(0,0,0,0);const k=this.getKey(n),e=localStorage.getItem(k);if(e){this.s=JSON.parse(e)}else{this.s=this.init();this.s.weekStart=n.toISOString();this.s.days.forEach((d,i)=>d.date=new Date(n.getTime()+i*864e5).toISOString())}this.migrate();this.applyTheme();this.render()}
fmt(d,t){const dt=new Date(d),m=['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];if(t)return`${m[dt.getMonth()]} ${dt.getDate()}`;const e=new Date(dt.getTime()+6*864e5);return`${m[dt.getMonth()]} ${dt.getDate()} - ${e.getDate()}, ${dt.getFullYear()}`}
render(){document.getElementById('weekDate').textContent=this.fmt(this.s.weekStart);this.renderDays()}
renderDays(){const h=this.s.days.slice(0,5).map((d,i)=>this.dayCard(d,i)).join('')+`<div class="weekend-card"><span style="font-weight:700">Show weekends</span><div class="toggle-switch ${this.s.showWeekend?'active':''}" id="weekendToggle"><div class="toggle-knob"></div></div></div>`+(this.s.showWeekend?this.s.days.slice(5,7).map((d,i)=>this.dayCard(d,i+5)).join(''):'');document.getElementById('daysList').innerHTML=h;this.attachDayListeners()}
dayCard(d,i){const w=d.name[0]==='S',bt=d.breakfast==='Custom'?(d.customBreakfast||'Custom'):d.breakfast==='None'?'No breakfast':(d.breakfast||'Select breakfast'),lt=d.lunch==='Custom'?(d.customLunch||'Custom'):d.lunch==='None'?'No lunch':(d.lunch||'Select lunch'),dt=d.dinner==='Custom'?(d.customDinner||'Custom'):d.dinner==='None'?'No dinner':(d.dinner||'Select dinner'),st=d.side==='Custom'?(d.customSide||'Custom'):d.side==='None'?'':(d.side||''),be=ME[d.breakfast]||'‚òïÔ∏è',le=ME[d.lunch]||'üçΩÔ∏è',de=ME[d.dinner]||'üçΩÔ∏è',n=(d.dinnerType==='delivery'?2:3)+(w?1:0),c=(w&&d.breakfast?1:0)+(d.lunch?1:0)+(d.dinner?1:0)+(d.dinnerType!=='delivery'&&d.side?1:0);
return`<div class="day-card ${c<n?'incomplete':''}" data-day="${i}"><div class="day-header"><div><div class="day-title">${d.name}<span class="chip">${c}/${n}</span></div><div class="day-date">${this.fmt(d.date,1)}</div></div><div class="type-toggles"><button class="type-toggle ${d.dinnerType==='quick'?'active quick':''}" data-type="quick" data-day="${i}">Quick</button><button class="type-toggle ${d.dinnerType==='delivery'?'active delivery':''}" data-type="delivery" data-day="${i}">Delivery</button></div></div>${w?`<div class="meal-item ${!d.breakfast?'empty':''}" data-meal="breakfast" data-day="${i}"><div class="meal-icon breakfast">${be}</div><div class="meal-content"><div class="meal-title">Breakfast</div><div class="meal-description">${bt}</div></div></div>`:''}<div class="meal-item ${!d.lunch?'empty':''}" data-meal="lunch" data-day="${i}"><div class="meal-icon lunch">${le}</div><div class="meal-content"><div class="meal-title">Lunch</div><div class="meal-description">${lt}</div></div></div><div class="meal-item ${!d.dinner?'empty':''}" data-meal="dinner" data-day="${i}"><div class="meal-icon dinner">${de}</div><div class="meal-content"><div class="meal-title">Dinner</div><div class="meal-description">${dt}${st?` ‚Ä¢ ${st}`:''}</div></div></div></div>`}
attachDayListeners(){document.querySelectorAll('.meal-item').forEach(i=>i.onclick=()=>{const di=+i.dataset.day,mt=i.dataset.meal;this[mt==='breakfast'?'openBreakfast':mt==='lunch'?'openLunch':'openDinner'](di)});document.querySelectorAll('.type-toggle').forEach(t=>t.onclick=e=>{e.stopPropagation();const di=+t.dataset.day,ty=t.dataset.type,d=this.s.days[di];d.dinnerType=d.dinnerType===ty?'regular':ty;if(ty==='delivery')d.side='None';d.dinner=null;this.save();this.render()});const wt=document.getElementById('weekendToggle');if(wt)wt.onclick=()=>{this.s.showWeekend=!this.s.showWeekend;this.save();this.render()}}
getDO(d){const w=d.name[0]==='S';return d.dinnerType==='quick'?MC.dinnerQuick:d.dinnerType==='delivery'?MC.delivery:w?MC.dinnerWeekend:MC.dinnerRegular}
openBreakfast(di){const d=this.s.days[di];if(d.name[0]!=='S')return;this.d=di;let b=this.grid('breakfast',d.breakfast,MC.breakfastWeekend);if(d.breakfast==='Custom')b+=`<div class="input-group"><label class="input-label">Custom Breakfast</label><input class="input" id="customBreakfastInput" value="${d.customBreakfast||''}" placeholder="Enter custom breakfast"></div>`;
this.modal({title:`Breakfast - ${d.name}`,subtitle:this.fmt(d.date,1),body:b,footer:[{label:'üé≤ Random',onClick:()=>this.rand('breakfast',di)},{label:'üóëÔ∏è Clear',onClick:()=>this.clear('breakfast',di)},{label:'Cancel',onClick:()=>this.close()},{label:'Save',primary:true,onClick:()=>this.saveBreakfast(di)}]})}
openLunch(di){this.d=di;const d=this.s.days[di];let b=this.grid('lunch',d.lunch,MC.lunch);if(d.lunch==='Custom')b+=`<div class="input-group"><label class="input-label">Custom Lunch</label><input class="input" id="customInput" value="${d.customLunch||''}" placeholder="Enter custom meal"></div>`;
this.modal({title:`Lunch - ${d.name}`,subtitle:this.fmt(d.date,1),body:b,footer:[{label:'üé≤ Random',onClick:()=>this.rand('lunch',di)},{label:'üóëÔ∏è Clear',onClick:()=>this.clear('lunch',di)},{label:'Cancel',onClick:()=>this.close()},{label:'Save',primary:true,onClick:()=>this.saveLunch(di)}]})}
openDinner(di){this.d=di;const d=this.s.days[di],do_=this.getDO(d);let b=`<div class="controls"><span style="font-weight:700;color:#aaa">Dinner Type</span><div class="type-toggles"><button class="type-toggle ${d.dinnerType==='quick'?'active quick':''}" id="modalQuick">Quick</button><button class="type-toggle ${d.dinnerType==='delivery'?'active delivery':''}" id="modalDelivery">Delivery</button></div></div>`;
b+=this.grid('dinner',d.dinner,do_);if(d.dinner==='Custom')b+=`<div class="input-group"><label class="input-label">Custom Dinner</label><input class="input" id="customDinnerInput" value="${d.customDinner||''}" placeholder="Enter custom meal"></div>`;
b+=`<div class="input-group"><label class="input-label">Side Dish</label></div>`;b+=this.grid('side',d.side,MC.side);if(d.side==='Custom')b+=`<div class="input-group"><input class="input" id="customSideInput" value="${d.customSide||''}" placeholder="Enter custom side"></div>`;
this.modal({title:`Dinner - ${d.name}`,subtitle:this.fmt(d.date,1),body:b,footer:[{label:'üé≤ Random',onClick:()=>this.rand('dinner',di)},{label:'üóëÔ∏è Clear',onClick:()=>this.clear('dinner',di)},{label:'Cancel',onClick:()=>this.close()},{label:'Save',primary:true,onClick:()=>this.saveDinner(di)}]});
setTimeout(()=>{const q=document.getElementById('modalQuick'),dl=document.getElementById('modalDelivery');if(q)q.onclick=()=>{d.dinnerType=d.dinnerType==='quick'?'regular':'quick';this.openDinner(di)};if(dl)dl.onclick=()=>{d.dinnerType=d.dinnerType==='delivery'?'regular':'delivery';if(d.dinnerType==='delivery')d.side='None';this.openDinner(di)}},0)}
grid(t,s,o){return`<div class="bento-grid" data-type="${t}">${o.map(m=>`<div class="bento-item ${s===m?'selected':''}" data-meal="${m}" data-type="${t}"><span class="bento-emoji">${ME[m]||'üçΩÔ∏è'}</span><span>${m}</span></div>`).join('')}</div>`}
modal({title,subtitle,body,footer}){const o=document.getElementById('modalOverlay');document.getElementById('modalTitle').textContent=title;document.getElementById('modalSubtitle').textContent=subtitle;document.getElementById('modalBody').innerHTML=body;const f=document.getElementById('modalFooter');f.innerHTML='';footer.forEach(b=>{const btn=document.createElement('button');btn.className=b.primary?'btn btn-primary':'btn';btn.textContent=b.label;btn.onclick=b.onClick;f.appendChild(btn)});o.classList.add('show');
setTimeout(()=>{document.querySelectorAll('.bento-item').forEach(i=>i.onclick=()=>{const t=i.dataset.type,m=i.dataset.meal,d=this.s.days[this.d];document.querySelectorAll(`.bento-grid[data-type="${t}"] .bento-item`).forEach(x=>x.classList.remove('selected'));i.classList.add('selected');d[t]=m;if(m==='Custom')this[t==='breakfast'?'openBreakfast':t==='lunch'?'openLunch':'openDinner'](this.d)})},0)}
close(){document.getElementById('modalOverlay').classList.remove('show')}
saveBreakfast(di){const d=this.s.days[di];if(d.breakfast==='Custom'){const i=document.getElementById('customBreakfastInput');if(i)d.customBreakfast=i.value}this.save();this.render();this.close();this.toast('Saved! ‚úì')}
saveLunch(di){const d=this.s.days[di];if(d.lunch==='Custom'){const i=document.getElementById('customInput');if(i)d.customLunch=i.value}this.save();this.render();this.close();this.toast('Saved! ‚úì')}
saveDinner(di){const d=this.s.days[di];if(d.dinner==='Custom'){const i=document.getElementById('customDinnerInput');if(i)d.customDinner=i.value}if(d.side==='Custom'){const i=document.getElementById('customSideInput');if(i)d.customSide=i.value}this.save();this.render();this.close();this.toast('Saved! ‚úì')}
clear(t,di){const d=this.s.days[di];d[t]=null;d[`custom${t[0].toUpperCase()+t.slice(1)}`]=null;if(t==='dinner'){d.side=null;d.customSide=null}this[t==='breakfast'?'openBreakfast':t==='lunch'?'openLunch':'openDinner'](di)}
rand(t,di){const d=this.s.days[di],o=(t==='breakfast'?MC.breakfastWeekend:t==='lunch'?MC.lunch:this.getDO(d)).filter(m=>m!=='None'&&m!=='Custom');d[t]=o[Math.floor(Math.random()*o.length)];if(t==='dinner'&&d.dinnerType!=='delivery'){const so=MC.side.filter(m=>m!=='None'&&m!=='Custom');d.side=so[Math.floor(Math.random()*so.length)]}this[t==='breakfast'?'openBreakfast':t==='lunch'?'openLunch':'openDinner'](di)}
randWeek(){const lo=MC.lunch.filter(m=>m!=='None'&&m!=='Custom'),so=MC.side.filter(m=>m!=='None'&&m!=='Custom');this.s.days.forEach(d=>{if(d.name[0]==='S'){const bo=MC.breakfastWeekend.filter(m=>m!=='None'&&m!=='Custom');d.breakfast=bo[Math.floor(Math.random()*bo.length)]}else{d.breakfast=null;d.customBreakfast=null}const do_=this.getDO(d).filter(m=>m!=='None'&&m!=='Custom');d.lunch=lo[Math.floor(Math.random()*lo.length)];d.dinner=do_[Math.floor(Math.random()*do_.length)];if(d.dinnerType!=='delivery')d.side=so[Math.floor(Math.random()*so.length)]});this.save();this.render();this.toast('Week randomized! üé≤')}
clearWeek(){if(confirm('Clear all meals for this week?')){this.s.days.forEach(d=>{d.breakfast=null;d.customBreakfast=null;d.lunch=null;d.customLunch=null;d.dinner=null;d.customDinner=null;d.side=null;d.customSide=null;d.dinnerType='regular'});this.save();this.render();this.toast('Week cleared')}}
genGrocery(){const g={},a=(s,i)=>{if(!g[s])g[s]=[];if(!g[s].includes(i))g[s].push(i)};this.s.days.forEach(d=>{const ms=[];if(d.name[0]==='S'&&d.breakfast&&d.breakfast!=='None'&&d.breakfast!=='Custom')ms.push(d.breakfast);['lunch','dinner','side'].forEach(t=>{if(d[t]&&d[t]!=='None'&&d[t]!=='Custom')ms.push(d[t])});ms.forEach(m=>(M[m]?.i||[]).forEach(i=>a(this.findStore(i),i)))});return g}
findStore(i){for(const[s,is]of Object.entries(S))if(is.includes(i))return s;return'Other'}
openShopping(){const g=this.genGrocery(),ss=Object.keys(g).sort();let b='';ss.forEach(s=>{b+=`<div class="store-section"><h3 class="store-title">${s}</h3>${g[s].map(i=>`<div class="grocery-item"><div class="checkbox"></div><div class="grocery-item-text">${MI[i]||''} ${i}</div></div>`).join('')}</div>`});
this.modal({title:'Shopping List',subtitle:'Check off items as you shop',body:b,footer:[{label:'Close',onClick:()=>this.close()},{label:'Share',primary:true,onClick:()=>this.shareShopping(g)}]});
setTimeout(()=>document.querySelectorAll('.checkbox').forEach(c=>c.onclick=()=>{c.classList.toggle('checked');c.parentElement.classList.toggle('checked')}),0)}
shareShopping(g){let t='üõí Shopping List\n\n';Object.keys(g).sort().forEach(s=>{t+=`${s}:\n`;g[s].forEach(i=>t+=`‚Ä¢ ${MI[i]||''} ${i}\n`);t+='\n'});this.share('Shopping List',t)}
shareWeek(){let t='üóìÔ∏è Weekly Meal Plan\n\n';this.s.days.forEach(d=>{t+=`${d.name} (${this.fmt(d.date,1)})\n`;const b=d.breakfast==='Custom'?d.customBreakfast:d.breakfast,l=d.lunch==='Custom'?d.customLunch:d.lunch,dn=d.dinner==='Custom'?d.customDinner:d.dinner,s=d.side==='Custom'?d.customSide:d.side;if(d.name[0]==='S')t+=`  Breakfast: ${b||'‚Äî'}\n`;t+=`  Lunch: ${l||'‚Äî'}\n  Dinner: ${dn||'‚Äî'}`;if(d.dinnerType==='delivery')t+=' [Delivery]';else if(d.dinnerType==='quick')t+=' [Quick]';if(s&&s!=='None')t+=`\n  Side: ${s}`;t+='\n\n'});const g=this.genGrocery();t+='\nüõí Shopping List\n\n';Object.keys(g).sort().forEach(s=>{t+=`${s}:\n`;g[s].forEach(i=>t+=`‚Ä¢ ${MI[i]||''} ${i}\n`);t+='\n'});this.share('Meal Plan & Shopping',t)}
share(t,txt){if(navigator.share)navigator.share({title:t,text:txt});else if(navigator.clipboard){navigator.clipboard.writeText(txt);this.toast('Copied to clipboard! üìã')}}
toast(m){const t=document.getElementById('toast');t.textContent=m;t.classList.add('show');setTimeout(()=>t.classList.remove('show'),2000)}
attachListeners(){const e=(id,fn)=>document.getElementById(id).onclick=fn;e('themeToggle',()=>this.toggleTheme());e('prevWeek',()=>this.nav('prev'));e('nextWeek',()=>this.nav('next'));e('randomizeBtn',()=>this.randWeek());e('shoppingBtn',()=>this.openShopping());e('shareBtn',()=>this.shareWeek());e('clearBtn',()=>this.clearWeek());e('modalOverlay',ev=>{if(ev.target.id==='modalOverlay')this.close()});
document.addEventListener('keydown',ev=>{if(ev.key==='Escape')this.close();const mo=document.getElementById('modalOverlay').classList.contains('show');if(ev.key==='ArrowLeft'&&!mo)this.nav('prev');if(ev.key==='ArrowRight'&&!mo)this.nav('next')})}}
document.addEventListener('DOMContentLoaded',()=>window.app=new MP());
</script>
</body>
</html>
