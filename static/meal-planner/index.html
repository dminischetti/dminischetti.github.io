<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="theme-color" content="#000000">
<title>✨ Weekly Meal Planner</title>
<style>
/* ===== 2025 Revolutionary Design System ===== */
:root {
  /* Modern Glassmorphism Palette */
  --bg-primary: linear-gradient(135deg, #0a0a0f 0%, #1a1a2e 50%, #0f0f23 100%);
  --glass-ultra: rgba(255, 255, 255, 0.03);
  --glass-light: rgba(255, 255, 255, 0.08);
  --glass-medium: rgba(255, 255, 255, 0.12);
  --glass-strong: rgba(255, 255, 255, 0.18);
  --glass-border: rgba(255, 255, 255, 0.15);
  --glass-glow: rgba(103, 126, 234, 0.15);
  
  /* Dynamic Color System */
  --primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  --primary-solid: #667eea;
  --primary-glow: rgba(103, 126, 234, 0.4);
  --secondary: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
  --accent: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
  --success: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
  --warning: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
  --danger: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
  
  /* Advanced Typography */
  --text-primary: rgba(255, 255, 255, 0.98);
  --text-secondary: rgba(255, 255, 255, 0.78);
  --text-tertiary: rgba(255, 255, 255, 0.58);
  --text-muted: rgba(255, 255, 255, 0.38);
  
  /* Layout & Spacing */
  --safe-top: env(safe-area-inset-top);
  --safe-bottom: env(safe-area-inset-bottom);
  --radius-xs: 8px;
  --radius-sm: 12px;
  --radius-md: 16px;
  --radius-lg: 20px;
  --radius-xl: 28px;
  --radius-2xl: 32px;
  
  /* Advanced Effects */
  --blur-subtle: blur(8px);
  --blur-medium: blur(16px);
  --blur-strong: blur(24px);
  --blur-extreme: blur(40px);
  --shadow-soft: 0 4px 16px rgba(0, 0, 0, 0.15);
  --shadow-medium: 0 8px 32px rgba(0, 0, 0, 0.25);
  --shadow-strong: 0 16px 64px rgba(0, 0, 0, 0.4);
  --shadow-glow: 0 0 24px var(--primary-glow);
  
  /* 2025 Motion System */
  --spring: cubic-bezier(0.34, 1.56, 0.64, 1);
  --bounce: cubic-bezier(0.68, -0.55, 0.265, 1.55);
  --smooth: cubic-bezier(0.25, 0.46, 0.45, 0.94);
  --swift: 0.2s;
  --fluid: 0.4s;
  --dramatic: 0.6s;
}

/* ===== Foundation ===== */
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  -webkit-tap-highlight-color: transparent;
}

html, body {
  height: 100%;
  overflow-x: hidden;
}

body {
  font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Inter', system-ui, sans-serif;
  background: var(--bg-primary);
  color: var(--text-primary);
  line-height: 1.4;
  font-size: 14px;
  -webkit-font-smoothing: antialiased;
  text-rendering: optimizeLegibility;
  overscroll-behavior: none;
  font-feature-settings: "cv02", "cv03", "cv04", "cv11";
}

/* ===== Advanced Glassmorphism Components ===== */
.glass {
  background: var(--glass-light);
  border: 1px solid var(--glass-border);
  backdrop-filter: var(--blur-medium);
  -webkit-backdrop-filter: var(--blur-medium);
  box-shadow: var(--shadow-soft);
}

.glass-strong {
  background: var(--glass-strong);
  border: 1px solid var(--glass-border);
  backdrop-filter: var(--blur-strong);
  -webkit-backdrop-filter: var(--blur-strong);
  box-shadow: var(--shadow-medium);
}

.glass-glow {
  background: var(--glass-glow);
  border: 1px solid var(--primary-solid);
  backdrop-filter: var(--blur-medium);
  box-shadow: var(--shadow-glow);
}

/* ===== Modern Typography System ===== */
.text-display {
  font-size: 32px;
  font-weight: 800;
  letter-spacing: -0.5px;
  line-height: 1.1;
}

.text-title-xl {
  font-size: 24px;
  font-weight: 700;
  letter-spacing: -0.3px;
  line-height: 1.2;
}

.text-title-lg {
  font-size: 20px;
  font-weight: 700;
  letter-spacing: -0.2px;
  line-height: 1.2;
}

.text-title-md {
  font-size: 17px;
  font-weight: 600;
  letter-spacing: -0.1px;
}

.text-body-lg {
  font-size: 16px;
  font-weight: 500;
}

.text-body-md {
  font-size: 14px;
  font-weight: 500;
}

.text-body-sm {
  font-size: 12px;
  font-weight: 500;
}

.text-caption {
  font-size: 10px;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

/* ===== Revolutionary Button System ===== */
.btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  padding: 12px 20px;
  border: none;
  border-radius: var(--radius-lg);
  font-weight: 600;
  font-size: 14px;
  cursor: pointer;
  transition: all var(--swift) var(--smooth);
  position: relative;
  overflow: hidden;
  text-decoration: none;
  user-select: none;
}

.btn::before {
  content: '';
  position: absolute;
  inset: 0;
  background: rgba(255, 255, 255, 0.1);
  transform: translateX(-100%);
  transition: transform var(--fluid) var(--smooth);
}

.btn:active::before {
  transform: translateX(0);
}

.btn:active {
  transform: scale(0.98);
}

.btn-primary {
  background: var(--primary);
  color: white;
  box-shadow: var(--shadow-glow);
}

.btn-primary:hover {
  transform: translateY(-2px);
  box-shadow: var(--shadow-glow), var(--shadow-medium);
}

.btn-glass {
  background: var(--glass-medium);
  color: var(--text-primary);
  border: 1px solid var(--glass-border);
  backdrop-filter: var(--blur-medium);
  box-shadow: var(--shadow-soft);
}

.btn-glass:hover {
  background: var(--glass-strong);
  transform: translateY(-1px);
}

.btn-success {
  background: var(--success);
  color: white;
  box-shadow: 0 4px 16px rgba(67, 233, 123, 0.3);
}

.btn-danger {
  background: var(--danger);
  color: white;
  box-shadow: 0 4px 16px rgba(255, 107, 107, 0.3);
}

.btn-compact {
  padding: 8px 12px;
  font-size: 12px;
  border-radius: var(--radius-md);
}

.btn-mini {
  padding: 6px 8px;
  font-size: 11px;
  min-width: 32px;
  height: 32px;
  border-radius: var(--radius-sm);
}

/* ===== Layout Architecture ===== */
.app {
  min-height: 100vh;
  padding-bottom: calc(72px + var(--safe-bottom));
  position: relative;
}

/* ===== Revolutionary Header ===== */
.header {
  position: sticky;
  top: 0;
  z-index: 100;
  padding: calc(12px + var(--safe-top)) 16px 12px;
  background: var(--glass-strong);
  border-bottom: 1px solid var(--glass-border);
  backdrop-filter: var(--blur-extreme);
  -webkit-backdrop-filter: var(--blur-extreme);
  box-shadow: var(--shadow-soft);
}

.header-content {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 16px;
}

.header-brand {
  display: flex;
  flex-direction: column;
  gap: 2px;
}

.header-title {
  font-size: 20px;
  font-weight: 800;
  letter-spacing: -0.3px;
  background: var(--primary);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.header-subtitle {
  color: var(--text-secondary);
  font-size: 11px;
  font-weight: 500;
}

.header-controls {
  display: flex;
  align-items: center;
  gap: 12px;
}

/* ===== Advanced Weekend Toggle ===== */
.weekend-toggle {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 8px 12px;
  border-radius: var(--radius-md);
  background: var(--glass-light);
  border: 1px solid var(--glass-border);
  cursor: pointer;
  transition: all var(--swift) var(--smooth);
}

.weekend-toggle:hover {
  background: var(--glass-medium);
  transform: translateY(-1px);
}

.weekend-toggle.active {
  background: var(--glass-glow);
  border-color: var(--primary-solid);
  box-shadow: var(--shadow-glow);
}

.toggle-label {
  font-size: 10px;
  font-weight: 600;
  color: var(--text-secondary);
  text-transform: uppercase;
  letter-spacing: 0.3px;
}

.weekend-toggle.active .toggle-label {
  color: var(--primary-solid);
}

.toggle-switch {
  width: 36px;
  height: 20px;
  background: var(--glass-ultra);
  border-radius: 10px;
  position: relative;
  transition: all var(--swift) var(--bounce);
  border: 1px solid var(--glass-border);
}

.weekend-toggle.active .toggle-switch {
  background: var(--primary-solid);
  box-shadow: 0 0 16px var(--primary-glow);
}

.toggle-knob {
  position: absolute;
  top: 1px;
  left: 1px;
  width: 16px;
  height: 16px;
  background: white;
  border-radius: 50%;
  transition: all var(--bounce);
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
}

.weekend-toggle.active .toggle-knob {
  transform: translateX(16px);
}

/* ===== Main Content with Bento Grid ===== */
.main {
  padding: 16px;
}

.bento-grid {
  display: flex;
  flex-direction: column;
  gap: 12px;
}

/* ===== Revolutionary Day Cards ===== */
.day-card {
  background: var(--glass-light);
  border: 1px solid var(--glass-border);
  border-radius: var(--radius-xl);
  padding: 20px;
  backdrop-filter: var(--blur-medium);
  -webkit-backdrop-filter: var(--blur-medium);
  box-shadow: var(--shadow-soft);
  transition: all var(--fluid) var(--smooth);
  position: relative;
  overflow: hidden;
}

.day-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 3px;
  background: var(--primary);
  transform: scaleX(0);
  transition: transform var(--fluid) var(--smooth);
  border-radius: var(--radius-xl) var(--radius-xl) 0 0;
}

.day-card:hover::before {
  transform: scaleX(1);
}

.day-card:hover {
  background: var(--glass-medium);
  transform: translateY(-4px);
  box-shadow: var(--shadow-strong);
  border-color: rgba(255, 255, 255, 0.2);
}

.day-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 16px;
}

.day-info {
  display: flex;
  flex-direction: column;
  gap: 2px;
}

.day-name {
  font-size: 18px;
  font-weight: 700;
  letter-spacing: -0.2px;
  color: var(--text-primary);
}

.day-date {
  color: var(--text-tertiary);
  font-size: 11px;
  font-weight: 500;
  text-transform: uppercase;
  letter-spacing: 0.3px;
}

.day-actions {
  display: flex;
  align-items: center;
  gap: 8px;
}

.day-randomize {
  background: var(--glass-light);
  border: 1px solid var(--glass-border);
  border-radius: var(--radius-sm);
  padding: 6px;
  cursor: pointer;
  transition: all var(--swift) var(--bounce);
  font-size: 14px;
  display: flex;
  align-items: center;
  justify-content: center;
  width: 32px;
  height: 32px;
}

.day-randomize:hover {
  background: var(--glass-medium);
  transform: scale(1.1);
  box-shadow: var(--shadow-soft);
}

.day-randomize:active {
  transform: scale(0.95) rotate(90deg);
}

/* ===== Modal-First Meal Selection ===== */
.meal-bento {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 8px;
  margin-bottom: 16px;
}

.meal-selector {
  background: var(--glass-ultra);
  border: 1px solid var(--glass-border);
  border-radius: var(--radius-md);
  padding: 12px;
  cursor: pointer;
  transition: all var(--swift) var(--smooth);
  position: relative;
  min-height: 64px;
  display: flex;
  flex-direction: column;
  justify-content: center;
  text-align: center;
}

.meal-selector::after {
  content: '';
  position: absolute;
  inset: 0;
  background: var(--glass-glow);
  opacity: 0;
  transition: opacity var(--swift) var(--smooth);
  border-radius: var(--radius-md);
}

.meal-selector:hover::after {
  opacity: 0.5;
}

.meal-selector:active {
  transform: scale(0.98);
}

.meal-selector.has-value {
  background: var(--glass-glow);
  border-color: var(--primary-solid);
  box-shadow: 0 0 12px var(--primary-glow);
}

.meal-label {
  font-size: 9px;
  font-weight: 700;
  color: var(--text-muted);
  text-transform: uppercase;
  letter-spacing: 0.4px;
  margin-bottom: 4px;
}

.meal-value {
  font-size: 11px;
  font-weight: 500;
  color: var(--text-primary);
  line-height: 1.2;
  overflow: hidden;
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  position: relative;
  z-index: 1;
}

.meal-placeholder {
  color: var(--text-muted);
  font-style: italic;
  font-size: 10px;
}

.meal-emoji {
  font-size: 16px;
  margin-bottom: 2px;
  opacity: 0.8;
}

/* ===== Advanced Mode Selector ===== */
.mode-bento {
  display: flex;
  gap: 4px;
  background: var(--glass-ultra);
  padding: 4px;
  border-radius: var(--radius-md);
  border: 1px solid var(--glass-border);
}

.mode-btn {
  flex: 1;
  padding: 6px 8px;
  border: none;
  border-radius: calc(var(--radius-md) - 4px);
  font-size: 9px;
  font-weight: 700;
  background: transparent;
  color: var(--text-muted);
  cursor: pointer;
  transition: all var(--swift) var(--bounce);
  text-transform: uppercase;
  letter-spacing: 0.3px;
  position: relative;
}

.mode-btn::before {
  content: '';
  position: absolute;
  inset: 0;
  background: var(--primary);
  opacity: 0;
  transition: opacity var(--swift) var(--smooth);
  border-radius: inherit;
}

.mode-btn.active::before {
  opacity: 1;
}

.mode-btn.active {
  color: white;
  box-shadow: var(--shadow-soft);
  transform: scale(1.02);
}

.mode-btn span {
  position: relative;
  z-index: 1;
}

/* ===== Bottom Navigation Revolution ===== */
.bottom-nav {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  z-index: 200;
  background: var(--glass-strong);
  border-top: 1px solid var(--glass-border);
  padding: 12px 16px calc(12px + var(--safe-bottom));
  backdrop-filter: var(--blur-extreme);
  -webkit-backdrop-filter: var(--blur-extreme);
  box-shadow: 0 -8px 32px rgba(0, 0, 0, 0.3);
}

.nav-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 12px;
}

.nav-btn {
  padding: 12px 16px;
  border-radius: var(--radius-lg);
  font-weight: 600;
  font-size: 13px;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 6px;
  height: 44px;
  position: relative;
  overflow: hidden;
}

.nav-btn .emoji {
  font-size: 16px;
}

.share-btn-full {
  margin-top: 8px;
  width: 100%;
  height: 36px;
  padding: 8px 16px;
  font-size: 13px;
}

/* ===== Revolutionary Modal System ===== */
.modal-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.7);
  backdrop-filter: var(--blur-medium);
  -webkit-backdrop-filter: var(--blur-medium);
  z-index: 1000;
  opacity: 0;
  visibility: hidden;
  transition: all var(--fluid) var(--smooth);
  display: flex;
  align-items: flex-end;
  padding: 16px;
}

.modal-overlay.show {
  opacity: 1;
  visibility: visible;
}

.modal {
  width: 100%;
  max-width: 480px;
  margin: 0 auto;
  background: var(--glass-strong);
  border: 1px solid var(--glass-border);
  border-radius: var(--radius-2xl) var(--radius-2xl) 0 0;
  backdrop-filter: var(--blur-extreme);
  -webkit-backdrop-filter: var(--blur-extreme);
  box-shadow: var(--shadow-strong);
  transform: translateY(100%);
  transition: transform var(--dramatic) var(--spring);
  max-height: 85vh;
  display: flex;
  flex-direction: column;
}

.modal-overlay.show .modal {
  transform: translateY(0);
}

.modal-header {
  padding: 20px 24px 16px;
  border-bottom: 1px solid var(--glass-border);
  position: relative;
  background: var(--glass-medium);
  border-radius: var(--radius-2xl) var(--radius-2xl) 0 0;
}

.modal-handle {
  width: 40px;
  height: 4px;
  background: var(--text-muted);
  border-radius: 2px;
  margin: 0 auto 12px;
  opacity: 0.6;
}

.modal-title {
  font-size: 20px;
  font-weight: 700;
  letter-spacing: -0.2px;
  text-align: center;
  color: var(--text-primary);
}

.modal-subtitle {
  font-size: 12px;
  color: var(--text-secondary);
  text-align: center;
  margin-top: 4px;
}

.modal-body {
  flex: 1;
  overflow-y: auto;
  -webkit-overflow-scrolling: touch;
  padding: 0;
}

.modal-footer {
  padding: 16px 24px 20px;
  border-top: 1px solid var(--glass-border);
  display: flex;
  gap: 12px;
  background: var(--glass-medium);
}

/* ===== Advanced Meal Selection Interface ===== */
.meal-categories {
  padding: 0;
}

.meal-category {
  border-bottom: 1px solid var(--glass-border);
}

.category-header {
  padding: 16px 24px;
  background: var(--glass-ultra);
  font-size: 11px;
  font-weight: 700;
  color: var(--text-secondary);
  text-transform: uppercase;
  letter-spacing: 0.5px;
  border-bottom: 1px solid rgba(255, 255, 255, 0.05);
}

.meal-option {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 16px 24px;
  cursor: pointer;
  transition: all var(--swift) var(--smooth);
  border-bottom: 1px solid rgba(255, 255, 255, 0.03);
  position: relative;
}

.meal-option:last-child {
  border-bottom: none;
}

.meal-option::before {
  content: '';
  position: absolute;
  left: 0;
  top: 0;
  bottom: 0;
  width: 3px;
  background: var(--primary);
  transform: scaleY(0);
  transition: transform var(--swift) var(--smooth);
}

.meal-option:hover::before,
.meal-option.selected::before {
  transform: scaleY(1);
}

.meal-option:hover {
  background: var(--glass-ultra);
  transform: translateX(4px);
}

.meal-option.selected {
  background: var(--glass-glow);
  color: var(--primary-solid);
  font-weight: 600;
}

.meal-option-content {
  display: flex;
  align-items: center;
  gap: 12px;
}

.meal-option-emoji {
  font-size: 20px;
}

.meal-option-text {
  font-size: 15px;
  font-weight: 500;
  line-height: 1.3;
}

.meal-option-check {
  opacity: 0;
  transform: scale(0.5);
  transition: all var(--swift) var(--bounce);
  font-size: 18px;
  color: var(--primary-solid);
}

.meal-option.selected .meal-option-check {
  opacity: 1;
  transform: scale(1);
}

/* ===== Custom Input Enhancement ===== */
.custom-input-section {
  padding: 16px 24px;
  border-top: 1px solid var(--glass-border);
  background: var(--glass-ultra);
  display: none;
}

.custom-input-section.show {
  display: block;
  animation: slideDown var(--fluid) var(--smooth);
}

@keyframes slideDown {
  from { opacity: 0; transform: translateY(-10px); }
  to { opacity: 1; transform: translateY(0); }
}

.custom-input-form {
  display: flex;
  gap: 12px;
  align-items: flex-end;
}

.custom-input-field {
  flex: 1;
  display: flex;
  flex-direction: column;
  gap: 6px;
}

.custom-input-label {
  font-size: 10px;
  font-weight: 600;
  color: var(--text-secondary);
  text-transform: uppercase;
  letter-spacing: 0.3px;
}

.custom-input {
  background: var(--glass-light);
  border: 1px solid var(--glass-border);
  border-radius: var(--radius-md);
  padding: 12px 16px;
  color: var(--text-primary);
  font-size: 15px;
  font-weight: 500;
  transition: all var(--swift) var(--smooth);
}

.custom-input:focus {
  outline: none;
  border-color: var(--primary-solid);
  box-shadow: 0 0 0 3px var(--primary-glow);
  background: var(--glass-medium);
}

.custom-input::placeholder {
  color: var(--text-muted);
  font-style: italic;
}

/* ===== Enhanced List Components ===== */
.list-section {
  margin-bottom: 20px;
}

.list-section-header {
  padding: 12px 24px;
  background: var(--glass-ultra);
  border-bottom: 1px solid var(--glass-border);
}

.list-section-title {
  font-size: 13px;
  font-weight: 700;
  color: var(--text-secondary);
  text-transform: uppercase;
  letter-spacing: 0.4px;
  display: flex;
  align-items: center;
  gap: 8px;
}

.section-emoji {
  font-size: 16px;
}

.list-item {
  display: flex;
  align-items: center;
  gap: 16px;
  padding: 12px 24px;
  border-bottom: 1px solid rgba(255, 255, 255, 0.03);
  transition: all var(--swift) var(--smooth);
}

.list-item:hover {
  background: var(--glass-ultra);
}

.list-item:last-child {
  border-bottom: none;
}

.list-checkbox {
  width: 20px;
  height: 20px;
  accent-color: var(--primary-solid);
  cursor: pointer;
  border-radius: 4px;
}

.list-label {
  flex: 1;
  font-size: 14px;
  font-weight: 500;
  cursor: pointer;
  color: var(--text-primary);
  line-height: 1.3;
}

.list-count {
  font-size: 11px;
  font-weight: 600;
  color: var(--text-tertiary);
  background: var(--glass-ultra);
  padding: 2px 6px;
  border-radius: 6px;
  min-width: 16px;
  text-align: center;
}

/* ===== Share Content Enhancement ===== */
.share-content {
  padding: 24px;
}

.share-preview {
  background: var(--glass-ultra);
  border: 1px solid var(--glass-border);
  border-radius: var(--radius-lg);
  padding: 16px;
  font-family: 'SF Mono', ui-monospace, monospace;
  font-size: 12px;
  line-height: 1.5;
  white-space: pre-wrap;
  max-height: 320px;
  overflow-y: auto;
  color: var(--text-secondary);
  -webkit-overflow-scrolling: touch;
}

/* ===== Loading States ===== */
.loading-state {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 16px;
  padding: 40px 24px;
  color: var(--text-tertiary);
}

.loading-spinner {
  width: 24px;
  height: 24px;
  border: 2px solid var(--glass-border);
  border-top: 2px solid var(--primary-solid);
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

.loading-text {
  font-size: 13px;
  font-weight: 500;
  text-align: center;
}

/* ===== Advanced Animations ===== */
.fade-in-up {
  animation: fadeInUp var(--fluid) var(--smooth) forwards;
}

@keyframes fadeInUp {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.scale-in {
  animation: scaleIn var(--swift) var(--bounce) forwards;
}

@keyframes scaleIn {
  from {
    opacity: 0;
    transform: scale(0.9);
  }
  to {
    opacity: 1;
    transform: scale(1);
  }
}

.slide-up {
  animation: slideUp var(--dramatic) var(--spring) forwards;
}

@keyframes slideUp {
  from {
    transform: translateY(100%);
    opacity: 0;
  }
  to {
    transform: translateY(0);
    opacity: 1;
  }
}

/* ===== Responsive Design ===== */
@media (max-width: 390px) {
  .meal-bento {
    grid-template-columns: 1fr 1fr;
  }
  
  .meal-bento .meal-selector:nth-child(3) {
    grid-column: 1 / -1;
  }
  
  .nav-grid {
    grid-template-columns: 1fr;
    gap: 8px;
  }
  
  .header-controls {
    flex-direction: column;
    gap: 6px;
  }

  .modal {
    border-radius: var(--radius-xl) var(--radius-xl) 0 0;
  }

  .modal-header {
    border-radius: var(--radius-xl) var(--radius-xl) 0 0;
  }
}

/* ===== Accessibility Enhancements ===== */
@media (prefers-reduced-motion: reduce) {
  *, *::before, *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
  }
}

@media (prefers-color-scheme: light) {
  :root {
    --bg-primary: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 50%, #f1f5f9 100%);
    --text-primary: rgba(0, 0, 0, 0.92);
    --text-secondary: rgba(0, 0, 0, 0.72);
    --text-tertiary: rgba(0, 0, 0, 0.52);
    --text-muted: rgba(0, 0, 0, 0.32);
  }
}

:focus-visible {
  outline: 2px solid var(--primary-solid);
  outline-offset: 2px;
  border-radius: var(--radius-sm);
}

/* ===== Haptic Feedback Simulation ===== */
.haptic-light {
  animation: hapticLight 0.1s ease-out;
}

@keyframes hapticLight {
  0% { transform: scale(1); }
  50% { transform: scale(0.98); }
  100% { transform: scale(1); }
}

.haptic-medium {
  animation: hapticMedium 0.15s ease-out;
}

@keyframes hapticMedium {
  0% { transform: scale(1); }
  50% { transform: scale(0.96); }
  100% { transform: scale(1); }
}
</style>
</head>
<body>

<div id="app" class="app">
  <!-- Revolutionary Header -->
  <header class="header">
    <div class="header-content">
      <div class="header-brand">
        <h1 class="header-title">Meal Planner</h1>
        <div id="dateRange" class="header-subtitle"></div>
      </div>
      <div class="header-controls">
        <div id="weekendToggle" class="weekend-toggle" role="switch" aria-label="Include weekends" tabindex="0">
          <span class="toggle-label">Weekends</span>
          <div class="toggle-switch">
            <div class="toggle-knob"></div>
          </div>
        </div>
        <button id="clearBtn" class="btn btn-danger btn-compact">Clear All</button>
      </div>
    </div>
  </header>

  <!-- Main Bento Grid -->
  <main class="main">
    <div id="bentoGrid" class="bento-grid" aria-live="polite"></div>
  </main>

  <!-- Revolutionary Bottom Navigation -->
  <nav class="bottom-nav">
    <div class="nav-grid">
      <button id="groceryBtn" class="nav-btn btn-success">
        <span class="emoji">🛒</span>
        <span>Shopping</span>
      </button>
      <button id="shuffleBtn" class="nav-btn btn-primary">
        <span class="emoji">🎲</span>
        <span>Randomize</span>
      </button>
    </div>
    <button id="shareBtn" class="btn btn-glass share-btn-full">
      <span class="emoji">📤</span>
      <span>Weekly Summary</span>
    </button>
  </nav>
</div>

<!-- Revolutionary Modal System -->
<div id="modalOverlay" class="modal-overlay">
  
  <!-- Meal Selection Modal -->
  <div id="mealModal" class="modal" role="dialog" aria-modal="true" style="display: none;">
    <div class="modal-header">
      <div class="modal-handle"></div>
      <h2 id="mealModalTitle" class="modal-title">Choose Meal</h2>
      <div id="mealModalSubtitle" class="modal-subtitle">Select from curated options</div>
    </div>
    <div class="modal-body">
      <div class="custom-input-section" id="customInputSection">
        <div class="custom-input-form">
          <div class="custom-input-field">
            <label class="custom-input-label">Custom Meal</label>
            <input id="customInput" type="text" class="custom-input" placeholder="Enter your custom meal...">
          </div>
          <button id="customUseBtn" class="btn btn-primary">Add</button>
        </div>
      </div>
      <div id="mealCategories" class="meal-categories"></div>
    </div>
    <div class="modal-footer">
      <button id="mealModalClose" class="btn btn-glass" style="flex: 1;">Cancel</button>
    </div>
  </div>

  <!-- Shopping List Modal -->
  <div id="shoppingModal" class="modal" role="dialog" aria-modal="true" style="display: none;">
    <div class="modal-header">
      <div class="modal-handle"></div>
      <h2 class="modal-title">🛒 Shopping List</h2>
      <div class="modal-subtitle">Organized by store sections</div>
    </div>
    <div class="modal-body">
      <div id="shoppingContent"></div>
    </div>
    <div class="modal-footer">
      <button id="shoppingShareBtn" class="btn btn-primary" style="flex: 1;">Share List</button>
      <button id="shoppingCloseBtn" class="btn btn-glass" style="flex: 1;">Done</button>
    </div>
  </div>

  <!-- Weekly Summary Modal -->
  <div id="summaryModal" class="modal" role="dialog" aria-modal="true" style="display: none;">
    <div class="modal-header">
      <div class="modal-handle"></div>
      <h2 class="modal-title">📤 Weekly Summary</h2>
      <div class="modal-subtitle">Meal plan & shopping list combined</div>
    </div>
    <div class="modal-body">
      <div class="share-content">
        <div id="summaryPreview" class="share-preview"></div>
      </div>
    </div>
    <div class="modal-footer">
      <button id="summaryShareBtn" class="btn btn-primary" style="flex: 1;">Share Plan</button>
      <button id="summaryCloseBtn" class="btn btn-glass" style="flex: 1;">Done</button>
    </div>
  </div>

</div>

<script>
/* ========= Enhanced Meal Database ========== */
const MEALS = {
  lunch: {
    'Quick & Light': [
      { emoji: '🍝', name: 'Ravioli burro e salvia' },
      { emoji: '🍋', name: 'Spaghetti al limone' },
      { emoji: '🍳', name: 'Uova fritte' },
      { emoji: '🥪', name: 'Piadine prosciutto provolone' }
    ],
    'Pasta Classics': [
      { emoji: '🫘', name: 'Pasta e ceci' },
      { emoji: '🐟', name: 'Pasta col tonno' },
      { emoji: '🍅', name: 'Pasta sugo tonno' },
      { emoji: '🌿', name: 'Pasta al pesto' },
      { emoji: '🍅', name: 'Pasta coi pomodorini' },
      { emoji: '🧄', name: 'Spaghetti aglio e olio' },
      { emoji: '🥓', name: 'Carbonara' }
    ],
    'Hearty Options': [
      { emoji: '🫘', name: 'Lenticchie' },
      { emoji: '🍳', name: 'Frittata di pasta' },
      { emoji: '🫘', name: 'Pasta e fagioli' }
    ],
    'Special': [
      { emoji: '❌', name: 'None' },
      { emoji: '✏️', name: 'Custom…' }
    ]
  },
  dinner: {
    regular: {
      'Seafood': [
        { emoji: '🐟', name: 'Salmone col riso' },
        { emoji: '🐟', name: 'Merluzzo' }
      ],
      'Meat & Poultry': [
        { emoji: '🍖', name: 'Polpette' },
        { emoji: '🍋', name: 'Pollo al limone' },
        { emoji: '🍔', name: 'Hamburger' },
        { emoji: '🍗', name: 'Cotolette' },
        { emoji: '🌭', name: 'Salsicce' },
        { emoji: '🍗', name: 'Pollo al forno' },
        { emoji: '🍋', name: 'Scaloppine al limone' }
      ],
      'Vegetarian': [
        { emoji: '🥒', name: 'Frittata di zucchine' },
        { emoji: '🥕', name: 'Minestrone' },
        { emoji: '🍅', name: 'Caprese' }
      ],
      'Special': [
        { emoji: '❌', name: 'None' },
        { emoji: '✏️', name: 'Custom…' }
      ]
    },
    quick: {
      'Ready in Minutes': [
        { emoji: '🍗', name: 'Cordon bleu' },
        { emoji: '🌭', name: 'Wurstel' },
        { emoji: '🥟', name: 'Dumplings' },
        { emoji: '🐟', name: 'Fish sticks' },
        { emoji: '🍗', name: 'Pollo allo spiedo' }
      ],
      'Special': [
        { emoji: '❌', name: 'None' },
        { emoji: '✏️', name: 'Custom…' }
      ]
    },
    delivery: {
      'Popular Delivery': [
        { emoji: '🍕', name: 'Pizza Delivery' },
        { emoji: '🥙', name: 'Greco Delivery' },
        { emoji: '🥡', name: 'Chinese Delivery' },
        { emoji: '🍜', name: 'Vietnamese Delivery' },
        { emoji: '🍜', name: 'Ramen Delivery' }
      ],
      'Special': [
        { emoji: '❌', name: 'None' },
        { emoji: '✏️', name: 'Custom…' }
      ]
    },
    weekend: {
      'Weekend Specials': [
        { emoji: '🍝', name: 'Pasta al forno' },
        { emoji: '🍆', name: 'Parmigiana di melanzane' },
        { emoji: '🥒', name: 'Zucchine ripiene' },
        { emoji: '🍝', name: 'Lasagna' },
        { emoji: '🍝', name: 'Tortellini con la panna' },
        { emoji: '🍝', name: 'Tortellini col sugo' },
        { emoji: '🍝', name: 'Pasta col ragù' },
        { emoji: '🍝', name: 'Cannelloni' }
      ],
      'Premium Options': [
        { emoji: '🥩', name: 'Spezzatino con patate' },
        { emoji: '🍖', name: 'Polpettone' },
        { emoji: '🌽', name: 'Polenta col sugo' },
        { emoji: '🥩', name: 'Bistecca' }
      ],
      'Special': [
        { emoji: '❌', name: 'None' },
        { emoji: '✏️', name: 'Custom…' }
      ]
    }
  },
  side: {
    'Potato Dishes': [
      { emoji: '🥔', name: 'Purè di patate' },
      { emoji: '🥔', name: 'Tater tots' },
      { emoji: '🥔', name: 'Patate lesse' }
    ],
    'Fresh Vegetables': [
      { emoji: '🥦', name: 'Broccoli al vapore' },
      { emoji: '🥕', name: 'Carote al forno' },
      { emoji: '🥕', name: 'Carote a insalata' },
      { emoji: '🥒', name: 'Zucchine trifolate' }
    ],
    'Salads': [
      { emoji: '🍅', name: 'Insalata di pomodori' },
      { emoji: '🌽', name: 'Insalata di mais' },
      { emoji: '🥒', name: 'Insalata di cetrioli' },
      { emoji: '🥗', name: 'Insalata' }
    ],
    'Others': [
      { emoji: '🫐', name: 'Barbabietole' }
    ],
    'Special': [
      { emoji: '❌', name: 'None' },
      { emoji: '✏️', name: 'Custom…' }
    ]
  }
};

const INGREDIENTS = {
  "Ravioli burro e salvia": ["ravioli", "sage", "butter"],
  "Spaghetti al limone": ["spaghetti", "lemon", "olive oil"],
  "Pasta e ceci": ["pasta", "chickpeas", "rosemary"],
  "Pasta col tonno": ["spaghetti", "tuna", "capers"],
  "Pasta sugo tonno": ["pasta", "tuna", "tomato sauce"],
  "Piadine prosciutto provolone": ["flatbread", "prosciutto", "provolone"],
  "Uova fritte": ["eggs", "olive oil"],
  "Pasta al pesto": ["pasta", "pesto", "pine nuts"],
  "Pasta coi pomodorini": ["pasta", "cherry tomatoes", "basil"],
  "Lenticchie": ["lentils", "vegetables", "croutons"],
  "Spaghetti aglio e olio": ["spaghetti", "garlic", "olive oil", "chili"],
  "Carbonara": ["spaghetti", "eggs", "bacon", "parmesan"],
  "Frittata di pasta": ["eggs", "leftover pasta", "cheese"],
  "Pasta e fagioli": ["pasta", "beans", "vegetables"],
  "Salmone col riso": ["salmon", "rice", "vegetables"],
  "Frittata di zucchine": ["eggs", "zucchini", "cheese"],
  "Polpette": ["ground beef", "breadcrumbs", "eggs", "tomato sauce"],
  "Pollo al limone": ["chicken breast", "lemon", "herbs"],
  "Merluzzo": ["cod", "vegetables", "olive oil"],
  "Hamburger": ["burger buns", "ground beef", "cheese", "lettuce", "tomato"],
  "Cotolette": ["cutlets", "breadcrumbs", "eggs"],
  "Salsicce": ["sausages", "vegetables"],
  "Minestrone": ["mixed vegetables", "pasta", "beans"],
  "Pollo al forno": ["chicken thighs", "potatoes", "herbs"],
  "Scaloppine al limone": ["veal cutlets", "lemon", "capers"],
  "Caprese": ["mozzarella", "tomatoes", "basil"]
};

const STORE_CATEGORIES = {
  "🥩 Meat & Fish": ["ground beef", "chicken breast", "chicken thighs", "sausages", "bacon", "salmon", "cod", "tuna", "cutlets", "veal cutlets"],
  "🥬 Fresh Produce": ["tomatoes", "basil", "zucchini", "carrots", "broccoli", "lettuce", "cherry tomatoes", "lemon", "garlic", "onions", "beets", "corn", "cucumbers", "mixed greens", "vegetables"],
  "🧀 Dairy & Eggs": ["eggs", "milk", "butter", "cheese", "mozzarella", "parmesan", "provolone"],
  "🍞 Pantry Essentials": ["pasta", "spaghetti", "rice", "breadcrumbs", "olive oil", "tomato sauce", "pesto", "capers", "pine nuts", "chickpeas", "lentils", "beans", "herbs", "rosemary", "chili"],
  "🥖 Bakery": ["flatbread", "burger buns", "bread"],
  "🍖 Deli": ["prosciutto"],
  "❄️ Frozen": ["frozen tater tots", "ravioli"]
};

/* ========= State Management ========= */
class MealPlannerState {
  constructor() {
    this.weekendEnabled = true;
    this.meals = {};
    this.currentModal = null;
    this.currentSelection = null;
    this.init();
  }

  init() {
    this.generateWeekKeys();
  }

  generateWeekKeys() {
    const today = new Date();
    const monday = new Date(today);
    const dayOfWeek = today.getDay();
    const daysUntilMonday = dayOfWeek === 0 ? 1 : 8 - dayOfWeek;
    monday.setDate(today.getDate() + daysUntilMonday);

    this.weekStart = monday;
    this.weekKeys = [];
    
    for (let i = 0; i < 7; i++) {
      const date = new Date(monday);
      date.setDate(monday.getDate() + i);
      const key = `${date.getFullYear()}-${date.getMonth() + 1}-${date.getDate()}`;
      this.weekKeys.push(key);
      
      if (!this.meals[key]) {
        this.meals[key] = {
          lunch: "",
          dinner: "",
          side: "",
          mode: "regular"
        };
      }
    }
  }

  updateMeal(dayKey, mealType, value) {
    this.meals[dayKey][mealType] = value;
  }

  updateMode(dayKey, mode) {
    const dayMeals = this.meals[dayKey];
    const isWeekend = this.weekKeys.indexOf(dayKey) >= 5;
    
    dayMeals.mode = mode;
    
    // Clear dinner if it's not available in the new mode
    if (dayMeals.dinner) {
      const currentMeal = dayMeals.dinner;
      let isAvailable = false;
      
      let optionsToCheck = [];
      switch (mode) {
        case 'quick':
          optionsToCheck = Object.values(MEALS.dinner.quick).flat();
          break;
        case 'delivery':
          optionsToCheck = Object.values(MEALS.dinner.delivery).flat();
          dayMeals.side = ""; // Clear side for delivery
          break;
        default:
          optionsToCheck = Object.values(isWeekend ? MEALS.dinner.weekend : MEALS.dinner.regular).flat();
      }
      
      isAvailable = optionsToCheck.some(meal => meal.name === currentMeal);
      
      if (!isAvailable) {
        dayMeals.dinner = "";
      }
    }
    
    // Always clear side for delivery mode
    if (mode === 'delivery') {
      dayMeals.side = "";
    }
  }

  clearAll() {
    this.weekKeys.forEach(key => {
      if (this.meals[key]) {
        this.meals[key] = {
          lunch: "",
          dinner: "",
          side: "",
          mode: this.meals[key].mode
        };
      }
    });
  }

  randomizeDay(dayKey) {
    const dayMeals = this.meals[dayKey];
    const index = this.weekKeys.indexOf(dayKey);
    const isWeekend = index >= 5;
    
    // Get all options for each meal type
    const lunchOptions = Object.values(MEALS.lunch).flat().filter(m => !['None', 'Custom…'].includes(m.name));
    dayMeals.lunch = lunchOptions[Math.floor(Math.random() * lunchOptions.length)].name;
    
    let dinnerOptions = [];
    switch (dayMeals.mode) {
      case 'quick':
        dinnerOptions = Object.values(MEALS.dinner.quick).flat().filter(m => !['None', 'Custom…'].includes(m.name));
        break;
      case 'delivery':
        dinnerOptions = Object.values(MEALS.dinner.delivery).flat().filter(m => !['None', 'Custom…'].includes(m.name));
        break;
      default:
        dinnerOptions = Object.values(isWeekend ? MEALS.dinner.weekend : MEALS.dinner.regular).flat().filter(m => !['None', 'Custom…'].includes(m.name));
    }
    dayMeals.dinner = dinnerOptions[Math.floor(Math.random() * dinnerOptions.length)].name;
    
    // Randomize side (unless delivery)
    if (dayMeals.mode !== 'delivery') {
      const sideOptions = Object.values(MEALS.side).flat().filter(m => !['None', 'Custom…'].includes(m.name));
      dayMeals.side = sideOptions[Math.floor(Math.random() * sideOptions.length)].name;
    }
  }

  randomizeMeals() {
    this.weekKeys.forEach((key, index) => {
      if (index >= 5 && !this.weekendEnabled) return;
      this.randomizeDay(key);
    });
  }

  generateGroceryList() {
    const ingredients = new Map();
    
    this.weekKeys.forEach((key, index) => {
      if (index >= 5 && !this.weekendEnabled) return;
      
      const dayMeals = this.meals[key];
      ['lunch', 'dinner', 'side'].forEach(mealType => {
        const meal = dayMeals[mealType];
        if (meal && INGREDIENTS[meal]) {
          INGREDIENTS[meal].forEach(ingredient => {
            const count = ingredients.get(ingredient) || 0;
            ingredients.set(ingredient, count + 1);
          });
        }
      });
    });

    const categorized = {};
    Object.keys(STORE_CATEGORIES).forEach(category => {
      categorized[category] = [];
    });

    ingredients.forEach((count, ingredient) => {
      let placed = false;
      Object.entries(STORE_CATEGORIES).forEach(([category, items]) => {
        if (items.includes(ingredient)) {
          categorized[category].push({ name: ingredient, count });
          placed = true;
        }
      });
      
      if (!placed) {
        if (!categorized["🛒 Other"]) categorized["🛒 Other"] = [];
        categorized["🛒 Other"].push({ name: ingredient, count });
      }
    });

    // Remove empty categories and sort items
    Object.keys(categorized).forEach(category => {
      if (categorized[category].length === 0) {
        delete categorized[category];
      } else {
        categorized[category].sort((a, b) => a.name.localeCompare(b.name));
      }
    });

    return categorized;
  }
}

/* ========= Revolutionary UI Controller ========= */
class MealPlannerUI {
  constructor() {
    this.state = new MealPlannerState();
    this.initializeElements();
    this.bindEvents();
    this.render();
  }

  initializeElements() {
    this.elements = {
      // Main elements
      weekendToggle: document.getElementById('weekendToggle'),
      clearBtn: document.getElementById('clearBtn'),
      bentoGrid: document.getElementById('bentoGrid'),
      dateRange: document.getElementById('dateRange'),
      
      // Navigation
      shuffleBtn: document.getElementById('shuffleBtn'),
      groceryBtn: document.getElementById('groceryBtn'),
      shareBtn: document.getElementById('shareBtn'),
      
      // Modal system
      modalOverlay: document.getElementById('modalOverlay'),
      
      // Meal selection modal
      mealModal: document.getElementById('mealModal'),
      mealModalTitle: document.getElementById('mealModalTitle'),
      mealModalSubtitle: document.getElementById('mealModalSubtitle'),
      mealCategories: document.getElementById('mealCategories'),
      customInputSection: document.getElementById('customInputSection'),
      customInput: document.getElementById('customInput'),
      customUseBtn: document.getElementById('customUseBtn'),
      mealModalClose: document.getElementById('mealModalClose'),
      
      // Shopping list modal
      shoppingModal: document.getElementById('shoppingModal'),
      shoppingContent: document.getElementById('shoppingContent'),
      shoppingShareBtn: document.getElementById('shoppingShareBtn'),
      shoppingCloseBtn: document.getElementById('shoppingCloseBtn'),
      
      // Summary modal
      summaryModal: document.getElementById('summaryModal'),
      summaryPreview: document.getElementById('summaryPreview'),
      summaryShareBtn: document.getElementById('summaryShareBtn'),
      summaryCloseBtn: document.getElementById('summaryCloseBtn')
    };
  }

  bindEvents() {
    // Weekend toggle
    this.elements.weekendToggle.addEventListener('click', () => {
      this.triggerHaptic('light');
      this.state.weekendEnabled = !this.state.weekendEnabled;
      this.render();
    });

    // Clear all
    this.elements.clearBtn.addEventListener('click', () => {
      if (confirm('🗑️ Clear all meals? This cannot be undone.')) {
        this.triggerHaptic('medium');
        this.state.clearAll();
        this.render();
      }
    });

    // Navigation buttons
    this.elements.shuffleBtn.addEventListener('click', () => {
      this.triggerHaptic('medium');
      this.elements.shuffleBtn.classList.add('haptic-medium');
      setTimeout(() => {
        this.elements.shuffleBtn.classList.remove('haptic-medium');
        this.state.randomizeMeals();
        this.render();
      }, 150);
    });

    this.elements.groceryBtn.addEventListener('click', () => {
      this.triggerHaptic('light');
      this.showShoppingModal();
    });

    this.elements.shareBtn.addEventListener('click', () => {
      this.triggerHaptic('light');
      this.showSummaryModal();
    });

    // Modal overlay
    this.elements.modalOverlay.addEventListener('click', (e) => {
      if (e.target === this.elements.modalOverlay) {
        this.closeAllModals();
      }
    });

    // Meal modal events
    this.elements.customUseBtn.addEventListener('click', () => this.useCustomMeal());
    this.elements.mealModalClose.addEventListener('click', () => this.closeMealModal());

    // Shopping modal events
    this.elements.shoppingShareBtn.addEventListener('click', () => this.shareShoppingList());
    this.elements.shoppingCloseBtn.addEventListener('click', () => this.closeShoppingModal());

    // Summary modal events
    this.elements.summaryShareBtn.addEventListener('click', () => this.shareSummary());
    this.elements.summaryCloseBtn.addEventListener('click', () => this.closeSummaryModal());

    // Custom input enter key
    this.elements.customInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        this.useCustomMeal();
      }
    });

    // Keyboard shortcuts
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        this.closeAllModals();
      }
    });
  }

  triggerHaptic(intensity = 'light') {
    if ('vibrate' in navigator) {
      const patterns = {
        light: 10,
        medium: [10, 10, 10],
        heavy: [20, 10, 20]
      };
      navigator.vibrate(patterns[intensity] || patterns.light);
    }
  }

  render() {
    this.renderHeader();
    this.renderBentoGrid();
    this.renderWeekendToggle();
  }

  renderHeader() {
    const endDate = new Date(this.state.weekStart);
    endDate.setDate(this.state.weekStart.getDate() + 6);
    
    this.elements.dateRange.textContent = 
      `${this.state.weekStart.toLocaleDateString('en-US', { month: 'short', day: 'numeric' })} – ${endDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric' })}`;
  }

  renderWeekendToggle() {
    this.elements.weekendToggle.classList.toggle('active', this.state.weekendEnabled);
    this.elements.weekendToggle.setAttribute('aria-checked', this.state.weekendEnabled);
  }

  renderBentoGrid() {
    const days = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'];
    const dayEmojis = ['📅', '📅', '📅', '📅', '📅', '🎉', '🎉'];
    
    this.elements.bentoGrid.innerHTML = '';

    this.state.weekKeys.forEach((key, index) => {
      if (index >= 5 && !this.state.weekendEnabled) return;

      const dayMeals = this.state.meals[key];
      const date = new Date(this.state.weekStart);
      date.setDate(this.state.weekStart.getDate() + index);

      const dayCard = document.createElement('div');
      dayCard.className = 'day-card fade-in-up';
      dayCard.style.animationDelay = `${index * 0.1}s`;
      
      dayCard.innerHTML = `
        <div class="day-header">
          <div class="day-info">
            <h3 class="day-name">${dayEmojis[index]} ${days[index]}</h3>
            <div class="day-date">${date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' })}</div>
          </div>
          <div class="day-actions">
            <button class="day-randomize" data-day="${key}" title="Randomize this day">
              🎲
            </button>
          </div>
        </div>

        <div class="meal-bento">
          <div class="meal-selector ${dayMeals.lunch ? 'has-value' : ''}" data-day="${key}" data-meal="lunch">
            <div class="meal-label">Lunch</div>
            ${dayMeals.lunch ? 
              `<div class="meal-emoji">${this.getMealEmoji(dayMeals.lunch)}</div>
               <div class="meal-value">${dayMeals.lunch}</div>` :
              `<div class="meal-placeholder">Tap to choose</div>`
            }
          </div>
          
          <div class="meal-selector ${dayMeals.dinner ? 'has-value' : ''}" data-day="${key}" data-meal="dinner">
            <div class="meal-label">Dinner</div>
            ${dayMeals.dinner ? 
              `<div class="meal-emoji">${this.getMealEmoji(dayMeals.dinner)}</div>
               <div class="meal-value">${dayMeals.dinner}</div>` :
              `<div class="meal-placeholder">Tap to choose</div>`
            }
          </div>
          
          <div class="meal-selector ${dayMeals.side && dayMeals.mode !== 'delivery' ? 'has-value' : ''}" 
               data-day="${key}" data-meal="side" 
               ${dayMeals.mode === 'delivery' ? 'style="opacity:0.4;pointer-events:none"' : ''}>
            <div class="meal-label">Side</div>
            ${dayMeals.mode === 'delivery' ? 
              `<div class="meal-placeholder">Not needed</div>` :
              (dayMeals.side ? 
                `<div class="meal-emoji">${this.getMealEmoji(dayMeals.side)}</div>
                 <div class="meal-value">${dayMeals.side}</div>` :
                `<div class="meal-placeholder">Tap to choose</div>`
              )
            }
          </div>
        </div>

        <div class="mode-bento">
          <button class="mode-btn ${dayMeals.mode === 'regular' ? 'active' : ''}" 
                  data-day="${key}" data-mode="regular">
            <span>Regular</span>
          </button>
          <button class="mode-btn ${dayMeals.mode === 'quick' ? 'active' : ''}" 
                  data-day="${key}" data-mode="quick">
            <span>Quick</span>
          </button>
          <button class="mode-btn ${dayMeals.mode === 'delivery' ? 'active' : ''}" 
                  data-day="${key}" data-mode="delivery">
            <span>Delivery</span>
          </button>
        </div>
      `;

      this.elements.bentoGrid.appendChild(dayCard);
    });

    // Add event listeners
    this.elements.bentoGrid.addEventListener('click', (e) => {
      const mealSelector = e.target.closest('.meal-selector');
      const modeBtn = e.target.closest('.mode-btn');
      const dayRandomize = e.target.closest('.day-randomize');

      if (mealSelector && !mealSelector.style.pointerEvents) {
        this.triggerHaptic('light');
        const dayKey = mealSelector.dataset.day;
        const mealType = mealSelector.dataset.meal;
        this.showMealModal(dayKey, mealType);
      } else if (modeBtn) {
        this.triggerHaptic('light');
        const dayKey = modeBtn.dataset.day;
        const mode = modeBtn.dataset.mode;
        this.state.updateMode(dayKey, mode);
        this.render();
      } else if (dayRandomize) {
        this.triggerHaptic('medium');
        const dayKey = dayRandomize.dataset.day;
        dayRandomize.classList.add('haptic-medium');
        setTimeout(() => {
          dayRandomize.classList.remove('haptic-medium');
          this.state.randomizeDay(dayKey);
          this.render();
        }, 200);
      }
    });
  }

  getMealEmoji(mealName) {
    // Search through all meals to find the emoji
    const allMeals = [
      ...Object.values(MEALS.lunch).flat(),
      ...Object.values(MEALS.dinner.regular).flat(),
      ...Object.values(MEALS.dinner.quick).flat(),
      ...Object.values(MEALS.dinner.delivery).flat(),
      ...Object.values(MEALS.dinner.weekend).flat(),
      ...Object.values(MEALS.side).flat()
    ];
    
    const meal = allMeals.find(m => m.name === mealName);
    return meal ? meal.emoji : '🍽️';
  }

  showMealModal(dayKey, mealType) {
    this.state.currentSelection = { dayKey, mealType };
    const dayMeals = this.state.meals[dayKey];
    const isWeekend = this.state.weekKeys.indexOf(dayKey) >= 5;

    // Set modal title
    this.elements.mealModalTitle.textContent = `Choose ${mealType.charAt(0).toUpperCase() + mealType.slice(1)}`;
    this.elements.mealModalSubtitle.textContent = 'Select from curated options or add custom';

    // Get appropriate meal options
    let mealOptions = {};
    if (mealType === 'lunch') {
      mealOptions = MEALS.lunch;
    } else if (mealType === 'dinner') {
      switch (dayMeals.mode) {
        case 'quick':
          mealOptions = MEALS.dinner.quick;
          break;
        case 'delivery':
          mealOptions = MEALS.dinner.delivery;
          break;
        default:
          mealOptions = isWeekend ? MEALS.dinner.weekend : MEALS.dinner.regular;
      }
    } else {
      mealOptions = MEALS.side;
    }

    this.renderMealOptions(mealOptions, dayMeals[mealType]);
    this.showModal('meal');
  }

  renderMealOptions(mealOptions, currentValue) {
    this.elements.mealCategories.innerHTML = '';
    this.elements.customInputSection.classList.remove('show');
    this.elements.customInput.value = '';

    Object.entries(mealOptions).forEach(([category, meals]) => {
      const categoryDiv = document.createElement('div');
      categoryDiv.className = 'meal-category';

      const headerDiv = document.createElement('div');
      headerDiv.className = 'category-header';
      headerDiv.textContent = category;
      categoryDiv.appendChild(headerDiv);

      meals.forEach(meal => {
        const optionDiv = document.createElement('div');
        optionDiv.className = `meal-option ${meal.name === currentValue ? 'selected' : ''}`;
        
        optionDiv.innerHTML = `
          <div class="meal-option-content">
            <span class="meal-option-emoji">${meal.emoji}</span>
            <span class="meal-option-text">${meal.name}</span>
          </div>
          <div class="meal-option-check">✓</div>
        `;
        
        optionDiv.addEventListener('click', () => {
          this.triggerHaptic('light');
          if (meal.name === 'Custom…') {
            this.elements.customInputSection.classList.add('show');
            setTimeout(() => this.elements.customInput.focus(), 300);
          } else {
            const value = meal.name === 'None' ? '' : meal.name;
            this.updateCurrentMeal(value);
            this.closeMealModal();
          }
        });

        categoryDiv.appendChild(optionDiv);
      });

      this.elements.mealCategories.appendChild(categoryDiv);
    });
  }

  useCustomMeal() {
    const customValue = this.elements.customInput.value.trim();
    if (customValue) {
      this.triggerHaptic('light');
      this.updateCurrentMeal(customValue);
      this.closeMealModal();
    }
  }

  updateCurrentMeal(value) {
    if (!this.state.currentSelection) return;
    
    const { dayKey, mealType } = this.state.currentSelection;
    this.state.updateMeal(dayKey, mealType, value);
    this.render();
  }

  showShoppingModal() {
    const groceryList = this.state.generateGroceryList();
    this.renderShoppingList(groceryList);
    this.showModal('shopping');
  }

  renderShoppingList(groceryList) {
    this.elements.shoppingContent.innerHTML = '';

    if (Object.keys(groceryList).length === 0) {
      this.elements.shoppingContent.innerHTML = `
        <div class="loading-state">
          <div class="loading-text">No ingredients found.<br>Add some meals first! 🍽️</div>
        </div>
      `;
      return;
    }

    Object.entries(groceryList).forEach(([category, items]) => {
      const section = document.createElement('div');
      section.className = 'list-section';
      
      const header = document.createElement('div');
      header.className = 'list-section-header';
      header.innerHTML = `
        <div class="list-section-title">
          <span class="section-emoji">${category.split(' ')[0]}</span>
          ${category}
        </div>
      `;
      section.appendChild(header);

      items.forEach(item => {
        const itemDiv = document.createElement('div');
        itemDiv.className = 'list-item';
        itemDiv.innerHTML = `
          <input type="checkbox" class="list-checkbox" id="item-${item.name}">
          <label class="list-label" for="item-${item.name}">${item.name}</label>
          ${item.count > 1 ? `<span class="list-count">${item.count}</span>` : ''}
        `;
        section.appendChild(itemDiv);
      });

      this.elements.shoppingContent.appendChild(section);
    });
  }

  showSummaryModal() {
    const summaryText = this.generateSummaryText();
    this.elements.summaryPreview.textContent = summaryText;
    this.showModal('summary');
  }

  generateSummaryText() {
    const days = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'];
    let text = '✨ Weekly Meal Plan\n';
    
    const endDate = new Date(this.state.weekStart);
    endDate.setDate(this.state.weekStart.getDate() + 6);
    text += `${this.state.weekStart.toLocaleDateString('en-US', { month: 'short', day: 'numeric' })} – ${endDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric' })}\n\n`;

    this.state.weekKeys.forEach((key, index) => {
      if (index >= 5 && !this.state.weekendEnabled) return;
      
      const dayMeals = this.state.meals[key];
      text += `${days[index]}\n`;
      
      if (dayMeals.lunch) text += `  🥙 Lunch: ${dayMeals.lunch}\n`;
      if (dayMeals.dinner) {
        text += `  🍽️ Dinner: ${dayMeals.dinner}`;
        if (dayMeals.side) text += ` with ${dayMeals.side}`;
        text += '\n';
      }
      
      if (!dayMeals.lunch && !dayMeals.dinner) {
        text += '  (No meals planned)\n';
      }
      
      text += '\n';
    });

    // Add grocery list
    const groceryList = this.state.generateGroceryList();
    if (Object.keys(groceryList).length > 0) {
      text += '🛒 Shopping List\n\n';
      Object.entries(groceryList).forEach(([category, items]) => {
        text += `${category}\n`;
        items.forEach(item => {
          text += `• ${item.name}${item.count > 1 ? ` ×${item.count}` : ''}\n`;
        });
        text += '\n';
      });
    }

    return text.trim();
  }

  generateShoppingText() {
    const groceryList = this.state.generateGroceryList();
    let text = '🛒 Shopping List\n\n';
    
    if (Object.keys(groceryList).length === 0) {
      return text + '(No ingredients needed)';
    }
    
    Object.entries(groceryList).forEach(([category, items]) => {
      text += `${category}\n`;
      items.forEach(item => {
        text += `• ${item.name}${item.count > 1 ? ` ×${item.count}` : ''}\n`;
      });
      text += '\n';
    });

    return text.trim();
  }

  async shareShoppingList() {
    const text = this.generateShoppingText();
    await this.shareText(text, '🛒 Shopping List', this.elements.shoppingShareBtn, 'shopping');
  }

  async shareSummary() {
    const text = this.generateSummaryText();
    await this.shareText(text, '✨ Weekly Meal Plan', this.elements.summaryShareBtn, 'summary');
  }

  async shareText(text, title, button, type) {
    this.triggerHaptic('light');
    
    if (navigator.share) {
      try {
        await navigator.share({ title, text });
        if (type === 'shopping') this.closeShoppingModal();
        if (type === 'summary') this.closeSummaryModal();
        return;
      } catch (err) {
        if (err.name !== 'AbortError') {
          console.error('Native share failed:', err);
        }
      }
    }
    
    // Fallback to clipboard
    try {
      await navigator.clipboard.writeText(text);
      button.innerHTML = '<span class="emoji">✅</span><span>Copied!</span>';
      setTimeout(() => {
        const originalText = type === 'shopping' ? 'Share List' : 'Share Plan';
        const originalEmoji = type === 'shopping' ? '📤' : '📤';
        button.innerHTML = `<span class="emoji">${originalEmoji}</span><span>${originalText}</span>`;
      }, 2000);
    } catch (err) {
      console.error('Clipboard fallback failed:', err);
    }
  }

  showModal(type) {
    // Hide all modals first
    this.elements.mealModal.style.display = 'none';
    this.elements.shoppingModal.style.display = 'none';
    this.elements.summaryModal.style.display = 'none';
    
    // Show the requested modal
    switch (type) {
      case 'meal':
        this.elements.mealModal.style.display = 'flex';
        break;
      case 'shopping':
        this.elements.shoppingModal.style.display = 'flex';
        break;
      case 'summary':
        this.elements.summaryModal.style.display = 'flex';
        break;
    }
    
    // Show overlay
    this.elements.modalOverlay.classList.add('show');
    document.body.style.overflow = 'hidden';
    this.state.currentModal = type;
  }

  hideModal() {
    this.elements.modalOverlay.classList.remove('show');
    document.body.style.overflow = '';
    
    // Hide all modals after transition
    setTimeout(() => {
      this.elements.mealModal.style.display = 'none';
      this.elements.shoppingModal.style.display = 'none';
      this.elements.summaryModal.style.display = 'none';
    }, 400);
    
    this.state.currentModal = null;
  }

  closeMealModal() {
    this.hideModal();
    this.state.currentSelection = null;
  }

  closeShoppingModal() {
    this.hideModal();
  }

  closeSummaryModal() {
    this.hideModal();
  }

  closeAllModals() {
    this.closeMealModal();
    this.closeShoppingModal();
    this.closeSummaryModal();
  }
}

/* ========= Initialize Revolutionary App ========= */
document.addEventListener('DOMContentLoaded', () => {
  window.mealPlanner = new MealPlannerUI();
  
  // Add global haptic feedback
  document.addEventListener('click', (e) => {
    if (e.target.closest('.btn, .meal-selector, .mode-btn, .day-randomize, .meal-option')) {
      if ('vibrate' in navigator) {
        navigator.vibrate(8);
      }
    }
  });

  console.log('🚀 Revolutionary Meal Planner 2025 loaded successfully!');
});
</script>

</body>
</html>
