<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="theme-color" content="#000000">
<title>MealMaster Pro - Smart Meal Planning</title>
<style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  -webkit-tap-highlight-color: transparent;
}

:root {
  --safe-top: env(safe-area-inset-top);
  --safe-bottom: env(safe-area-inset-bottom);
  --safe-left: env(safe-area-inset-left);
  --safe-right: env(safe-area-inset-right);
  
  --primary: #6366f1;
  --primary-light: #818cf8;
  --primary-dark: #4f46e5;
  --secondary: #f59e0b;
  --success: #10b981;
  --danger: #ef4444;
  --warning: #f59e0b;
  --info: #06b6d4;
  
  --bg-primary: #000000;
  --bg-secondary: #0a0a0a;
  --bg-card: rgba(255, 255, 255, 0.02);
  --bg-glass: rgba(255, 255, 255, 0.04);
  --bg-hover: rgba(255, 255, 255, 0.08);
  
  --text-primary: #ffffff;
  --text-secondary: rgba(255, 255, 255, 0.8);
  --text-tertiary: rgba(255, 255, 255, 0.5);
  
  --border: rgba(255, 255, 255, 0.08);
  --border-light: rgba(255, 255, 255, 0.04);
  
  --shadow: 0 20px 40px rgba(0, 0, 0, 0.8);
  --glow: 0 0 40px rgba(99, 102, 241, 0.5);
  
  --ease-out: cubic-bezier(0.22, 1, 0.36, 1);
  --ease-spring: cubic-bezier(0.175, 0.885, 0.32, 1.275);
}

body {
  font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', system-ui, sans-serif;
  background: #000000;
  color: var(--text-primary);
  min-height: 100vh;
  overflow-x: hidden;
  position: relative;
  -webkit-font-smoothing: antialiased;
}

.background-effects {
  position: fixed;
  inset: 0;
  pointer-events: none;
  z-index: 0;
}

.gradient-orb {
  position: absolute;
  width: 600px;
  height: 600px;
  border-radius: 50%;
  filter: blur(100px);
  opacity: 0.4;
  animation: float 20s ease-in-out infinite;
}

.gradient-orb:nth-child(1) {
  background: radial-gradient(circle, #6366f1, transparent);
  top: -200px;
  left: -200px;
  animation-delay: 0s;
}

.gradient-orb:nth-child(2) {
  background: radial-gradient(circle, #f59e0b, transparent);
  bottom: -200px;
  right: -200px;
  animation-delay: 5s;
}

.gradient-orb:nth-child(3) {
  background: radial-gradient(circle, #10b981, transparent);
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  animation-delay: 10s;
}

@keyframes float {
  0%, 100% { transform: translate(0, 0) scale(1); }
  33% { transform: translate(30px, -30px) scale(1.1); }
  66% { transform: translate(-20px, 20px) scale(0.9); }
}

.app-container {
  position: relative;
  z-index: 1;
  min-height: 100vh;
  display: flex;
  flex-direction: column;
}

/* Header Section */
.header {
  position: sticky;
  top: 0;
  z-index: 100;
  padding-top: var(--safe-top);
  background: rgba(0, 0, 0, 0.7);
  backdrop-filter: blur(20px) saturate(180%);
  -webkit-backdrop-filter: blur(20px) saturate(180%);
  border-bottom: 1px solid var(--border);
}

.header-main {
  padding: 20px;
}

.header-top {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 16px;
}

.app-logo {
  display: flex;
  align-items: center;
  gap: 12px;
}

.logo-icon {
  width: 36px;
  height: 36px;
  background: linear-gradient(135deg, var(--primary), var(--secondary));
  border-radius: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 20px;
  font-weight: bold;
  box-shadow: 0 4px 12px rgba(99, 102, 241, 0.4);
}

.app-title {
  font-size: 24px;
  font-weight: 800;
  letter-spacing: -0.5px;
  background: linear-gradient(135deg, var(--primary-light), var(--secondary));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}

.header-actions {
  display: flex;
  gap: 12px;
}

.icon-btn {
  width: 36px;
  height: 36px;
  background: var(--bg-glass);
  border: 1px solid var(--border);
  border-radius: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  color: var(--text-primary);
  font-size: 18px;
  transition: all 0.3s var(--ease-out);
}

.icon-btn:active {
  transform: scale(0.9);
  background: var(--bg-hover);
}

.user-profile {
  width: 36px;
  height: 36px;
  background: linear-gradient(135deg, var(--primary), var(--secondary));
  border-radius: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 14px;
  font-weight: bold;
  color: white;
  box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
}

/* Stats Bar */
.stats-bar {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 8px;
  padding: 12px 0;
}

.stat-item {
  text-align: center;
  padding: 8px;
  background: var(--bg-glass);
  border-radius: 12px;
  border: 1px solid var(--border);
}

.stat-value {
  font-size: 18px;
  font-weight: 700;
  color: var(--primary-light);
  display: block;
}

.stat-label {
  font-size: 10px;
  color: var(--text-tertiary);
  text-transform: uppercase;
  letter-spacing: 0.5px;
  margin-top: 2px;
}

/* Week Navigation */
.week-navigation {
  padding: 16px 20px;
  background: var(--bg-secondary);
  border-bottom: 1px solid var(--border);
}

.week-selector-container {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 12px;
}

.week-nav-btn {
  width: 32px;
  height: 32px;
  background: var(--bg-glass);
  border: 1px solid var(--border);
  border-radius: 10px;
  display: flex;
  align-items: center;
  justify-content: center;
  color: var(--text-primary);
  transition: all 0.3s var(--ease-out);
}

.week-nav-btn:active {
  transform: scale(0.9);
}

.current-week {
  text-align: center;
  flex: 1;
}

.week-label {
  font-size: 12px;
  color: var(--text-tertiary);
  text-transform: uppercase;
  letter-spacing: 1px;
}

.week-dates {
  font-size: 16px;
  font-weight: 600;
  color: var(--text-primary);
  margin-top: 4px;
}

.quick-filters {
  display: flex;
  gap: 8px;
  overflow-x: auto;
  padding: 4px 0;
  -webkit-overflow-scrolling: touch;
  scrollbar-width: none;
}

.quick-filters::-webkit-scrollbar {
  display: none;
}

.filter-chip {
  padding: 8px 16px;
  background: var(--bg-glass);
  border: 1px solid var(--border);
  border-radius: 20px;
  font-size: 13px;
  color: var(--text-secondary);
  white-space: nowrap;
  transition: all 0.3s var(--ease-out);
  flex-shrink: 0;
}

.filter-chip.active {
  background: var(--primary);
  border-color: var(--primary);
  color: white;
}

/* Main Content Area */
.main-content {
  flex: 1;
  padding: 16px 20px;
  padding-bottom: calc(80px + var(--safe-bottom));
}

/* Day Cards Enhanced */
.days-container {
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.day-card {
  background: var(--bg-glass);
  backdrop-filter: blur(20px);
  border: 1px solid var(--border);
  border-radius: 20px;
  overflow: hidden;
  transition: all 0.3s var(--ease-out);
  position: relative;
}

.day-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 3px;
  background: linear-gradient(90deg, var(--primary), var(--secondary));
  opacity: 0;
  transition: opacity 0.3s;
}

.day-card.has-meals::before {
  opacity: 1;
}

.day-card:active {
  transform: scale(0.98);
}

.day-card-header {
  padding: 16px;
  background: var(--bg-hover);
  border-bottom: 1px solid var(--border);
}

.day-card-top {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 8px;
}

.day-info {
  flex: 1;
}

.day-name {
  font-size: 18px;
  font-weight: 700;
  color: var(--text-primary);
}

.day-date {
  font-size: 12px;
  color: var(--text-tertiary);
  margin-top: 2px;
}

.day-actions {
  display: flex;
  gap: 8px;
}

.day-action-btn {
  width: 28px;
  height: 28px;
  background: var(--bg-glass);
  border: 1px solid var(--border);
  border-radius: 8px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 14px;
  color: var(--text-secondary);
  transition: all 0.3s var(--ease-out);
}

.day-action-btn:active {
  transform: scale(0.9);
}

.day-badges {
  display: flex;
  gap: 6px;
  flex-wrap: wrap;
}

.day-badge {
  padding: 4px 8px;
  background: var(--bg-glass);
  border: 1px solid var(--border);
  border-radius: 8px;
  font-size: 10px;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  display: flex;
  align-items: center;
  gap: 4px;
}

.badge-family {
  border-color: rgba(99, 102, 241, 0.3);
  color: var(--primary-light);
}

.badge-prep {
  border-color: rgba(245, 158, 11, 0.3);
  color: var(--warning);
}

.badge-quick {
  border-color: rgba(16, 185, 129, 0.3);
  color: var(--success);
}

.day-card-content {
  padding: 16px;
}

.meal-slots {
  display: flex;
  flex-direction: column;
  gap: 10px;
}

.meal-slot {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 12px;
  background: var(--bg-hover);
  border-radius: 12px;
  border: 1px solid var(--border);
  position: relative;
  overflow: hidden;
}

.meal-slot::after {
  content: '';
  position: absolute;
  left: 0;
  top: 0;
  bottom: 0;
  width: 3px;
  background: currentColor;
}

.meal-slot.breakfast { color: #fbbf24; }
.meal-slot.lunch { color: #60a5fa; }
.meal-slot.dinner { color: #a78bfa; }
.meal-slot.snack { color: #10b981; }

.meal-icon {
  width: 32px;
  height: 32px;
  background: currentColor;
  border-radius: 8px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 16px;
  color: var(--bg-primary);
  opacity: 0.9;
}

.meal-info {
  flex: 1;
  min-width: 0;
}

.meal-title {
  font-size: 14px;
  font-weight: 600;
  color: var(--text-primary);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.meal-details {
  font-size: 11px;
  color: var(--text-tertiary);
  margin-top: 2px;
  display: flex;
  gap: 8px;
}

.meal-tag {
  display: inline-flex;
  align-items: center;
  gap: 3px;
}

.meal-actions {
  display: flex;
  gap: 6px;
}

.meal-action {
  width: 24px;
  height: 24px;
  background: var(--bg-glass);
  border: 1px solid var(--border);
  border-radius: 6px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 12px;
  color: var(--text-tertiary);
  transition: all 0.3s var(--ease-out);
}

.empty-meal-slot {
  padding: 20px;
  text-align: center;
  background: var(--bg-hover);
  border: 1px dashed var(--border);
  border-radius: 12px;
  color: var(--text-tertiary);
  font-size: 13px;
}

/* Bottom Navigation Enhanced */
.bottom-nav {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  background: rgba(0, 0, 0, 0.9);
  backdrop-filter: blur(20px);
  border-top: 1px solid var(--border);
  padding-bottom: var(--safe-bottom);
  z-index: 100;
}

.nav-container {
  display: flex;
  padding: 8px 16px;
}

.nav-item {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 4px;
  padding: 8px;
  border-radius: 12px;
  transition: all 0.3s var(--ease-out);
  position: relative;
}

.nav-item.active {
  background: var(--bg-hover);
}

.nav-icon {
  font-size: 20px;
  transition: all 0.3s var(--ease-spring);
}

.nav-label {
  font-size: 10px;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  opacity: 0.6;
}

.nav-item.active .nav-icon {
  transform: scale(1.1);
}

.nav-item.active .nav-label {
  opacity: 1;
}

.nav-item.home { color: var(--primary-light); }
.nav-item.recipes { color: var(--warning); }
.nav-item.shopping { color: var(--success); }
.nav-item.insights { color: var(--info); }
.nav-item.family { color: var(--danger); }

/* Floating Action Button */
.fab-container {
  position: fixed;
  bottom: calc(80px + var(--safe-bottom));
  right: 20px;
  z-index: 99;
}

.fab {
  width: 56px;
  height: 56px;
  background: linear-gradient(135deg, var(--primary), var(--secondary));
  border-radius: 28px;
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: 0 8px 24px rgba(99, 102, 241, 0.5);
  transition: all 0.3s var(--ease-spring);
  position: relative;
}

.fab:active {
  transform: scale(0.9);
}

.fab-icon {
  font-size: 24px;
  color: white;
  transition: transform 0.3s var(--ease-spring);
}

.fab.open .fab-icon {
  transform: rotate(45deg);
}

.fab-menu {
  position: absolute;
  bottom: 70px;
  right: 0;
  display: flex;
  flex-direction: column;
  gap: 12px;
  opacity: 0;
  pointer-events: none;
  transition: all 0.3s var(--ease-out);
}

.fab-menu.open {
  opacity: 1;
  pointer-events: all;
}

.fab-option {
  display: flex;
  align-items: center;
  gap: 12px;
  white-space: nowrap;
}

.fab-option-label {
  padding: 8px 12px;
  background: var(--bg-secondary);
  border: 1px solid var(--border);
  border-radius: 8px;
  font-size: 13px;
  color: var(--text-primary);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
}

.fab-option-btn {
  width: 44px;
  height: 44px;
  background: var(--bg-secondary);
  border: 1px solid var(--border);
  border-radius: 22px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 18px;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
  transform: scale(0);
  transition: transform 0.3s var(--ease-spring);
}

.fab-menu.open .fab-option-btn {
  transform: scale(1);
}

.fab-menu.open .fab-option-btn:nth-child(1) { transition-delay: 0.05s; }
.fab-menu.open .fab-option-btn:nth-child(2) { transition-delay: 0.1s; }
.fab-menu.open .fab-option-btn:nth-child(3) { transition-delay: 0.15s; }

/* Modal System Enhanced */
.modal {
  position: fixed;
  inset: 0;
  z-index: 1000;
  display: flex;
  align-items: flex-end;
  background: rgba(0, 0, 0, 0.8);
  backdrop-filter: blur(10px);
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.3s var(--ease-out);
}

.modal.active {
  opacity: 1;
  pointer-events: all;
}

.modal-sheet {
  width: 100%;
  max-height: 90vh;
  background: var(--bg-secondary);
  border-radius: 24px 24px 0 0;
  transform: translateY(100%);
  transition: transform 0.4s var(--ease-spring);
  display: flex;
  flex-direction: column;
}

.modal.active .modal-sheet {
  transform: translateY(0);
}

.modal-header {
  padding: 20px;
  border-bottom: 1px solid var(--border);
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.modal-title {
  font-size: 20px;
  font-weight: 700;
  color: var(--text-primary);
}

.modal-close {
  width: 32px;
  height: 32px;
  background: var(--bg-glass);
  border: 1px solid var(--border);
  border-radius: 16px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 16px;
  color: var(--text-secondary);
}

.modal-body {
  flex: 1;
  overflow-y: auto;
  padding: 20px;
  -webkit-overflow-scrolling: touch;
}

/* Meal Editor */
.meal-editor {
  display: flex;
  flex-direction: column;
  gap: 20px;
}

.editor-section {
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.section-title {
  font-size: 14px;
  font-weight: 600;
  color: var(--text-secondary);
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.meal-search {
  padding: 12px 16px;
  background: var(--bg-glass);
  border: 1px solid var(--border);
  border-radius: 12px;
  color: var(--text-primary);
  font-size: 14px;
  width: 100%;
}

.meal-search::placeholder {
  color: var(--text-tertiary);
}

.suggestion-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 8px;
}

.suggestion-card {
  padding: 12px;
  background: var(--bg-glass);
  border: 1px solid var(--border);
  border-radius: 12px;
  transition: all 0.3s var(--ease-out);
  position: relative;
  overflow: hidden;
}

.suggestion-card:active {
  transform: scale(0.95);
  background: var(--bg-hover);
}

.suggestion-card.selected {
  border-color: var(--primary);
  background: rgba(99, 102, 241, 0.1);
}

.suggestion-name {
  font-size: 13px;
  font-weight: 600;
  color: var(--text-primary);
}

.suggestion-meta {
  font-size: 11px;
  color: var(--text-tertiary);
  margin-top: 4px;
  display: flex;
  gap: 8px;
}

.suggestion-tag {
  display: inline-flex;
  align-items: center;
  gap: 2px;
}

/* Family Members Section */
.family-selector {
  display: flex;
  gap: 8px;
  overflow-x: auto;
  padding: 4px 0;
  -webkit-overflow-scrolling: touch;
}

.family-member {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 4px;
  padding: 8px;
  background: var(--bg-glass);
  border: 1px solid var(--border);
  border-radius: 12px;
  min-width: 64px;
  transition: all 0.3s var(--ease-out);
}

.family-member.selected {
  background: rgba(99, 102, 241, 0.2);
  border-color: var(--primary);
}

.member-avatar {
  width: 32px;
  height: 32px;
  background: linear-gradient(135deg, var(--primary), var(--secondary));
  border-radius: 16px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 14px;
  font-weight: bold;
  color: white;
}

.member-name {
  font-size: 11px;
  color: var(--text-secondary);
}

/* Nutrition Info */
.nutrition-summary {
  padding: 16px;
  background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), var(--bg-glass));
  border: 1px solid var(--border);
  border-radius: 16px;
}

.nutrition-grid {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 12px;
  text-align: center;
}

.nutrition-item {
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.nutrition-value {
  font-size: 16px;
  font-weight: 700;
  color: var(--primary-light);
}

.nutrition-label {
  font-size: 10px;
  color: var(--text-tertiary);
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

/* Shopping List */
.shopping-categories {
  display: flex;
  flex-direction: column;
  gap: 16px;
}

.category-section {
  background: var(--bg-glass);
  border: 1px solid var(--border);
  border-radius: 16px;
  overflow: hidden;
}

.category-header {
  padding: 12px 16px;
  background: var(--bg-hover);
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.category-name {
  font-size: 14px;
  font-weight: 600;
  color: var(--text-primary);
}

.category-count {
  padding: 4px 8px;
  background: var(--bg-glass);
  border-radius: 12px;
  font-size: 11px;
  color: var(--text-secondary);
}

.shopping-items {
  padding: 8px;
}

.shopping-item {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 8px;
  border-radius: 8px;
  transition: all 0.3s var(--ease-out);
}

.shopping-item:active {
  background: var(--bg-hover);
}

.item-checkbox {
  width: 20px;
  height: 20px;
  border: 2px solid var(--border);
  border-radius: 6px;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.3s var(--ease-out);
}

.item-checkbox.checked {
  background: var(--primary);
  border-color: var(--primary);
}

.item-checkbox.checked::after {
  content: '✓';
  color: white;
  font-size: 12px;
  font-weight: bold;
}

.item-details {
  flex: 1;
}

.item-name {
  font-size: 14px;
  color: var(--text-primary);
  transition: all 0.3s var(--ease-out);
}

.shopping-item.checked .item-name {
  opacity: 0.5;
  text-decoration: line-through;
}

.item-quantity {
  font-size: 12px;
  color: var(--text-tertiary);
}

/* Analytics Dashboard */
.analytics-container {
  display: flex;
  flex-direction: column;
  gap: 16px;
}

.metric-card {
  padding: 16px;
  background: var(--bg-glass);
  border: 1px solid var(--border);
  border-radius: 16px;
}

.metric-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 12px;
}

.metric-title {
  font-size: 14px;
  font-weight: 600;
  color: var(--text-secondary);
}

.metric-trend {
  display: flex;
  align-items: center;
  gap: 4px;
  font-size: 12px;
}

.trend-up {
  color: var(--success);
}

.trend-down {
  color: var(--danger);
}

.metric-value {
  font-size: 28px;
  font-weight: 800;
  color: var(--text-primary);
  margin-bottom: 8px;
}

.metric-chart {
  height: 60px;
  background: linear-gradient(90deg, var(--primary) 0%, var(--secondary) 100%);
  opacity: 0.2;
  border-radius: 8px;
  position: relative;
  overflow: hidden;
}

.chart-fill {
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  background: linear-gradient(90deg, var(--primary) 0%, var(--secondary) 100%);
  opacity: 0.8;
  height: 40%;
  border-radius: 8px;
}

/* Recipe Browser */
.recipe-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 12px;
}

.recipe-card {
  background: var(--bg-glass);
  border: 1px solid var(--border);
  border-radius: 16px;
  overflow: hidden;
  transition: all 0.3s var(--ease-out);
}

.recipe-card:active {
  transform: scale(0.95);
}

.recipe-image {
  width: 100%;
  height: 100px;
  background: linear-gradient(135deg, var(--primary), var(--secondary));
  position: relative;
}

.recipe-time {
  position: absolute;
  top: 8px;
  right: 8px;
  padding: 4px 8px;
  background: rgba(0, 0, 0, 0.7);
  backdrop-filter: blur(10px);
  border-radius: 8px;
  font-size: 11px;
  color: white;
}

.recipe-difficulty {
  position: absolute;
  bottom: 8px;
  left: 8px;
  padding: 4px 8px;
  background: rgba(0, 0, 0, 0.7);
  backdrop-filter: blur(10px);
  border-radius: 8px;
  font-size: 11px;
  color: white;
}

.recipe-content {
  padding: 12px;
}

.recipe-name {
  font-size: 14px;
  font-weight: 600;
  color: var(--text-primary);
  margin-bottom: 4px;
}

.recipe-tags {
  display: flex;
  gap: 4px;
  flex-wrap: wrap;
}

.recipe-tag {
  padding: 2px 6px;
  background: var(--bg-hover);
  border-radius: 4px;
  font-size: 10px;
  color: var(--text-tertiary);
}

/* Settings Panel */
.settings-sections {
  display: flex;
  flex-direction: column;
  gap: 16px;
}

.settings-group {
  background: var(--bg-glass);
  border: 1px solid var(--border);
  border-radius: 16px;
  overflow: hidden;
}

.settings-group-title {
  padding: 12px 16px;
  background: var(--bg-hover);
  font-size: 14px;
  font-weight: 600;
  color: var(--text-primary);
}

.settings-items {
  padding: 8px;
}

.setting-item {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 12px 8px;
  border-bottom: 1px solid var(--border);
}

.setting-item:last-child {
  border-bottom: none;
}

.setting-info {
  flex: 1;
}

.setting-label {
  font-size: 14px;
  color: var(--text-primary);
  margin-bottom: 2px;
}

.setting-description {
  font-size: 11px;
  color: var(--text-tertiary);
}

.switch {
  position: relative;
  width: 48px;
  height: 28px;
  background: rgba(255, 255, 255, 0.1);
  border-radius: 14px;
  border: 1px solid var(--border);
  transition: all 0.3s var(--ease-out);
}

.switch::after {
  content: '';
  position: absolute;
  width: 24px;
  height: 24px;
  background: white;
  border-radius: 12px;
  top: 2px;
  left: 2px;
  transition: all 0.3s var(--ease-spring);
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
}

.switch.active {
  background: var(--primary);
  border-color: var(--primary);
}

.switch.active::after {
  transform: translateX(20px);
}

/* Toasts & Notifications */
.toast-container {
  position: fixed;
  top: calc(var(--safe-top) + 20px);
  left: 20px;
  right: 20px;
  z-index: 10000;
  pointer-events: none;
}

.toast {
  background: var(--bg-secondary);
  backdrop-filter: blur(20px);
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 12px 16px;
  margin-bottom: 8px;
  display: flex;
  align-items: center;
  gap: 12px;
  box-shadow: 0 8px 24px rgba(0, 0, 0, 0.5);
  transform: translateY(-20px);
  opacity: 0;
  transition: all 0.3s var(--ease-out);
  pointer-events: all;
}

.toast.show {
  transform: translateY(0);
  opacity: 1;
}

.toast-icon {
  width: 24px;
  height: 24px;
  background: var(--primary);
  border-radius: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 12px;
  color: white;
}

.toast-content {
  flex: 1;
}

.toast-title {
  font-size: 13px;
  font-weight: 600;
  color: var(--text-primary);
}

.toast-message {
  font-size: 11px;
  color: var(--text-secondary);
  margin-top: 2px;
}

/* Loading States */
.skeleton {
  background: linear-gradient(90deg, var(--bg-glass) 25%, var(--bg-hover) 50%, var(--bg-glass) 75%);
  background-size: 200% 100%;
  animation: skeleton 1.5s infinite;
}

@keyframes skeleton {
  0% { background-position: 200% 0; }
  100% { background-position: -200% 0; }
}

/* Responsive Adjustments */
@media (max-width: 375px) {
  .header-main {
    padding: 16px;
  }
  
  .app-title {
    font-size: 20px;
  }
  
  .stat-item {
    padding: 6px;
  }
  
  .stat-value {
    font-size: 16px;
  }
  
  .recipe-grid {
    grid-template-columns: 1fr;
  }
  
  .suggestion-grid {
    grid-template-columns: 1fr;
  }
}

/* Prevent overscroll */
html, body {
  overscroll-behavior: none;
  -webkit-overflow-scrolling: touch;
}

/* Performance optimizations */
* {
  will-change: auto;
  -webkit-backface-visibility: hidden;
  backface-visibility: hidden;
}

.day-card,
.meal-slot,
.fab,
.modal-sheet {
  will-change: transform;
}
</style>
</head>
<body>
  <!-- Background Effects -->
  <div class="background-effects">
    <div class="gradient-orb"></div>
    <div class="gradient-orb"></div>
    <div class="gradient-orb"></div>
  </div>

  <!-- App Container -->
  <div class="app-container">
    <!-- Header -->
    <header class="header">
      <div class="header-main">
        <div class="header-top">
          <div class="app-logo">
            <div class="logo-icon">🍽</div>
            <h1 class="app-title">MealMaster Pro</h1>
          </div>
          <div class="header-actions">
            <button class="icon-btn" id="notificationBtn">🔔</button>
            <button class="icon-btn" id="searchBtn">🔍</button>
            <div class="user-profile" id="userProfile">JD</div>
          </div>
        </div>
        
        <!-- Stats Bar -->
        <div class="stats-bar">
          <div class="stat-item">
            <span class="stat-value">24</span>
            <span class="stat-label">Meals</span>
          </div>
          <div class="stat-item">
            <span class="stat-value">$189</span>
            <span class="stat-label">Budget</span>
          </div>
          <div class="stat-item">
            <span class="stat-value">2.1k</span>
            <span class="stat-label">Cal/Day</span>
          </div>
          <div class="stat-item">
            <span class="stat-value">86%</span>
            <span class="stat-label">Healthy</span>
          </div>
        </div>
      </div>
    </header>

    <!-- Week Navigation -->
    <div class="week-navigation">
      <div class="week-selector-container">
        <button class="week-nav-btn" id="prevWeek">←</button>
        <div class="current-week">
          <div class="week-label">Week 44</div>
          <div class="week-dates" id="weekDates">Oct 28 - Nov 3</div>
        </div>
        <button class="week-nav-btn" id="nextWeek">→</button>
      </div>
      
      <!-- Quick Filters -->
      <div class="quick-filters">
        <button class="filter-chip active">All Meals</button>
        <button class="filter-chip">Vegetarian</button>
        <button class="filter-chip">Quick (< 30min)</button>
        <button class="filter-chip">Low Carb</button>
        <button class="filter-chip">Family Favorites</button>
        <button class="filter-chip">Meal Prep</button>
      </div>
    </div>

    <!-- Main Content -->
    <main class="main-content">
      <div class="days-container" id="daysContainer">
        <!-- Days will be rendered here -->
      </div>
    </main>

    <!-- Bottom Navigation -->
    <nav class="bottom-nav">
      <div class="nav-container">
        <button class="nav-item home active">
          <span class="nav-icon">🏠</span>
          <span class="nav-label">Plan</span>
        </button>
        <button class="nav-item recipes">
          <span class="nav-icon">📖</span>
          <span class="nav-label">Recipes</span>
        </button>
        <button class="nav-item shopping">
          <span class="nav-icon">🛒</span>
          <span class="nav-label">Shop</span>
        </button>
        <button class="nav-item insights">
          <span class="nav-icon">📊</span>
          <span class="nav-label">Insights</span>
        </button>
        <button class="nav-item family">
          <span class="nav-icon">👨‍👩‍👧‍👦</span>
          <span class="nav-label">Family</span>
        </button>
      </div>
    </nav>

    <!-- Floating Action Button -->
    <div class="fab-container">
      <div class="fab-menu" id="fabMenu">
        <div class="fab-option">
          <span class="fab-option-label">Quick Add</span>
          <button class="fab-option-btn">⚡</button>
        </div>
        <div class="fab-option">
          <span class="fab-option-label">AI Suggest</span>
          <button class="fab-option-btn">✨</button>
        </div>
        <div class="fab-option">
          <span class="fab-option-label">Scan Receipt</span>
          <button class="fab-option-btn">📷</button>
        </div>
      </div>
      <button class="fab" id="fabButton">
        <span class="fab-icon">+</span>
      </button>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Meal Editor Modal -->
    <div class="modal" id="mealModal">
      <div class="modal-sheet">
        <div class="modal-header">
          <h2 class="modal-title" id="modalTitle">Plan Your Meal</h2>
          <button class="modal-close" id="modalClose">✕</button>
        </div>
        <div class="modal-body">
          <div class="meal-editor">
            <!-- Search Section -->
            <div class="editor-section">
              <div class="section-title">Search or Choose</div>
              <input type="text" class="meal-search" placeholder="Search for meals, recipes, or restaurants...">
            </div>

            <!-- AI Suggestions -->
            <div class="editor-section">
              <div class="section-title">AI Recommendations</div>
              <div class="suggestion-grid" id="suggestions">
                <!-- Suggestions will be rendered here -->
              </div>
            </div>

            <!-- Family Members -->
            <div class="editor-section">
              <div class="section-title">Who's Eating?</div>
              <div class="family-selector" id="familySelector">
                <!-- Family members will be rendered here -->
              </div>
            </div>

            <!-- Nutrition Summary -->
            <div class="editor-section">
              <div class="section-title">Nutrition Summary</div>
              <div class="nutrition-summary">
                <div class="nutrition-grid">
                  <div class="nutrition-item">
                    <span class="nutrition-value">520</span>
                    <span class="nutrition-label">Calories</span>
                  </div>
                  <div class="nutrition-item">
                    <span class="nutrition-value">32g</span>
                    <span class="nutrition-label">Protein</span>
                  </div>
                  <div class="nutrition-item">
                    <span class="nutrition-value">45g</span>
                    <span class="nutrition-label">Carbs</span>
                  </div>
                  <div class="nutrition-item">
                    <span class="nutrition-value">18g</span>
                    <span class="nutrition-label">Fat</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

<script>
class MealMasterPro {
  constructor() {
    this.state = {
      currentWeek: 0,
      selectedDay: null,
      selectedMealType: null,
      fabOpen: false,
      meals: {},
      recipes: [],
      familyMembers: [
        { id: 1, name: 'John', initial: 'J', color: '#6366f1' },
        { id: 2, name: 'Jane', initial: 'J', color: '#f59e0b' },
        { id: 3, name: 'Kids', initial: 'K', color: '#10b981' }
      ],
      shoppingList: {},
      preferences: {
        dietary: ['none'],
        allergies: [],
        budget: 200,
        prepTime: 60
      },
      analytics: {
        avgCalories: 2100,
        weeklyBudget: 189,
        healthScore: 86,
        mealCompliance: 92
      }
    };

    this.mealDatabase = {
      breakfast: [
        { name: 'Overnight Oats', time: 5, calories: 320, tags: ['healthy', 'quick', 'vegetarian'] },
        { name: 'Avocado Toast', time: 10, calories: 380, tags: ['healthy', 'vegetarian'] },
        { name: 'Protein Smoothie', time: 5, calories: 280, tags: ['healthy', 'quick'] },
        { name: 'Scrambled Eggs', time: 15, calories: 340, tags: ['protein', 'quick'] }
      ],
      lunch: [
        { name: 'Caesar Salad', time: 15, calories: 420, tags: ['healthy', 'quick'] },
        { name: 'Chicken Wrap', time: 20, calories: 480, tags: ['protein', 'portable'] },
        { name: 'Quinoa Bowl', time: 25, calories: 450, tags: ['healthy', 'vegetarian'] },
        { name: 'Sushi Rolls', time: 30, calories: 380, tags: ['japanese', 'healthy'] }
      ],
      dinner: [
        { name: 'Grilled Salmon', time: 25, calories: 520, tags: ['healthy', 'protein'] },
        { name: 'Pasta Carbonara', time: 30, calories: 620, tags: ['italian', 'comfort'] },
        { name: 'Stir Fry', time: 20, calories: 480, tags: ['quick', 'asian'] },
        { name: 'Tacos', time: 25, calories: 540, tags: ['mexican', 'family'] }
      ],
      snack: [
        { name: 'Greek Yogurt', time: 0, calories: 150, tags: ['healthy', 'protein'] },
        { name: 'Trail Mix', time: 0, calories: 180, tags: ['portable', 'energy'] },
        { name: 'Protein Bar', time: 0, calories: 200, tags: ['portable', 'protein'] },
        { name: 'Fresh Fruit', time: 0, calories: 80, tags: ['healthy', 'natural'] }
      ]
    };

    this.init();
  }

  init() {
    this.loadData();
    this.setupEventListeners();
    this.renderWeek();
    this.updateWeekDates();
    this.startAnimations();
    this.initializeNotifications();
  }

  setupEventListeners() {
    // Navigation
    document.getElementById('prevWeek').addEventListener('click', () => this.navigateWeek(-1));
    document.getElementById('nextWeek').addEventListener('click', () => this.navigateWeek(1));
    
    // FAB
    const fabButton = document.getElementById('fabButton');
    const fabMenu = document.getElementById('fabMenu');
    
    fabButton.addEventListener('click', () => {
      this.state.fabOpen = !this.state.fabOpen;
      fabButton.classList.toggle('open');
      fabMenu.classList.toggle('open');
      this.hapticFeedback('light');
    });

    // FAB Options
    fabMenu.querySelectorAll('.fab-option-btn').forEach((btn, index) => {
      btn.addEventListener('click', () => {
        this.handleFabOption(index);
        this.hapticFeedback('medium');
      });
    });

    // Bottom Navigation
    document.querySelectorAll('.nav-item').forEach(item => {
      item.addEventListener('click', (e) => {
        document.querySelectorAll('.nav-item').forEach(nav => nav.classList.remove('active'));
        item.classList.add('active');
        this.handleNavigation(item.classList[1]);
        this.hapticFeedback('light');
      });
    });

    // Modal
    document.getElementById('modalClose').addEventListener('click', () => this.closeModal());
    document.getElementById('mealModal').addEventListener('click', (e) => {
      if (e.target.id === 'mealModal') this.closeModal();
    });

    // Quick Filters
    document.querySelectorAll('.filter-chip').forEach(chip => {
      chip.addEventListener('click', () => {
        chip.classList.toggle('active');
        this.applyFilters();
        this.hapticFeedback('light');
      });
    });

    // Header Actions
    document.getElementById('notificationBtn').addEventListener('click', () => this.showNotifications());
    document.getElementById('searchBtn').addEventListener('click', () => this.openSearch());
    document.getElementById('userProfile').addEventListener('click', () => this.openProfile());

    // Swipe Gestures
    this.setupSwipeGestures();
    
    // Pull to Refresh
    this.setupPullToRefresh();
    
    // Keyboard Shortcuts
    this.setupKeyboardShortcuts();
  }

  setupSwipeGestures() {
    let touchStartX = null;
    let touchStartY = null;
    const threshold = 100;
    
    document.addEventListener('touchstart', (e) => {
      touchStartX = e.touches[0].clientX;
      touchStartY = e.touches[0].clientY;
    });
    
    document.addEventListener('touchmove', (e) => {
      if (!touchStartX || !touchStartY) return;
      
      const touchEndX = e.touches[0].clientX;
      const touchEndY = e.touches[0].clientY;
      
      const deltaX = touchEndX - touchStartX;
      const deltaY = touchEndY - touchStartY;
      
      // Prevent horizontal swipe if scrolling vertically
      if (Math.abs(deltaY) > Math.abs(deltaX)) {
        touchStartX = null;
        touchStartY = null;
        return;
      }
    });
    
    document.addEventListener('touchend', (e) => {
      if (!touchStartX) return;
      
      const touchEndX = e.changedTouches[0].clientX;
      const deltaX = touchEndX - touchStartX;
      
      if (Math.abs(deltaX) > threshold) {
        if (deltaX > 0) {
          this.navigateWeek(-1);
        } else {
          this.navigateWeek(1);
        }
        this.hapticFeedback('medium');
      }
      
      touchStartX = null;
      touchStartY = null;
    });
  }

  setupPullToRefresh() {
    let pullStartY = null;
    const pullThreshold = 100;
    
    document.addEventListener('touchstart', (e) => {
      if (window.scrollY === 0) {
        pullStartY = e.touches[0].clientY;
      }
    });
    
    document.addEventListener('touchmove', (e) => {
      if (!pullStartY) return;
      
      const pullEndY = e.touches[0].clientY;
      const pullDistance = pullEndY - pullStartY;
      
      if (pullDistance > 0 && pullDistance < pullThreshold * 2) {
        // Show pull indicator
        const progress = Math.min(pullDistance / pullThreshold, 1);
        // Update UI to show pull progress
      }
    });
    
    document.addEventListener('touchend', (e) => {
      if (!pullStartY) return;
      
      const pullEndY = e.changedTouches[0].clientY;
      const pullDistance = pullEndY - pullStartY;
      
      if (pullDistance > pullThreshold) {
        this.refreshData();
        this.hapticFeedback('success');
      }
      
      pullStartY = null;
    });
  }

  setupKeyboardShortcuts() {
    document.addEventListener('keydown', (e) => {
      // Cmd/Ctrl + N: New meal
      if ((e.metaKey || e.ctrlKey) && e.key === 'n') {
        e.preventDefault();
        this.quickAddMeal();
      }
      
      // Cmd/Ctrl + S: Save
      if ((e.metaKey || e.ctrlKey) && e.key === 's') {
        e.preventDefault();
        this.saveData();
        this.showToast('Changes saved', 'Your meal plan has been saved');
      }
      
      // Arrow keys: Navigate weeks
      if (e.key === 'ArrowLeft') {
        this.navigateWeek(-1);
      } else if (e.key === 'ArrowRight') {
        this.navigateWeek(1);
      }
    });
  }

  navigateWeek(direction) {
    this.state.currentWeek += direction;
    this.updateWeekDates();
    this.renderWeek();
    
    // Add slide animation
    const container = document.getElementById('daysContainer');
    container.style.animation = 'slideIn 0.3s ease-out';
    setTimeout(() => {
      container.style.animation = '';
    }, 300);
  }

  updateWeekDates() {
    const today = new Date();
    const weekOffset = this.state.currentWeek * 7;
    const monday = new Date(today);
    
    const day = monday.getDay();
    const diff = monday.getDate() - day + (day === 0 ? -6 : 1);
    monday.setDate(diff + weekOffset);
    
    const sunday = new Date(monday);
    sunday.setDate(monday.getDate() + 6);
    
    const options = { month: 'short', day: 'numeric' };
    const startStr = monday.toLocaleDateString('en-US', options);
    const endStr = sunday.toLocaleDateString('en-US', options);
    
    document.getElementById('weekDates').textContent = `${startStr} - ${endStr}`;
    
    // Update week number
    const weekNum = Math.ceil((monday.getTime() - new Date(monday.getFullYear(), 0, 1).getTime()) / 604800000);
    document.querySelector('.week-label').textContent = `Week ${weekNum}`;
  }

  renderWeek() {
    const container = document.getElementById('daysContainer');
    const days = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'];
    const today = new Date();
    const weekOffset = this.state.currentWeek * 7;
    
    container.innerHTML = days.map((day, index) => {
      const date = new Date(today);
      const currentDay = date.getDay();
      const diff = date.getDate() - currentDay + (currentDay === 0 ? -6 : 1);
      date.setDate(diff + index + weekOffset);
      
      const dayKey = this.getDayKey(date);
      const dayMeals = this.state.meals[dayKey] || {};
      const hasMeals = Object.keys(dayMeals).length > 0;
      
      return `
        <div class="day-card ${hasMeals ? 'has-meals' : ''}" data-day="${dayKey}">
          <div class="day-card-header">
            <div class="day-card-top">
              <div class="day-info">
                <div class="day-name">${day}</div>
                <div class="day-date">${date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' })}</div>
              </div>
              <div class="day-actions">
                <button class="day-action-btn" data-action="ai" title="AI Suggest">✨</button>
                <button class="day-action-btn" data-action="copy" title="Copy">📋</button>
                <button class="day-action-btn" data-action="lock" title="Lock">🔒</button>
              </div>
            </div>
            <div class="day-badges">
              ${this.renderDayBadges(dayMeals)}
            </div>
          </div>
          <div class="day-card-content">
            <div class="meal-slots">
              ${this.renderMealSlots(dayMeals, dayKey)}
            </div>
          </div>
        </div>
      `;
    }).join('');

    // Add event listeners to cards
    container.querySelectorAll('.day-card').forEach(card => {
      const dayKey = card.dataset.day;
      
      // Meal slot listeners
      card.querySelectorAll('.meal-slot:not(.empty-meal-slot)').forEach(slot => {
        slot.addEventListener('click', (e) => {
          if (e.target.closest('.meal-action')) return;
          this.editMeal(dayKey, slot.dataset.mealType);
        });
      });
      
      // Empty slot listeners
      card.querySelectorAll('.empty-meal-slot').forEach(slot => {
        slot.addEventListener('click', () => {
          this.addMeal(dayKey, slot.dataset.mealType);
        });
      });
      
      // Action button listeners
      card.querySelectorAll('.day-action-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          this.handleDayAction(dayKey, btn.dataset.action);
        });
      });
      
      // Meal action listeners
      card.querySelectorAll('.meal-action').forEach(btn => {
        btn.addEventListener('click', (e) => {
          e.stopPropagation();
          const mealType = btn.closest('.meal-slot').dataset.mealType;
          this.handleMealAction(dayKey, mealType, btn.dataset.action);
        });
      });
    });
  }

  renderDayBadges(dayMeals) {
    const badges = [];
    
    // Check if family members are assigned
    if (dayMeals.family && dayMeals.family.length > 0) {
      badges.push(`<span class="day-badge badge-family">👨‍👩‍👧 ${dayMeals.family.length}</span>`);
    }
    
    // Check if meal prep day
    if (dayMeals.mealPrep) {
      badges.push(`<span class="day-badge badge-prep">🥘 Prep</span>`);
    }
    
    // Check for quick meals
    const quickMeals = Object.values(dayMeals).filter(meal => 
      meal.time && meal.time <= 20
    ).length;
    if (quickMeals > 0) {
      badges.push(`<span class="day-badge badge-quick">⚡ ${quickMeals}</span>`);
    }
    
    return badges.join('');
  }

  renderMealSlots(dayMeals, dayKey) {
    const mealTypes = ['breakfast', 'lunch', 'dinner', 'snack'];
    const icons = {
      breakfast: '🌅',
      lunch: '☀️',
      dinner: '🌙',
      snack: '🍿'
    };
    
    return mealTypes.map(type => {
      const meal = dayMeals[type];
      
      if (!meal) {
        return `
          <div class="empty-meal-slot" data-meal-type="${type}">
            <span>${icons[type]} Add ${type}</span>
          </div>
        `;
      }
      
      return `
        <div class="meal-slot ${type}" data-meal-type="${type}">
          <div class="meal-icon">${icons[type]}</div>
          <div class="meal-info">
            <div class="meal-title">${meal.name}</div>
            <div class="meal-details">
              ${meal.time ? `<span class="meal-tag">⏱ ${meal.time}min</span>` : ''}
              ${meal.calories ? `<span class="meal-tag">🔥 ${meal.calories}cal</span>` : ''}
              ${meal.servings ? `<span class="meal-tag">👥 ${meal.servings}</span>` : ''}
            </div>
          </div>
          <div class="meal-actions">
            <button class="meal-action" data-action="favorite">♡</button>
            <button class="meal-action" data-action="edit">✏️</button>
            <button class="meal-action" data-action="delete">×</button>
          </div>
        </div>
      `;
    }).join('');
  }

  handleDayAction(dayKey, action) {
    switch (action) {
      case 'ai':
        this.suggestMealsWithAI(dayKey);
        break;
      case 'copy':
        this.copyDayMeals(dayKey);
        break;
      case 'lock':
        this.toggleDayLock(dayKey);
        break;
    }
    this.hapticFeedback('light');
  }

  handleMealAction(dayKey, mealType, action) {
    switch (action) {
      case 'favorite':
        this.toggleFavorite(dayKey, mealType);
        break;
      case 'edit':
        this.editMeal(dayKey, mealType);
        break;
      case 'delete':
        this.deleteMeal(dayKey, mealType);
        break;
    }
    this.hapticFeedback('light');
  }

  handleFabOption(index) {
    switch (index) {
      case 0:
        this.quickAddMeal();
        break;
      case 1:
        this.aiSuggestWeek();
        break;
      case 2:
        this.scanReceipt();
        break;
    }
    
    // Close FAB menu
    this.state.fabOpen = false;
    document.getElementById('fabButton').classList.remove('open');
    document.getElementById('fabMenu').classList.remove('open');
  }

  handleNavigation(section) {
    switch (section) {
      case 'home':
        this.renderWeek();
        break;
      case 'recipes':
        this.openRecipes();
        break;
      case 'shopping':
        this.openShoppingList();
        break;
      case 'insights':
        this.openInsights();
        break;
      case 'family':
        this.openFamilySettings();
        break;
    }
  }

  addMeal(dayKey, mealType) {
    this.state.selectedDay = dayKey;
    this.state.selectedMealType = mealType;
    this.openMealEditor();
  }

  editMeal(dayKey, mealType) {
    this.state.selectedDay = dayKey;
    this.state.selectedMealType = mealType;
    this.openMealEditor(this.state.meals[dayKey]?.[mealType]);
  }

  deleteMeal(dayKey, mealType) {
    if (!this.state.meals[dayKey]) return;
    
    delete this.state.meals[dayKey][mealType];
    this.renderWeek();
    this.saveData();
    this.showToast('Meal removed', `${mealType} has been removed`);
  }

  openMealEditor(existingMeal = null) {
    const modal = document.getElementById('mealModal');
    const title = document.getElementById('modalTitle');
    
    title.textContent = existingMeal ? 'Edit Meal' : 'Add Meal';
    
    // Render suggestions
    this.renderSuggestions();
    
    // Render family selector
    this.renderFamilySelector();
    
    modal.classList.add('active');
  }

  renderSuggestions() {
    const container = document.getElementById('suggestions');
    const mealType = this.state.selectedMealType || 'dinner';
    const suggestions = this.mealDatabase[mealType] || [];
    
    container.innerHTML = suggestions.map(meal => `
      <div class="suggestion-card" data-meal='${JSON.stringify(meal)}'>
        <div class="suggestion-name">${meal.name}</div>
        <div class="suggestion-meta">
          ${meal.time ? `<span class="suggestion-tag">⏱ ${meal.time}min</span>` : ''}
          ${meal.calories ? `<span class="suggestion-tag">🔥 ${meal.calories}cal</span>` : ''}
        </div>
      </div>
    `).join('');
    
    // Add click listeners
    container.querySelectorAll('.suggestion-card').forEach(card => {
      card.addEventListener('click', () => {
        container.querySelectorAll('.suggestion-card').forEach(c => c.classList.remove('selected'));
        card.classList.add('selected');
        this.hapticFeedback('light');
      });
    });
  }

  renderFamilySelector() {
    const container = document.getElementById('familySelector');
    
    container.innerHTML = this.state.familyMembers.map(member => `
      <div class="family-member" data-member-id="${member.id}">
        <div class="member-avatar" style="background: ${member.color}">${member.initial}</div>
        <div class="member-name">${member.name}</div>
      </div>
    `).join('');
    
    // Add click listeners
    container.querySelectorAll('.family-member').forEach(member => {
      member.addEventListener('click', () => {
        member.classList.toggle('selected');
        this.hapticFeedback('light');
      });
    });
  }

  closeModal() {
    document.getElementById('mealModal').classList.remove('active');
  }

  quickAddMeal() {
    // Quick add implementation
    this.showToast('Quick Add', 'Select a day to add a meal');
  }

  aiSuggestWeek() {
    // AI suggestion for entire week
    this.showToast('AI Planning', 'Generating your perfect week...');
    
    // Simulate AI planning
    setTimeout(() => {
      this.generateWeekPlan();
      this.renderWeek();
      this.showToast('Week Planned!', 'AI has created your meal plan');
    }, 2000);
  }

  generateWeekPlan() {
    const days = 7;
    const today = new Date();
    const weekOffset = this.state.currentWeek * 7;
    
    for (let i = 0; i < days; i++) {
      const date = new Date(today);
      const currentDay = date.getDay();
      const diff = date.getDate() - currentDay + (currentDay === 0 ? -6 : 1);
      date.setDate(diff + i + weekOffset);
      
      const dayKey = this.getDayKey(date);
      
      // Generate meals for each day
      this.state.meals[dayKey] = {
        breakfast: this.getRandomMeal('breakfast'),
        lunch: this.getRandomMeal('lunch'),
        dinner: this.getRandomMeal('dinner'),
        snack: Math.random() > 0.5 ? this.getRandomMeal('snack') : null
      };
    }
    
    this.saveData();
  }

  getRandomMeal(type) {
    const meals = this.mealDatabase[type];
    return meals[Math.floor(Math.random() * meals.length)];
  }

  scanReceipt() {
    // Receipt scanning simulation
    this.showToast('Scanner', 'Camera access needed for scanning');
  }

  suggestMealsWithAI(dayKey) {
    this.showToast('AI Suggestions', 'Analyzing your preferences...');
    
    setTimeout(() => {
      this.state.meals[dayKey] = {
        lunch: this.getRandomMeal('lunch'),
        dinner: this.getRandomMeal('dinner')
      };
      this.renderWeek();
      this.saveData();
      this.showToast('Meals Added', 'AI has suggested meals for the day');
    }, 1500);
  }

  copyDayMeals(dayKey) {
    const meals = this.state.meals[dayKey];
    if (!meals || Object.keys(meals).length === 0) {
      this.showToast('Nothing to copy', 'Add meals first');
      return;
    }
    
    // Store in clipboard
    this.clipboard = { ...meals };
    this.showToast('Copied', 'Meals copied to clipboard');
  }

  toggleDayLock(dayKey) {
    // Toggle lock state
    this.showToast('Day Locked', 'This day won\'t be modified by AI');
  }

  toggleFavorite(dayKey, mealType) {
    // Toggle favorite
    this.showToast('Favorited', 'Added to your favorites');
  }

  openRecipes() {
    this.showToast('Recipes', 'Browse 1000+ recipes');
  }

  openShoppingList() {
    this.showToast('Shopping List', 'Generating your shopping list...');
  }

  openInsights() {
    this.showToast('Insights', 'Analyzing your meal patterns...');
  }

  openFamilySettings() {
    this.showToast('Family', 'Manage family members and preferences');
  }

  showNotifications() {
    this.showToast('Notifications', '3 new meal suggestions');
  }

  openSearch() {
    this.showToast('Search', 'Search for meals and recipes');
  }

  openProfile() {
    this.showToast('Profile', 'Manage your account and preferences');
  }

  applyFilters() {
    const activeFilters = Array.from(document.querySelectorAll('.filter-chip.active'))
      .map(chip => chip.textContent);
    
    this.showToast('Filters Applied', `Active: ${activeFilters.join(', ')}`);
  }

  refreshData() {
    this.showToast('Refreshing', 'Syncing your meal plan...');
    
    setTimeout(() => {
      this.renderWeek();
      this.showToast('Updated', 'Your meal plan is up to date');
    }, 1000);
  }

  initializeNotifications() {
    // Request notification permissions
    if ('Notification' in window && Notification.permission === 'default') {
      Notification.requestPermission();
    }
    
    // Schedule meal reminders
    this.scheduleMealReminders();
  }

  scheduleMealReminders() {
    // Check meal times and send reminders
    const checkReminders = () => {
      const now = new Date();
      const hour = now.getHours();
      
      if (hour === 12) {
        this.sendNotification('Lunch Time!', 'Time to prepare your lunch');
      } else if (hour === 18) {
        this.sendNotification('Dinner Time!', 'Start preparing dinner');
      }
    };
    
    // Check every hour
    setInterval(checkReminders, 3600000);
  }

  sendNotification(title, body) {
    if ('Notification' in window && Notification.permission === 'granted') {
      new Notification(title, {
        body,
        icon: '/icon-192.png',
        badge: '/badge-72.png'
      });
    }
  }

  showToast(title, message = '') {
    const container = document.getElementById('toastContainer');
    
    const toast = document.createElement('div');
    toast.className = 'toast';
    toast.innerHTML = `
      <div class="toast-icon">✓</div>
      <div class="toast-content">
        <div class="toast-title">${title}</div>
        ${message ? `<div class="toast-message">${message}</div>` : ''}
      </div>
    `;
    
    container.appendChild(toast);
    
    setTimeout(() => toast.classList.add('show'), 10);
    
    setTimeout(() => {
      toast.classList.remove('show');
      setTimeout(() => toast.remove(), 300);
    }, 3000);
  }

  hapticFeedback(type = 'light') {
    if ('vibrate' in navigator) {
      const patterns = {
        light: 10,
        medium: 20,
        heavy: 30,
        success: [10, 10, 10]
      };
      navigator.vibrate(patterns[type] || 10);
    }
  }

  startAnimations() {
    // Add subtle animations to elements
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.style.animation = 'fadeIn 0.5s ease-out';
        }
      });
    });
    
    document.querySelectorAll('.day-card').forEach(card => {
      observer.observe(card);
    });
  }

  getDayKey(date) {
    return `${date.getFullYear()}-${date.getMonth() + 1}-${date.getDate()}`;
  }

  saveData() {
    localStorage.setItem('mealMasterData', JSON.stringify(this.state));
  }

  loadData() {
    const saved = localStorage.getItem('mealMasterData');
    if (saved) {
      this.state = { ...this.state, ...JSON.parse(saved) };
    }
  }
}

// CSS Animations
const style = document.createElement('style');
style.textContent = `
  @keyframes slideIn {
    from {
      opacity: 0;
      transform: translateX(20px);
    }
    to {
      opacity: 1;
      transform: translateX(0);
    }
  }
  
  @keyframes fadeIn {
    from {
      opacity: 0;
      transform: translateY(10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
`;
document.head.appendChild(style);

// Initialize app when DOM is ready
document.addEventListener('DOMContentLoaded', () => {
  window.mealMaster = new MealMasterPro();
});

// Service Worker for PWA
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('/sw.js').catch(() => {});
}

// Handle iOS install prompt
window.addEventListener('beforeinstallprompt', (e) => {
  e.preventDefault();
  window.deferredPrompt = e;
});
</script>
</body>
</html>