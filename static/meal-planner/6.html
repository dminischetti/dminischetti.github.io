<artifacts>
  <artifact
    identifier="meal-planner-2025"
    type="text/html"
    title="Revolutionary Meal Planner 2025 - iPhone Optimized"
  >
    <!DOCTYPE html>
    <html lang="en">
      <head>
        <meta charset="UTF-8" />
        <meta
          name="viewport"
          content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"
        />
        <meta name="apple-mobile-web-app-capable" content="yes" />
        <meta
          name="apple-mobile-web-app-status-bar-style"
          content="black-translucent"
        />
        <meta name="theme-color" content="#1a1a2e" />
        <title>Meal Week - Smart Planner</title>
        <style>
          /* === Design System === */
          :root {
            --primary: #667eea;
            --primary-dark: #5a67d8;
            --primary-light: #7f8cf8;
            --secondary: #48bb78;
            --danger: #f56565;
            --warning: #ed8936;
          --bg-dark: #0f0f23;
          --bg-card: #1a1a2e;
          --bg-elevated: #252541;
          --bg-hover: #2d2d4a;
          --text-primary: #ffffff;
          --text-secondary: #a0aec0;
          --text-muted: #718096;
          --border: rgba(255, 255, 255, 0.1);
          --border-active: rgba(102, 126, 234, 0.5);
          --radius: 12px;
          --radius-lg: 16px;
          --radius-pill: 24px;
          --shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
          --shadow-lg: 0 10px 15px rgba(0, 0, 0, 0.5);
          --transition: 0.2s cubic-bezier(0.4, 0, 0.2, 1);
          --spring: 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
          --safe-top: env(safe-area-inset-top);
          --safe-bottom: env(safe-area-inset-bottom);
          }
          /* === Reset & Base === */

          {
          margin: 0;
          padding: 0;
          box-sizing: border-box;
          -webkit-tap-highlight-color: transparent;
          }

          html, body {
          height: 100%;
          overflow: hidden;
          overscroll-behavior: none;
          }
          body {
          font-family: -apple-system, BlinkMacSystemFont, 'SF Pro', sans-serif;
          background: var(--bg-dark);
          color: var(--text-primary);
          font-size: 15px;
          line-height: 1.4;
          -webkit-font-smoothing: antialiased;
          position: fixed;
          width: 100%;
          }
          /* === Layout Container === */
          .app {
          height: 100vh;
          display: flex;
          flex-direction: column;
          position: relative;
          }
          /* === Week Strip - Compact Navigation === */
          .week-strip {
          background: var(--bg-card);
          border-bottom: 1px solid var(--border);
          padding-top: var(--safe-top);
          position: sticky;
          top: 0;
          z-index: 100;
          flex-shrink: 0;
          }
          .week-header {
          display: flex;
          align-items: center;
          justify-content: space-between;
          padding: 8px 12px 4px;
          }
          .week-title {
          font-size: 13px;
          font-weight: 600;
          color: var(--text-secondary);
          text-transform: uppercase;
          letter-spacing: 0.5px;
          }
          .week-actions {
          display: flex;
          gap: 8px;
          }
          .icon-btn {
          width: 28px;
          height: 28px;
          border-radius: 8px;
          background: var(--bg-elevated);
          border: 1px solid var(--border);
          color: var(--text-secondary);
          display: flex;
          align-items: center;
          justify-content: center;
          cursor: pointer;
          transition: var(--transition);
          font-size: 16px;
          }
          .icon-btn:active {
          transform: scale(0.95);
          background: var(--bg-hover);
          }
          .days-scroll {
          display: flex;
          gap: 8px;
          padding: 8px 12px;
          overflow-x: auto;
          scroll-snap-type: x mandatory;
          -webkit-overflow-scrolling: touch;
          scrollbar-width: none;
          }
          .days-scroll::-webkit-scrollbar {
          display: none;
          }
          .day-pill {
          flex-shrink: 0;
          min-width: 52px;
          padding: 8px 12px;
          background: var(--bg-elevated);
          border: 1px solid var(--border);
          border-radius: var(--radius-pill);
          text-align: center;
          cursor: pointer;
          transition: var(--transition);
          scroll-snap-align: start;
          position: relative;
          }
          .day-pill.active {
          background: var(--primary);
          border-color: var(--primary);
          transform: scale(1.05);
          }
          .day-pill.today {
          border-color: var(--secondary);
          }
          .day-pill.weekend {
          background: var(--bg-hover);
          }
          .day-pill.has-meals::after {
          content: '';
          position: absolute;
          bottom: -4px;
          left: 50%;
          transform: translateX(-50%);
          width: 4px;
          height: 4px;
          background: var(--secondary);
          border-radius: 50%;
          }
          .day-name {
          font-size: 10px;
          font-weight: 600;
          color: var(--text-muted);
          text-transform: uppercase;
          letter-spacing: 0.3px;
          }
          .day-pill.active .day-name {
          color: rgba(255, 255, 255, 0.8);
          }
          .day-number {
          font-size: 16px;
          font-weight: 700;
          color: var(--text-primary);
          margin-top: 2px;
          }
          /* === Main Content Area === */
          .main-content {
          flex: 1;
          overflow-y: auto;
          -webkit-overflow-scrolling: touch;
          padding-bottom: 80px;
          }
          /* === Day Detail View === */
          .day-detail {
          padding: 16px;
          animation: fadeIn 0.3s ease;
          }
          @keyframes fadeIn {
          from { opacity: 0; transform: translateY(10px); }
          to { opacity: 1; transform: translateY(0); }
          }
          .detail-header {
          margin-bottom: 16px;
          }
          .detail-day {
          font-size: 24px;
          font-weight: 700;
          color: var(--text-primary);
          margin-bottom: 4px;
          }
          .detail-date {
          font-size: 13px;
          color: var(--text-secondary);
          }
          .mode-selector {
          display: flex;
          background: var(--bg-elevated);
          border-radius: var(--radius);
          padding: 3px;
          margin-bottom: 16px;
          }
          .mode-btn {
          flex: 1;
          padding: 8px;
          border: none;
          background: transparent;
          color: var(--text-secondary);
          font-size: 12px;
          font-weight: 600;
          border-radius: calc(var(--radius) - 3px);
          cursor: pointer;
          transition: var(--transition);
          }
          .mode-btn.active {
          background: var(--primary);
          color: white;
          }
          /* === Smart Meal Grid === */
          .meal-grid {
          display: grid;
          gap: 12px;
          margin-bottom: 20px;
          }
          .meal-card {
          background: var(--bg-card);
          border: 1px solid var(--border);
          border-radius: var(--radius-lg);
          padding: 16px;
          position: relative;
          transition: var(--transition);
          }
          .meal-card:active {
          transform: scale(0.98);
          background: var(--bg-elevated);
          }
          .meal-card.has-value {
          border-color: var(--border-active);
          background: var(--bg-elevated);
          }
          .meal-header {
          display: flex;
          align-items: center;
          justify-content: space-between;
          margin-bottom: 8px;
          }
          .meal-label {
          font-size: 11px;
          font-weight: 600;
          color: var(--text-muted);
          text-transform: uppercase;
          letter-spacing: 0.5px;
          }
          .meal-time {
          font-size: 10px;
          color: var(--text-muted);
          }
          .meal-content {
          display: flex;
          align-items: center;
          gap: 12px;
          min-height: 32px;
          }
          .meal-emoji {
          font-size: 24px;
          opacity: 0.9;
          }
          .meal-text {
          flex: 1;
          }
          .meal-name {
          font-size: 15px;
          font-weight: 600;
          color: var(--text-primary);
          line-height: 1.2;
          }
          .meal-placeholder {
          font-size: 14px;
          color: var(--text-muted);
          font-style: italic;
          }
          .meal-actions {
          display: flex;
          gap: 4px;
          }
          .meal-action {
          width: 24px;
          height: 24px;
          border-radius: 6px;
          background: var(--bg-hover);
          border: none;
          color: var(--text-secondary);
          display: flex;
          align-items: center;
          justify-content: center;
          cursor: pointer;
          opacity: 0;
          transition: var(--transition);
          font-size: 12px;
          }
          .meal-card:hover .meal-action,
          .meal-card:focus-within .meal-action {
          opacity: 1;
          }
          /* === Quick Select Carousel === */
          .quick-select {
          margin-bottom: 20px;
          }
          .quick-header {
          display: flex;
          align-items: center;
          justify-content: space-between;
          margin-bottom: 12px;
          }
          .quick-title {
          font-size: 13px;
          font-weight: 600;
          color: var(--text-secondary);
          text-transform: uppercase;
          letter-spacing: 0.5px;
          }
          .quick-meals {
          display: flex;
          gap: 8px;
          overflow-x: auto;
          padding-bottom: 4px;
          -webkit-overflow-scrolling: touch;
          scrollbar-width: none;
          }
          .quick-meals::-webkit-scrollbar {
          display: none;
          }
          .quick-meal {
          flex-shrink: 0;
          padding: 8px 12px;
          background: var(--bg-elevated);
          border: 1px solid var(--border);
          border-radius: var(--radius-pill);
          display: flex;
          align-items: center;
          gap: 6px;
          cursor: pointer;
          transition: var(--transition);
          font-size: 13px;
          white-space: nowrap;
          }
          .quick-meal:active {
          background: var(--primary);
          border-color: var(--primary);
          transform: scale(0.95);
          }
          .quick-meal-emoji {
          font-size: 16px;
          }
          /* === Progress Bar === */
          .progress-bar {
          background: var(--bg-card);
          border-top: 1px solid var(--border);
          padding: 12px 16px;
          position: fixed;
          bottom: 60px;
          left: 0;
          right: 0;
          z-index: 50;
          }
          .progress-header {
          display: flex;
          justify-content: space-between;
          margin-bottom: 8px;
          }
          .progress-label {
          font-size: 11px;
          font-weight: 600;
          color: var(--text-secondary);
          text-transform: uppercase;
          letter-spacing: 0.5px;
          }
          .progress-value {
          font-size: 11px;
          color: var(--text-secondary);
          }
          .progress-track {
          height: 4px;
          background: var(--bg-elevated);
          border-radius: 2px;
          overflow: hidden;
          }
          .progress-fill {
          height: 100%;
          background: linear-gradient(90deg, var(--secondary), var(--primary));
          border-radius: 2px;
          transition: width 0.5s var(--spring);
          }
          /* === Floating Action Button === */
          .fab-container {
          position: fixed;
          bottom: 16px;
          right: 16px;
          z-index: 200;
          padding-bottom: var(--safe-bottom);
          }
          .fab {
          width: 56px;
          height: 56px;
          border-radius: 50%;
          background: var(--primary);
          border: none;
          color: white;
          display: flex;
          align-items: center;
          justify-content: center;
          box-shadow: var(--shadow-lg);
          cursor: pointer;
          transition: var(--transition);
          font-size: 24px;
          position: relative;
          }
          .fab:active {
          transform: scale(0.9);
          }
          .fab-menu {
          position: absolute;
          bottom: 64px;
          right: 0;
          display: flex;
          flex-direction: column-reverse;
          gap: 12px;
          opacity: 0;
          pointer-events: none;
          transition: var(--transition);
          }
          .fab-menu.open {
          opacity: 1;
          pointer-events: auto;
          }
          .fab-option {
          display: flex;
          align-items: center;
          gap: 12px;
          padding: 8px 16px;
          background: var(--bg-card);
          border: 1px solid var(--border);
          border-radius: var(--radius-pill);
          white-space: nowrap;
          font-size: 13px;
          font-weight: 600;
          box-shadow: var(--shadow);
          cursor: pointer;
          transform: translateX(20px);
          transition: var(--transition);
          }
          .fab-menu.open .fab-option {
          transform: translateX(0);
          }
          .fab-menu.open .fab-option:nth-child(1) { transition-delay: 0.05s; }
          .fab-menu.open .fab-option:nth-child(2) { transition-delay: 0.1s; }
          .fab-menu.open .fab-option:nth-child(3) { transition-delay: 0.15s; }
          .fab-option-icon {
          font-size: 18px;
          }
          /* === Bottom Sheet Modal === */
          .bottom-sheet {
          position: fixed;
          bottom: 0;
          left: 0;
          right: 0;
          background: var(--bg-card);
          border-radius: var(--radius-lg) var(--radius-lg) 0 0;
          transform: translateY(100%);
          transition: transform 0.3s cubic-bezier(0.4, 0, 0, 1);
          max-height: 85vh;
          z-index: 300;
          display: flex;
          flex-direction: column;
          }
          .bottom-sheet.open {
          transform: translateY(0);
          }
          .sheet-handle {
          width: 36px;
          height: 4px;
          background: var(--text-muted);
          border-radius: 2px;
          margin: 12px auto 8px;
          opacity: 0.5;
          }
          .sheet-header {
          padding: 16px 20px;
          border-bottom: 1px solid var(--border);
          }
          .sheet-title {
          font-size: 18px;
          font-weight: 700;
          color: var(--text-primary);
          }
          .sheet-subtitle {
          font-size: 12px;
          color: var(--text-secondary);
          margin-top: 2px;
          }
          .sheet-content {
          flex: 1;
          overflow-y: auto;
          -webkit-overflow-scrolling: touch;
          padding: 16px;
          padding-bottom: calc(16px + var(--safe-bottom));
          }
          .sheet-section {
          margin-bottom: 20px;
          }
          .section-title {
          font-size: 11px;
          font-weight: 600;
          color: var(--text-muted);
          text-transform: uppercase;
          letter-spacing: 0.5px;
          margin-bottom: 12px;
          }
          .meal-options {
          display: grid;
          grid-template-columns: repeat(2, 1fr);
          gap: 8px;
          }
          .meal-option {
          padding: 12px;
          background: var(--bg-elevated);
          border: 1px solid var(--border);
          border-radius: var(--radius);
          cursor: pointer;
          transition: var(--transition);
          display: flex;
          flex-direction: column;
          align-items: center;
          gap: 4px;
          text-align: center;
          }
          .meal-option:active {
          background: var(--primary);
          border-color: var(--primary);
          transform: scale(0.95);
          }
          .meal-option-emoji {
          font-size: 24px;
          }
          .meal-option-name {
          font-size: 11px;
          font-weight: 600;
          color: var(--text-primary);
          line-height: 1.2;
          }
          /* === Overlay === */
          .overlay {
          position: fixed;
          inset: 0;
          background: rgba(0, 0, 0, 0.6);
          opacity: 0;
          pointer-events: none;
          transition: opacity 0.3s;
          z-index: 250;
          }
          .overlay.show {
          opacity: 1;
          pointer-events: auto;
          }
          /* === Stats View === */
          .stats-grid {
          display: grid;
          grid-template-columns: repeat(3, 1fr);
          gap: 12px;
          margin-bottom: 20px;
          }
          .stat-card {
          background: var(--bg-elevated);
          border: 1px solid var(--border);
          border-radius: var(--radius);
          padding: 12px;
          text-align: center;
          }
          .stat-value {
          font-size: 20px;
          font-weight: 700;
          color: var(--text-primary);
          }
          .stat-label {
          font-size: 10px;
          color: var(--text-secondary);
          text-transform: uppercase;
          letter-spacing: 0.3px;
          margin-top: 2px;
          }
          /* === Shopping List === */
          .shopping-category {
          margin-bottom: 16px;
          }
          .category-header {
          font-size: 13px;
          font-weight: 600;
          color: var(--text-secondary);
          margin-bottom: 8px;
          }
          .shopping-item {
          display: flex;
          align-items: center;
          gap: 12px;
          padding: 8px 0;
          border-bottom: 1px solid var(--border);
          }
          .item-checkbox {
          width: 20px;
          height: 20px;
          border: 2px solid var(--border);
          border-radius: 4px;
          cursor: pointer;
          transition: var(--transition);
          display: flex;
          align-items: center;
          justify-content: center;
          }
          .item-checkbox.checked {
          background: var(--secondary);
          border-color: var(--secondary);
          }
          .item-checkbox.checked::after {
          content: '✓';
          color: white;
          font-size: 12px;
          font-weight: bold;
          }
          .item-name {
          flex: 1;
          font-size: 14px;
          transition: var(--transition);
          }
          .shopping-item.checked .item-name {
          opacity: 0.5;
          text-decoration: line-through;
          }
          .item-count {
          font-size: 12px;
          color: var(--text-secondary);
          background: var(--bg-hover);
          padding: 2px 8px;
          border-radius: 10px;
          }
          /* === Loading State === */
          .loading {
          display: flex;
          align-items: center;
          justify-content: center;
          padding: 40px;
          color: var(--text-secondary);
          }
          .spinner {
          width: 24px;
          height: 24px;
          border: 2px solid var(--border);
          border-top-color: var(--primary);
          border-radius: 50%;
          animation: spin 0.8s linear infinite;
          }
          @keyframes spin {
          to { transform: rotate(360deg); }
          }
          /* === Responsive Tweaks === */
          @media (max-width: 320px) {
          .meal-options {
          grid-template-columns: 1fr;
          }
          .stats-grid {
          grid-template-columns: 1fr;
          }
          }
          /* === Accessibility === */
          @media (prefers-reduced-motion: reduce) {
          *, *::before, *::after {
          animation-duration: 0.01ms !important;
          transition-duration: 0.01ms !important;
          }
          }
          .sr-only {
          position: absolute;
          width: 1px;
          height: 1px;
          padding: 0;
          margin: -1px;
          overflow: hidden;
          clip: rect(0, 0, 0, 0);
          white-space: nowrap;
          border: 0;
          }
          /* === Haptic Feedback Classes === */
          .haptic {
          animation: haptic 0.1s ease-out;
          }
          @keyframes haptic {
          0%, 100% { transform: scale(1); }
          50% { transform: scale(0.97); }
          }
        </style>
      </head>
      <body>
        <div class="app">
          <!-- Compact Week Navigation -->
          <div class="week-strip">
            <div class="week-header">
              <span id="weekRange" class="week-title">Loading...</span>
              <div class="week-actions">
                <button id="settingsBtn" class="icon-btn" aria-label="Settings">
                  ⚙️
                </button>
              </div>
            </div>
            <div id="daysScroll" class="days-scroll">
              <!-- Days will be generated here -->
            </div>
          </div>
          <!-- Main Content Area -->
          <div class="main-content">
            <div id="dayDetail" class="day-detail">
              <!-- Active day detail will be rendered here -->
            </div>
          </div>
          <!-- Progress Bar -->
          <div class="progress-bar">
            <div class="progress-header">
              <span class="progress-label">Week Progress</span>
              <span id="progressValue" class="progress-value">0/21 meals</span>
            </div>
            <div class="progress-track">
              <div
                id="progressFill"
                class="progress-fill"
                style="width: 0%"
              ></div>
            </div>
          </div>
          <!-- Floating Action Button -->
          <div class="fab-container">
            <div id="fabMenu" class="fab-menu">
              <div class="fab-option" data-action="share">
                <span class="fab-option-icon">📤</span>
                <span>Share Week</span>
              </div>
              <div class="fab-option" data-action="shopping">
                <span class="fab-option-icon">🛒</span>
                <span>Shopping List</span>
              </div>
              <div class="fab-option" data-action="randomize">
                <span class="fab-option-icon">🎲</span>
                <span>Randomize All</span>
              </div>
            </div>
            <button id="fab" class="fab">
              <span id="fabIcon">✨</span>
            </button>
          </div>
        </div>
        <!-- Meal Selection Bottom Sheet -->
        <div id="mealSheet" class="bottom-sheet">
          <div class="sheet-handle"></div>
          <div class="sheet-header">
            <h2 id="sheetTitle" class="sheet-title">Choose Meal</h2>
            <p id="sheetSubtitle" class="sheet-subtitle">
              Quick favorites & full menu
            </p>
          </div>
          <div class="sheet-content">
            <div id="sheetContent">
              <!-- Dynamic content -->
            </div>
          </div>
        </div>
        <!-- Shopping List Bottom Sheet -->
        <div id="shoppingSheet" class="bottom-sheet">
          <div class="sheet-handle"></div>
          <div class="sheet-header">
            <h2 class="sheet-title">🛒 Shopping List</h2>
            <p class="sheet-subtitle">Tap items to check off</p>
          </div>
          <div class="sheet-content">
            <div id="shoppingContent">
              <!-- Shopping list will be rendered here -->
            </div>
          </div>
        </div>
        <!-- Overlay -->
        <div id="overlay" class="overlay"></div>
        <script>
          // ====== Enhanced Meal Database ======
          const MEALS_DB = {
            favorites: [ // Most used meals for quick access
              { id: 'pasta-pesto', emoji: '🌿', name: 'Pasta al pesto', type: 'lunch', prepTime: 15 },
              { id: 'carbonara', emoji: '🥓', name: 'Carbonara', type: 'lunch', prepTime: 20 },
              { id: 'salmon-rice', emoji: '🐟', name: 'Salmon & Rice', type: 'dinner', prepTime: 25 },
              { id: 'chicken-lemon', emoji: '🍋', name: 'Lemon Chicken', type: 'dinner', prepTime: 30 },
              { id: 'pizza-delivery', emoji: '🍕', name: 'Pizza Delivery', type: 'delivery', prepTime: 0 }
            ],

            lunch: [
              { emoji: '🍝', name: 'Spaghetti Pomodoro', prepTime: 15 },
              { emoji: '🥚', name: 'Frittata', prepTime: 10 },
              { emoji: '🥪', name: 'Panini', prepTime: 5 },
              { emoji: '🍋', name: 'Pasta Limone', prepTime: 15 },
              { emoji: '🧄', name: 'Aglio e Olio', prepTime: 12 },
              { emoji: '🫘', name: 'Pasta e Ceci', prepTime: 25 },
              { emoji: '🍳', name: 'Uova Fritte', prepTime: 5 }
            ],

            dinner: [
              { emoji: '🍖', name: 'Polpette', prepTime: 35 },
              { emoji: '🍗', name: 'Pollo al Forno', prepTime: 45 },
              { emoji: '🥩', name: 'Bistecca', prepTime: 15 },
              { emoji: '🐟', name: 'Merluzzo', prepTime: 20 },
              { emoji: '🍔', name: 'Hamburger', prepTime: 15 },
              { emoji: '🌭', name: 'Salsicce', prepTime: 20 }
            ],

            quick: [
              { emoji: '🍗', name: 'Cordon Bleu', prepTime: 12 },
              { emoji: '🥟', name: 'Dumplings', prepTime: 8 },
              { emoji: '🐟', name: 'Fish Sticks', prepTime: 10 },
              { emoji: '🌭', name: 'Hot Dogs', prepTime: 5 }
            ],

            delivery: [
              { emoji: '🍕', name: 'Pizza', prepTime: 0 },
              { emoji: '🥙', name: 'Kebab', prepTime: 0 },
              { emoji: '🍜', name: 'Ramen', prepTime: 0 },
              { emoji: '🥡', name: 'Chinese', prepTime: 0 }
            ],

            sides: [
              { emoji: '🥔', name: 'Roasted Potatoes', prepTime: 25 },
              { emoji: '🥗', name: 'Insalata', prepTime: 5 },
              { emoji: '🥦', name: 'Broccoli', prepTime: 10 },
              { emoji: '🥕', name: 'Glazed Carrots', prepTime: 15 }
            ]
          };

          // ====== Smart App Controller ======
          class MealWeekApp {
            constructor() {
              this.currentDay = null;
              this.currentWeek = this.getWeekDates();
              this.meals = this.loadMeals();
              this.settings = this.loadSettings();
              this.currentSheet = null;
              this.currentMealTarget = null;

              this.init();
            }

            init() {
              this.setupElements();
              this.bindEvents();
              this.render();
              this.selectToday();
              this.updateProgress();
            }

            setupElements() {
              this.els = {
                weekRange: document.getElementById('weekRange'),
                daysScroll: document.getElementById('daysScroll'),
                dayDetail: document.getElementById('dayDetail'),
                fab: document.getElementById('fab'),
                fabIcon: document.getElementById('fabIcon'),
                fabMenu: document.getElementById('fabMenu'),
                overlay: document.getElementById('overlay'),
                mealSheet: document.getElementById('mealSheet'),
                shoppingSheet: document.getElementById('shoppingSheet'),
                progressValue: document.getElementById('progressValue'),
                progressFill: document.getElementById('progressFill'),
                settingsBtn: document.getElementById('settingsBtn')
              };
            }

            bindEvents() {
              // FAB Menu
              this.els.fab.addEventListener('click', () => this.toggleFAB());

              // FAB Options
              this.els.fabMenu.addEventListener('click', (e) => {
                const option = e.target.closest('.fab-option');
                if (option) {
                  this.handleFABAction(option.dataset.action);
                }
              });

              // Overlay
              this.els.overlay.addEventListener('click', () => this.closeAllSheets());

              // Settings
              this.els.settingsBtn.addEventListener('click', () => this.showSettings());

              // Swipe to close sheets
              let startY = 0;
              document.querySelectorAll('.bottom-sheet').forEach(sheet => {
                const handle = sheet.querySelector('.sheet-handle');

                handle.addEventListener('touchstart', (e) => {
                  startY = e.touches[0].clientY;
                });

                handle.addEventListener('touchmove', (e) => {
                  const deltaY = e.touches[0].clientY - startY;
                  if (deltaY > 0) {
                    sheet.style.transform = `translateY(${deltaY}px)`;
                  }
                });

                handle.addEventListener('touchend', (e) => {
                  const deltaY = e.changedTouches[0].clientY - startY;
                  if (deltaY > 50) {
                    this.closeSheet(sheet.id);
                  }
                  sheet.style.transform = '';
                });
              });

              // Auto-save on changes
              document.addEventListener('visibilitychange', () => {
                if (document.hidden) {
                  this.saveMeals();
                }
              });
            }

            render() {
              this.renderWeekStrip();
              this.renderDayDetail();
            }

            renderWeekStrip() {
              // Update week range
              const start = this.currentWeek[0].date;
              const end = this.currentWeek[6].date;
              this.els.weekRange.textContent = `${this.formatDate(start, 'short')} - ${this.formatDate(end, 'short')}`;

              // Render day pills
              this.els.daysScroll.innerHTML = '';

              this.currentWeek.forEach((day, index) => {
                const isWeekend = index >= 5;
                const isToday = this.isToday(day.date);
                const hasMeals = this.dayHasMeals(day.key);

                const pill = document.createElement('div');
                pill.className = `day-pill ${isToday ? 'today' : ''} ${isWeekend ? 'weekend' : ''} ${hasMeals ? 'has-meals' : ''}`;
                pill.dataset.day = day.key;

                if (this.currentDay === day.key) {
                  pill.classList.add('active');
                }

                pill.innerHTML = `
                  <div class="day-name">${day.short}</div>
                  <div class="day-number">${day.date.getDate()}</div>
                `;

                pill.addEventListener('click', () => {
                  this.selectDay(day.key);
                  this.haptic('light');
                });

                this.els.daysScroll.appendChild(pill);
              });

              // Scroll to active day
              const activePill = this.els.daysScroll.querySelector('.day-pill.active');
              if (activePill) {
                activePill.scrollIntoView({ behavior: 'smooth', inline: 'center' });
              }
            }

            renderDayDetail() {
              if (!this.currentDay) return;

              const dayData = this.currentWeek.find(d => d.key === this.currentDay);
              const meals = this.meals[this.currentDay] || { lunch: null, dinner: null, side: null, mode: 'regular' };

              this.els.dayDetail.innerHTML = `
                <div class="detail-header">
                  <div class="detail-day">${dayData.name}</div>
                  <div class="detail-date">${this.formatDate(dayData.date, 'long')}</div>
                </div>

                <div class="mode-selector">
                  <button class="mode-btn ${meals.mode === 'regular' ? 'active' : ''}" data-mode="regular">Regular</button>
                  <button class="mode-btn ${meals.mode === 'quick' ? 'active' : ''}" data-mode="quick">Quick</button>
                  <button class="mode-btn ${meals.mode === 'delivery' ? 'active' : ''}" data-mode="delivery">Delivery</button>
                </div>

                <div class="meal-grid">
                  ${this.renderMealCard('lunch', meals.lunch, '12:00 PM')}
                  ${this.renderMealCard('dinner', meals.dinner, '7:00 PM')}
                  ${meals.mode !== 'delivery' ? this.renderMealCard('side', meals.side, 'With dinner') : ''}
                </div>

                <div class="quick-select">
                  <div class="quick-header">
                    <span class="quick-title">Quick Add</span>
                    <button class="icon-btn" onclick="app.randomizeDay()">🎲</button>
                  </div>
                  <div class="quick-meals">
                    ${this.renderQuickMeals()}
                  </div>
                </div>

                ${this.renderStats()}
              `;

              // Bind meal card events
              this.els.dayDetail.querySelectorAll('.meal-card').forEach(card => {
                card.addEventListener('click', (e) => {
                  if (!e.target.closest('.meal-action')) {
                    const type = card.dataset.type;
                    this.showMealSelector(type);
                    this.haptic('light');
                  }
                });
              });

              // Bind mode buttons
              this.els.dayDetail.querySelectorAll('.mode-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                  this.changeMode(btn.dataset.mode);
                  this.haptic('light');
                });
              });

              // Bind quick meals
              this.els.dayDetail.querySelectorAll('.quick-meal').forEach(meal => {
                meal.addEventListener('click', () => {
                  const mealData = MEALS_DB.favorites.find(m => m.name === meal.dataset.meal);
                  if (mealData) {
                    this.setMeal(mealData.type === 'delivery' ? 'dinner' : mealData.type, meal.dataset.meal);
                    if (mealData.type === 'delivery') {
                      this.changeMode('delivery');
                    }
                  }
                  this.haptic('medium');
                });
              });

              // Bind meal actions
              this.els.dayDetail.querySelectorAll('.meal-action').forEach(btn => {
                btn.addEventListener('click', (e) => {
                  e.stopPropagation();
                  const card = btn.closest('.meal-card');
                  const type = card.dataset.type;

                  if (btn.dataset.action === 'clear') {
                    this.setMeal(type, null);
                  } else if (btn.dataset.action === 'copy') {
                    this.copyMeal(type);
                  }
                  this.haptic('light');
                });
              });
            }

            renderMealCard(type, value, time) {
              const meal = value ? MEALS_DB.favorites.find(m => m.name === value) ||
                                  [...MEALS_DB.lunch, ...MEALS_DB.dinner, ...MEALS_DB.quick, ...MEALS_DB.delivery, ...MEALS_DB.sides]
                                  .find(m => m.name === value) : null;

              return `
                <div class="meal-card ${value ? 'has-value' : ''}" data-type="${type}">
                  <div class="meal-header">
                    <span class="meal-label">${type}</span>
                    <span class="meal-time">${time}</span>
                  </div>
                  <div class="meal-content">
                    ${meal ? `
                      <span class="meal-emoji">${meal.emoji}</span>
                      <div class="meal-text">
                        <div class="meal-name">${meal.name}</div>
                      </div>
                    ` : `
                      <div class="meal-text">
                        <div class="meal-placeholder">Tap to add ${type}</div>
                      </div>
                    `}
                    <div class="meal-actions">
                      ${value ? `
                        <button class="meal-action" data-action="copy" title="Copy">📋</button>
                        <button class="meal-action" data-action="clear" title="Clear">✕</button>
                      ` : ''}
                    </div>
                  </div>
                </div>
              `;
            }

            renderQuickMeals() {
              return MEALS_DB.favorites.map(meal => `
                <div class="quick-meal" data-meal="${meal.name}">
                  <span class="quick-meal-emoji">${meal.emoji}</span>
                  <span>${meal.name}</span>
                </div>
              `).join('');
            }

            renderStats() {
              const dayMeals = this.meals[this.currentDay] || {};
              const totalPrepTime = this.calculatePrepTime(dayMeals);
              const mealCount = [dayMeals.lunch, dayMeals.dinner, dayMeals.side].filter(Boolean).length;

              return `
                <div class="stats-grid">
                  <div class="stat-card">
                    <div class="stat-value">${mealCount}/3</div>
                    <div class="stat-label">Meals</div>
                  </div>
                  <div class="stat-card">
                    <div class="stat-value">${totalPrepTime}'</div>
                    <div class="stat-label">Prep Time</div>
                  </div>
                  <div class="stat-card">
                    <div class="stat-value">${this.getNutritionalScore(dayMeals)}</div>
                    <div class="stat-label">Balance</div>
                  </div>
                </div>
              `;
            }

            showMealSelector(type) {
              this.currentMealTarget = type;
              const meals = this.meals[this.currentDay] || {};

              let options = [];
              if (type === 'lunch') {
                options = MEALS_DB.lunch;
              } else if (type === 'dinner') {
                options = meals.mode === 'delivery' ? MEALS_DB.delivery :
                          meals.mode === 'quick' ? MEALS_DB.quick :
                          MEALS_DB.dinner;
              } else {
                options = MEALS_DB.sides;
              }

              const sheetContent = document.getElementById('sheetContent');
              sheetContent.innerHTML = `
                <div class="sheet-section">
                  <div class="section-title">Quick Favorites</div>
                  <div class="meal-options">
                    ${MEALS_DB.favorites
                      .filter(m => {
                        if (type === 'lunch') return m.type === 'lunch';
                        if (type === 'dinner') return m.type !== 'lunch';
                        return false;
                      })
                      .map(meal => `
                        <div class="meal-option" data-meal="${meal.name}">
                          <span class="meal-option-emoji">${meal.emoji}</span>
                          <span class="meal-option-name">${meal.name}</span>
                        </div>
                      `).join('')}
                  </div>
                </div>

                <div class="sheet-section">
                  <div class="section-title">All Options</div>
                  <div class="meal-options">
                    ${options.map(meal => `
                      <div class="meal-option" data-meal="${meal.name}">
                        <span class="meal-option-emoji">${meal.emoji}</span>
                        <span class="meal-option-name">${meal.name}</span>
                      </div>
                    `).join('')}
                    <div class="meal-option" data-meal="">
                      <span class="meal-option-emoji">✕</span>
                      <span class="meal-option-name">Clear</span>
                    </div>
                  </div>
                </div>
              `;

              // Update sheet title
              document.getElementById('sheetTitle').textContent = `Choose ${type.charAt(0).toUpperCase() + type.slice(1)}`;
              document.getElementById('sheetSubtitle').textContent =
                type === 'side' ? 'Perfect pairings' :
                type === 'lunch' ? 'Midday fuel' :
                'Evening feast';

              // Bind option clicks
              sheetContent.querySelectorAll('.meal-option').forEach(option => {
                option.addEventListener('click', () => {
                  const meal = option.dataset.meal;
                  this.setMeal(type, meal || null);
                  this.closeSheet('mealSheet');
                  this.haptic('medium');
                });
              });

              this.openSheet('mealSheet');
            }

            showShoppingList() {
              const ingredients = this.generateShoppingList();
              const content = document.getElementById('shoppingContent');

              if (Object.keys(ingredients).length === 0) {
                content.innerHTML = `
                  <div class="loading">
                    <p>No meals planned yet!</p>
                  </div>
                `;
              } else {
                content.innerHTML = Object.entries(ingredients).map(([category, items]) => `
                  <div class="shopping-category">
                    <div class="category-header">${category}</div>
                    ${items.map(item => `
                      <div class="shopping-item" data-item="${item.name}">
                        <div class="item-checkbox"></div>
                        <span class="item-name">${item.name}</span>
                        ${item.count > 1 ? `<span class="item-count">×${item.count}</span>` : ''}
                      </div>
                    `).join('')}
                  </div>
                `).join('');

                // Bind checkbox clicks
                content.querySelectorAll('.shopping-item').forEach(item => {
                  item.addEventListener('click', () => {
                    item.classList.toggle('checked');
                    item.querySelector('.item-checkbox').classList.toggle('checked');
                    this.haptic('light');
                  });
                });
              }

              this.openSheet('shoppingSheet');
            }

            generateShoppingList() {
              // Simplified for demo - would have full ingredient mapping
              const categories = {
                '🥩 Proteins': [],
                '🥬 Produce': [],
                '🥛 Dairy': [],
                '🍞 Pantry': []
              };

              // Mock ingredients based on meals
              Object.values(this.meals).forEach(day => {
                if (day.lunch) {
                  categories['🍞 Pantry'].push({ name: 'Pasta', count: 1 });
                }
                if (day.dinner) {
                  categories['🥩 Proteins'].push({ name: day.dinner, count: 1 });
                }
                if (day.side) {
                  categories['🥬 Produce'].push({ name: day.side, count: 1 });
                }
              });

              // Remove empty categories
              Object.keys(categories).forEach(key => {
                if (categories[key].length === 0) delete categories[key];
              });

              return categories;
            }

            // === Day Management ===
            selectDay(key) {
              this.currentDay = key;
              this.render();
            }

            selectToday() {
              const today = new Date();
              const todayKey = this.getDateKey(today);
              const todayDay = this.currentWeek.find(d => d.key === todayKey);

              if (todayDay) {
                this.selectDay(todayDay.key);
              } else {
                this.selectDay(this.currentWeek[0].key);
              }
            }

            // === Meal Management ===
            setMeal(type, value) {
              if (!this.meals[this.currentDay]) {
                this.meals[this.currentDay] = { lunch: null, dinner: null, side: null, mode: 'regular' };
              }

              this.meals[this.currentDay][type] = value;
              this.saveMeals();
              this.renderDayDetail();
              this.updateProgress();
            }

            changeMode(mode) {
              if (!this.meals[this.currentDay]) {
                this.meals[this.currentDay] = { lunch: null, dinner: null, side: null, mode: 'regular' };
              }

              this.meals[this.currentDay].mode = mode;

              // Clear side if delivery mode
              if (mode === 'delivery') {
                this.meals[this.currentDay].side = null;
              }

              this.saveMeals();
              this.renderDayDetail();
            }

            randomizeDay() {
              const meals = {
                lunch: MEALS_DB.lunch[Math.floor(Math.random() * MEALS_DB.lunch.length)].name,
                dinner: MEALS_DB.dinner[Math.floor(Math.random() * MEALS_DB.dinner.length)].name,
                side: MEALS_DB.sides[Math.floor(Math.random() * MEALS_DB.sides.length)].name,
                mode: 'regular'
              };

              this.meals[this.currentDay] = meals;
              this.saveMeals();
              this.renderDayDetail();
              this.updateProgress();
              this.haptic('medium');
            }

            randomizeAll() {
              this.currentWeek.forEach(day => {
                if (Math.random() > 0.3) { // 70% chance to plan each day
                  this.meals[day.key] = {
                    lunch: MEALS_DB.lunch[Math.floor(Math.random() * MEALS_DB.lunch.length)].name,
                    dinner: MEALS_DB.dinner[Math.floor(Math.random() * MEALS_DB.dinner.length)].name,
                    side: Math.random() > 0.5 ? MEALS_DB.sides[Math.floor(Math.random() * MEALS_DB.sides.length)].name : null,
                    mode: 'regular'
                  };
                }
              });

              this.saveMeals();
              this.render();
              this.updateProgress();
              this.haptic('heavy');
            }

            copyMeal(type) {
              const value = this.meals[this.currentDay]?.[type];
              if (value) {
                navigator.clipboard.writeText(value);
                this.showToast('Copied to clipboard');
              }
            }

            // === UI Helpers ===
            toggleFAB() {
              const isOpen = this.els.fabMenu.classList.toggle('open');
              this.els.fabIcon.textContent = isOpen ? '✕' : '✨';
              this.haptic('light');
            }

            handleFABAction(action) {
              this.toggleFAB();

              switch (action) {
                case 'randomize':
                  this.randomizeAll();
                  break;
                case 'shopping':
                  this.showShoppingList();
                  break;
                case 'share':
                  this.shareWeek();
                  break;
              }
            }

            openSheet(sheetId) {
              const sheet = document.getElementById(sheetId);
              sheet.classList.add('open');
              this.els.overlay.classList.add('show');
              this.currentSheet = sheetId;
              document.body.style.overflow = 'hidden';
            }

            closeSheet(sheetId) {
              const sheet = document.getElementById(sheetId);
              sheet.classList.remove('open');
              this.els.overlay.classList.remove('show');
              this.currentSheet = null;
              document.body.style.overflow = '';
            }

            closeAllSheets() {
              document.querySelectorAll('.bottom-sheet').forEach(sheet => {
                sheet.classList.remove('open');
              });
              this.els.overlay.classList.remove('show');
              this.currentSheet = null;
              document.body.style.overflow = '';
              this.toggleFAB();
            }

            showSettings() {
              // Simplified - would show settings sheet
              this.showToast('Settings coming soon!');
            }

            shareWeek() {
              const text = this.generateWeekSummary();

              if (navigator.share) {
                navigator.share({
                  title: 'My Meal Plan',
                  text: text
                }).catch(err => {
                  if (err.name !== 'AbortError') {
                    this.copyToClipboard(text);
                  }
                });
              } else {
                this.copyToClipboard(text);
              }
            }

            generateWeekSummary() {
              let text = '🍽️ My Meal Plan\n\n';

              this.currentWeek.forEach(day => {
                const meals = this.meals[day.key];
                if (meals && (meals.lunch || meals.dinner)) {
                  text += `${day.name}:\n`;
                  if (meals.lunch) text += `  Lunch: ${meals.lunch}\n`;
                  if (meals.dinner) text += `  Dinner: ${meals.dinner}`;
                  if (meals.side) text += ` + ${meals.side}`;
                  text += '\n\n';
                }
              });

              return text.trim();
            }

            copyToClipboard(text) {
              navigator.clipboard.writeText(text).then(() => {
                this.showToast('Copied to clipboard!');
              });
            }

            showToast(message) {
              // Simple toast implementation
              const toast = document.createElement('div');
              toast.textContent = message;
              toast.style.cssText = `
                position: fixed;
                bottom: 80px;
                left: 50%;
                transform: translateX(-50%);
                background: var(--bg-elevated);
                color: var(--text-primary);
                padding: 12px 20px;
                border-radius: var(--radius-pill);
                box-shadow: var(--shadow-lg);
                z-index: 1000;
                animation: slideUp 0.3s ease;
              `;

              document.body.appendChild(toast);

              setTimeout(() => {
                toast.style.animation = 'fadeOut 0.3s ease';
                setTimeout(() => toast.remove(), 300);
              }, 2000);
            }

            updateProgress() {
              let totalMeals = 0;
              let plannedMeals = 0;

              this.currentWeek.forEach(day => {
                totalMeals += 3; // lunch, dinner, side

                const meals = this.meals[day.key];
                if (meals) {
                  if (meals.lunch) plannedMeals++;
                  if (meals.dinner) plannedMeals++;
                  if (meals.side && meals.mode !== 'delivery') plannedMeals++;
                }
              });

              const percentage = (plannedMeals / totalMeals) * 100;

              this.els.progressValue.textContent = `${plannedMeals}/${totalMeals} meals`;
              this.els.progressFill.style.width = `${percentage}%`;

              // Update week strip to show which days have meals
              this.els.daysScroll.querySelectorAll('.day-pill').forEach(pill => {
                const hasMeals = this.dayHasMeals(pill.dataset.day);
                pill.classList.toggle('has-meals', hasMeals);
              });
            }

            // === Data Persistence ===
            saveMeals() {
              localStorage.setItem('mealWeek_meals', JSON.stringify(this.meals));
            }

            loadMeals() {
              const saved = localStorage.getItem('mealWeek_meals');
              return saved ? JSON.parse(saved) : {};
            }

            saveSettings() {
              localStorage.setItem('mealWeek_settings', JSON.stringify(this.settings));
            }

            loadSettings() {
              const saved = localStorage.getItem('mealWeek_settings');
              return saved ? JSON.parse(saved) : {
                weekendEnabled: true,
                notifications: false,
                mealTimes: { lunch: '12:00', dinner: '19:00' }
              };
            }

            // === Utility Functions ===
            getWeekDates() {
              const today = new Date();
              const dayOfWeek = today.getDay();
              const monday = new Date(today);
              monday.setDate(today.getDate() - (dayOfWeek === 0 ? 6 : dayOfWeek - 1));

              const week = [];
              const dayNames = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'];
              const dayShort = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'];

              for (let i = 0; i < 7; i++) {
                const date = new Date(monday);
                date.setDate(monday.getDate() + i);

                week.push({
                  date: date,
                  name: dayNames[i],
                  short: dayShort[i],
                  key: this.getDateKey(date)
                });
              }

              return week;
            }

            getDateKey(date) {
              return `${date.getFullYear()}-${date.getMonth() + 1}-${date.getDate()}`;
            }

            formatDate(date, format) {
              if (format === 'short') {
                return date.toLocaleDateString('en', { month: 'short', day: 'numeric' });
              } else {
                return date.toLocaleDateString('en', { weekday: 'long', month: 'long', day: 'numeric' });
              }
            }

            isToday(date) {
              const today = new Date();
              return date.toDateString() === today.toDateString();
            }

            dayHasMeals(key) {
              const meals = this.meals[key];
              return meals && (meals.lunch || meals.dinner || meals.side);
            }

            calculatePrepTime(meals) {
              let total = 0;

              ['lunch', 'dinner', 'side'].forEach(type => {
                if (meals[type]) {
                  const meal = [...MEALS_DB.lunch, ...MEALS_DB.dinner, ...MEALS_DB.quick, ...MEALS_DB.sides]
                    .find(m => m.name === meals[type]);
                  if (meal) total += meal.prepTime || 0;
                }
              });

              return total;
            }

            getNutritionalScore(meals) {
              // Simplified scoring
              let score = 0;
              if (meals.lunch) score += 30;
              if (meals.dinner) score += 40;
              if (meals.side) score += 30;

              return score >= 70 ? '⭐⭐⭐' : score >= 40 ? '⭐⭐' : '⭐';
            }

            haptic(intensity = 'light') {
              if ('vibrate' in navigator) {
                const patterns = {
                  light: 10,
                  medium: 20,
                  heavy: [20, 10, 20]
                };
                navigator.vibrate(patterns[intensity]);
              }
            }
          }

          // === Initialize App ===
          let app;
          document.addEventListener('DOMContentLoaded', () => {
            app = new MealWeekApp();

            // Add CSS animations
            const style = document.createElement('style');
            style.textContent = `
              @keyframes slideUp {
                from { transform: translate(-50%, 100%); }
                to { transform: translate(-50%, 0); }
              }

              @keyframes fadeOut {
                to { opacity: 0; }
              }
            `;
            document.head.appendChild(style);

            // Service worker for offline support (optional)
            if ('serviceWorker' in navigator) {
              // navigator.serviceWorker.register('/sw.js');
            }
          });
        </script>
      </body>
    </html>
  </artifact>
</artifacts>
