<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generatore di Typoglycemia Italiana</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        h1 {
            text-align: center;
            color: #5a67d8;
            margin-bottom: 10px;
            font-size: 2.5em;
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            font-style: italic;
        }

        .input-section {
            margin-bottom: 30px;
        }

        label {
            display: block;
            font-weight: bold;
            margin-bottom: 10px;
            color: #4a5568;
        }

        textarea {
            width: 100%;
            min-height: 120px;
            padding: 15px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 16px;
            font-family: Georgia, serif;
            line-height: 1.6;
            resize: vertical;
            transition: border-color 0.3s;
        }

        textarea:focus {
            outline: none;
            border-color: #5a67d8;
        }

        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            align-items: center;
            margin: 20px 0;
        }

        button {
            background: linear-gradient(45deg, #5a67d8, #667eea);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(90, 103, 216, 0.3);
        }

        button:active {
            transform: translateY(0);
        }

        .intensity-control {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        input[type="range"] {
            width: 150px;
        }

        .results-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 30px;
        }

        .result-box {
            background: #f7fafc;
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid #5a67d8;
        }

        .result-title {
            font-weight: bold;
            color: #2d3748;
            margin-bottom: 15px;
            font-size: 18px;
        }

        .result-text {
            font-family: Georgia, serif;
            font-size: 16px;
            line-height: 1.8;
            color: #4a5568;
        }

        .stats {
            background: #edf2f7;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .stat-item {
            text-align: center;
            padding: 10px;
            background: white;
            border-radius: 8px;
        }

        .stat-number {
            font-size: 24px;
            font-weight: bold;
            color: #5a67d8;
        }

        .stat-label {
            font-size: 14px;
            color: #666;
        }

        .legend {
            background: #f0f4f8;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            font-size: 14px;
            line-height: 1.6;
        }

        .legend h3 {
            color: #2d3748;
            margin-top: 0;
        }

        @media (max-width: 768px) {
            .results-section {
                grid-template-columns: 1fr;
            }
            
            .controls {
                flex-direction: column;
                align-items: stretch;
            }
            
            h1 {
                font-size: 2em;
            }
        }

        .highlight {
            background-color: #fef9e7;
            padding: 2px 4px;
            border-radius: 3px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß† Generatore di Typoglycemia</h1>
        <p class="subtitle">Trasforma il testo mantenendo la leggibilit√† secondo l'effetto Cambridge</p>
        
        <div class="input-section">
            <label for="inputText">Inserisci il testo da trasformare:</label>
            <textarea 
                id="inputText" 
                placeholder="Inserisci qui il tuo testo italiano... Per esempio: 'La typoglycemia dimostra come il cervello elabora le informazioni linguistiche in modo sorprendente.'"
            >La typoglycemia dimostra come il cervello elabora le informazioni linguistiche in modo sorprendente e intelligente.</textarea>
        </div>
        
        <div class="controls">
            <button onclick="transformText()">üîÄ Trasforma Testo</button>
            <button onclick="copyResult()" id="copyBtn">üìã Copia Risultato</button>
            <button onclick="clearAll()">üóëÔ∏è Pulisci</button>
            
            <div class="intensity-control">
                <label for="intensity">Intensit√†:</label>
                <input type="range" id="intensity" min="1" max="3" value="2">
                <span id="intensityLabel">Media</span>
            </div>
        </div>
        
        <div class="results-section">
            <div class="result-box">
                <div class="result-title">üìù Testo Originale</div>
                <div class="result-text" id="originalResult">Il testo trasformato apparir√† qui...</div>
            </div>
            
            <div class="result-box">
                <div class="result-title">üîÄ Testo Trasformato</div>
                <div class="result-text" id="transformedResult">Il testo trasformato apparir√† qui...</div>
            </div>
        </div>
        
        <div class="stats">
            <h3>üìä Statistiche della Trasformazione</h3>
            <div class="stats-grid">
                <div class="stat-item">
                    <div class="stat-number" id="totalWords">0</div>
                    <div class="stat-label">Parole Totali</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="modifiedWords">0</div>
                    <div class="stat-label">Parole Modificate</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="modificationRate">0%</div>
                    <div class="stat-label">Tasso di Modifica</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="readabilityScore">Alta</div>
                    <div class="stat-label">Leggibilit√† Stimata</div>
                </div>
            </div>
        </div>
        
        <div class="legend">
            <h3>üéØ Regole Applicate</h3>
            <p><strong>‚úÖ Mantenute intatte:</strong> Articoli, preposizioni, pronomi e parole ‚â§3 lettere</p>
            <p><strong>üîí Sempre fisse:</strong> Prima e ultima lettera di ogni parola</p>
            <p><strong>üë• Doppie preservate:</strong> Lettere doppie (ll, tt, ss) rimangono adiacenti</p>
            <p><strong>üéØ Trasposizioni vicine:</strong> Scambi solo tra lettere a distanza 1-2</p>
            <p><strong>üèóÔ∏è Morfemi protetti:</strong> Suffissi comuni (-zione, -mente, -ando) preservati</p>
        </div>
    </div>

    <script>
        // Parole grammaticali che non vengono mai modificate
        const UNTOUCHABLE_WORDS = new Set([
            // Articoli
            'il', 'la', 'lo', 'le', 'gli', 'un', 'una', 'uno',
            // Preposizioni
            'di', 'da', 'in', 'con', 'su', 'per', 'tra', 'fra', 'del', 'della', 'dello', 'delle', 'degli', 'dal', 'dalla', 'dallo', 'dalle', 'dagli', 'nel', 'nella', 'nello', 'nelle', 'negli', 'col', 'coi', 'sul', 'sulla', 'sullo', 'sulle', 'sugli',
            // Pronomi
            'che', 'chi', 'cui', 'si', 'ci', 'vi', 'ne', 'lo', 'la', 'li', 'le', 'mi', 'ti', 'se', 'io', 'tu', 'lui', 'lei', 'noi', 'voi', 'loro',
            // Avverbi comuni brevi
            'non', 'pi√π', 'gi√†', 'qui', 'qua', 's√¨', 'no', 'mai', 'poi', 'cos√¨', 'dove', 'come', 'bene', 'male', 'poco', 'tanto', 'molto', 'tutto', 'ogni',
            // Congiunzioni
            'e', 'o', 'ma', 'se', 'che', 'quando', 'mentre', 'per√≤', 'anche', 'ancora', 'pure',
            // Verbi essere/avere comuni
            '√®', 'ho', 'ha', 'hai', 'sono', 'sei', 'siamo', 'siete', 'hanno'
        ]);

        // Morfemi da preservare
        const PRESERVE_ENDINGS = ['-zione', '-sione', '-mente', '-ando', '-endo', '-abile', '-ibile', '-ante', '-ente', '-oso', '-osa', '-ivo', '-iva'];
        
        // Doppie lettere comuni in italiano
        const DOUBLE_LETTERS = ['bb', 'cc', 'dd', 'ff', 'gg', 'hh', 'll', 'mm', 'nn', 'pp', 'qq', 'rr', 'ss', 'tt', 'vv', 'zz'];

        let stats = {
            totalWords: 0,
            modifiedWords: 0,
            modificationRate: 0,
            readabilityScore: 'Alta'
        };

        function updateIntensityLabel() {
            const intensity = document.getElementById('intensity').value;
            const label = document.getElementById('intensityLabel');
            const labels = ['Bassa', 'Media', 'Alta'];
            label.textContent = labels[intensity - 1];
        }

        function shouldPreserveWord(word) {
            // Parole ‚â§ 3 lettere
            if (word.length <= 3) return true;
            
            // Parole grammaticali
            if (UNTOUCHABLE_WORDS.has(word.toLowerCase())) return true;
            
            // Numeri
            if (/^\d+$/.test(word)) return true;
            
            return false;
        }

        function findDoubleLetters(word) {
            const doubles = [];
            for (let i = 0; i < word.length - 1; i++) {
                if (word[i] === word[i + 1]) {
                    doubles.push(i);
                }
            }
            return doubles;
        }

        function preserveMorphemes(word) {
            // Identifica morfemi da preservare alla fine della parola
            for (let ending of PRESERVE_ENDINGS) {
                if (word.toLowerCase().endsWith(ending.substring(1))) {
                    return ending.length - 1; // Ritorna quante lettere preservare alla fine
                }
            }
            return 0;
        }

        function scrambleWord(word, intensity = 2) {
            if (shouldPreserveWord(word)) {
                return word;
            }

            const len = word.length;
            if (len <= 4) {
                // Per parole di 4 lettere, scambia solo le due centrali
                if (len === 4) {
                    return word[0] + word[2] + word[1] + word[3];
                }
                return word;
            }

            // Trova le doppie lettere
            const doubles = findDoubleLetters(word);
            const morphemePreserve = preserveMorphemes(word);
            
            // Converte in array per manipolazione
            let letters = word.split('');
            let modified = false;

            // Calcola zona modificabile
            const start = 1; // Prima lettera sempre fissa
            const end = len - 1 - morphemePreserve; // Ultima lettera + morfemi fissi

            // Applica trasposizioni in base all'intensit√†
            const maxSwaps = Math.floor((end - start) / 2) * intensity;
            let swapsApplied = 0;

            for (let i = start; i < end - 1 && swapsApplied < maxSwaps; i++) {
                // Salta se fa parte di una doppia
                if (doubles.includes(i) || doubles.includes(i - 1)) continue;

                // Trasposizione con lettera adiacente (distanza 1)
                const swapDistance = intensity === 3 ? Math.min(2, end - i - 1) : 1;
                const targetIndex = i + swapDistance;

                if (targetIndex < end && !doubles.includes(targetIndex) && !doubles.includes(targetIndex - 1)) {
                    // Applica lo scambio con probabilit√† basata su intensit√†
                    const swapProbability = intensity * 0.3; // 30%, 60%, 90%
                    if (Math.random() < swapProbability) {
                        [letters[i], letters[targetIndex]] = [letters[targetIndex], letters[i]];
                        modified = true;
                        swapsApplied++;
                    }
                }
            }

            return modified ? letters.join('') : word;
        }

        function transformText() {
            const inputText = document.getElementById('inputText').value;
            if (!inputText.trim()) {
                alert('Inserisci del testo da trasformare!');
                return;
            }

            const intensity = parseInt(document.getElementById('intensity').value);
            
            // Reset statistiche
            stats = { totalWords: 0, modifiedWords: 0, modificationRate: 0, readabilityScore: 'Alta' };

            // Preserva punteggiatura e spazi
            const words = inputText.match(/\S+/g) || [];
            const transformedWords = [];

            words.forEach(word => {
                // Separa punteggiatura dalla parola
                const match = word.match(/^(\W*)(.*?)(\W*)$/);
                if (match) {
                    const [, prefix, cleanWord, suffix] = match;
                    const transformed = scrambleWord(cleanWord, intensity);
                    transformedWords.push(prefix + transformed + suffix);
                    
                    // Aggiorna statistiche
                    if (cleanWord.length > 0) {
                        stats.totalWords++;
                        if (transformed !== cleanWord && !shouldPreserveWord(cleanWord)) {
                            stats.modifiedWords++;
                        }
                    }
                } else {
                    transformedWords.push(word);
                }
            });

            // Ricostruisce il testo preservando spazi originali
            const transformedText = inputText.replace(/\S+/g, (match, offset) => {
                return transformedWords.shift() || match;
            });

            // Calcola statistiche finali
            stats.modificationRate = stats.totalWords > 0 ? Math.round((stats.modifiedWords / stats.totalWords) * 100) : 0;
            
            // Stima leggibilit√† basata su intensit√† e tasso di modifica
            if (stats.modificationRate < 20) {
                stats.readabilityScore = 'Molto Alta';
            } else if (stats.modificationRate < 40) {
                stats.readabilityScore = 'Alta';
            } else if (stats.modificationRate < 60) {
                stats.readabilityScore = 'Media';
            } else {
                stats.readabilityScore = 'Bassa';
            }

            // Mostra risultati
            document.getElementById('originalResult').textContent = inputText;
            document.getElementById('transformedResult').textContent = transformedText;
            
            // Aggiorna statistiche
            document.getElementById('totalWords').textContent = stats.totalWords;
            document.getElementById('modifiedWords').textContent = stats.modifiedWords;
            document.getElementById('modificationRate').textContent = stats.modificationRate + '%';
            document.getElementById('readabilityScore').textContent = stats.readabilityScore;
        }

        function copyResult() {
            const transformedText = document.getElementById('transformedResult').textContent;
            if (transformedText && transformedText !== 'Il testo trasformato apparir√† qui...') {
                navigator.clipboard.writeText(transformedText).then(() => {
                    const btn = document.getElementById('copyBtn');
                    const originalText = btn.textContent;
                    btn.textContent = '‚úÖ Copiato!';
                    setTimeout(() => {
                        btn.textContent = originalText;
                    }, 2000);
                });
            }
        }

        function clearAll() {
            document.getElementById('inputText').value = '';
            document.getElementById('originalResult').textContent = 'Il testo originale apparir√† qui...';
            document.getElementById('transformedResult').textContent = 'Il testo trasformato apparir√† qui...';
            
            // Reset statistiche
            document.getElementById('totalWords').textContent = '0';
            document.getElementById('modifiedWords').textContent = '0';
            document.getElementById('modificationRate').textContent = '0%';
            document.getElementById('readabilityScore').textContent = 'Alta';
        }

        // Event listeners
        document.getElementById('intensity').addEventListener('input', updateIntensityLabel);
        document.getElementById('inputText').addEventListener('keypress', function(e) {
            if (e.ctrlKey && e.key === 'Enter') {
                transformText();
            }
        });

        // Inizializzazione
        updateIntensityLabel();
    </script>
</body>
</html>
