<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Typoglycemia Generator</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 40px 20px;
            background: #f8fafc;
            color: #2d3748;
        }

        .container {
            background: white;
            border-radius: 12px;
            padding: 40px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }

        h1 {
            text-align: center;
            color: #4a5568;
            margin-bottom: 40px;
            font-weight: 600;
            font-size: 2rem;
        }

        textarea {
            width: 100%;
            min-height: 120px;
            padding: 16px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 16px;
            font-family: Georgia, serif;
            line-height: 1.6;
            resize: vertical;
            box-sizing: border-box;
            margin-bottom: 20px;
            transition: border-color 0.2s;
        }

        textarea:focus {
            outline: none;
            border-color: #4299e1;
        }

        button {
            background: #4299e1;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s;
            margin-right: 12px;
            margin-bottom: 12px;
        }

        button:hover {
            background: #3182ce;
        }

        button:active {
            background: #2c5aa0;
        }

        .copy-btn {
            background: #48bb78;
        }

        .copy-btn:hover {
            background: #38a169;
        }

        .copy-btn.copied {
            background: #68d391;
        }

        .output {
            background: #f7fafc;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #4299e1;
            font-family: Georgia, serif;
            font-size: 16px;
            line-height: 1.7;
            color: #4a5568;
            min-height: 60px;
            margin-top: 20px;
            white-space: pre-wrap;
        }

        .placeholder {
            color: #a0aec0;
            font-style: italic;
        }

        @media (max-width: 600px) {
            .container {
                padding: 20px;
            }
            
            h1 {
                font-size: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Typoglycemia Generator</h1>
        
        <textarea 
            id="inputText" 
            placeholder="Inserisci qui il tuo testo..."
            autofocus
        >La typoglycemia dimostra come il cervello elabora le informazioni linguistiche in modo sorprendente.</textarea>
        
        <div>
            <button onclick="transformText()">Trasforma</button>
            <button class="copy-btn" onclick="copyResult()" id="copyBtn">Copia</button>
        </div>
        
        <div class="output" id="output">
            <span class="placeholder">Il testo trasformato apparirà qui...</span>
        </div>
    </div>

    <script>
        // Parole grammaticali che non vengono mai modificate
        const UNTOUCHABLE_WORDS = new Set([
            'il', 'la', 'lo', 'le', 'gli', 'un', 'una', 'uno',
            'di', 'da', 'in', 'con', 'su', 'per', 'tra', 'fra', 'del', 'della', 'dello', 'delle', 'degli', 'dal', 'dalla', 'dallo', 'dalle', 'dagli', 'nel', 'nella', 'nello', 'nelle', 'negli', 'col', 'coi', 'sul', 'sulla', 'sullo', 'sulle', 'sugli',
            'che', 'chi', 'cui', 'si', 'ci', 'vi', 'ne', 'lo', 'la', 'li', 'le', 'mi', 'ti', 'se', 'io', 'tu', 'lui', 'lei', 'noi', 'voi', 'loro',
            'non', 'più', 'già', 'qui', 'qua', 'sì', 'no', 'mai', 'poi', 'così', 'dove', 'come', 'bene', 'male', 'poco', 'tanto', 'molto', 'tutto', 'ogni',
            'e', 'o', 'ma', 'se', 'che', 'quando', 'mentre', 'però', 'anche', 'ancora', 'pure',
            'è', 'ho', 'ha', 'hai', 'sono', 'sei', 'siamo', 'siete', 'hanno'
        ]);

        function shouldPreserveWord(word) {
            if (word.length <= 3) return true;
            if (UNTOUCHABLE_WORDS.has(word.toLowerCase())) return true;
            if (/^\d+$/.test(word)) return true;
            return false;
        }

        function findDoubleLetters(word) {
            const doubles = [];
            for (let i = 0; i < word.length - 1; i++) {
                if (word[i] === word[i + 1]) {
                    doubles.push(i);
                }
            }
            return doubles;
        }

        function scrambleWord(word) {
            if (shouldPreserveWord(word)) {
                return word;
            }

            const len = word.length;
            if (len <= 4) {
                if (len === 4) {
                    return word[0] + word[2] + word[1] + word[3];
                }
                return word;
            }

            const doubles = findDoubleLetters(word);
            let letters = word.split('');
            let modified = false;

            const start = 1;
            const end = len - 1;

            for (let i = start; i < end - 1; i++) {
                if (doubles.includes(i) || doubles.includes(i - 1)) continue;

                const targetIndex = i + 1;
                if (targetIndex < end && !doubles.includes(targetIndex) && !doubles.includes(targetIndex - 1)) {
                    if (Math.random() < 0.6) {
                        [letters[i], letters[targetIndex]] = [letters[targetIndex], letters[i]];
                        modified = true;
                    }
                }
            }

            return modified ? letters.join('') : word;
        }

        function transformText() {
            const inputText = document.getElementById('inputText').value;
            if (!inputText.trim()) return;

            const words = inputText.match(/\S+/g) || [];
            const transformedWords = [];

            words.forEach(word => {
                const match = word.match(/^(\W*)(.*?)(\W*)$/);
                if (match) {
                    const [, prefix, cleanWord, suffix] = match;
                    const transformed = scrambleWord(cleanWord);
                    transformedWords.push(prefix + transformed + suffix);
                } else {
                    transformedWords.push(word);
                }
            });

            const transformedText = inputText.replace(/\S+/g, (match, offset) => {
                return transformedWords.shift() || match;
            });

            const output = document.getElementById('output');
            output.innerHTML = transformedText;
            output.classList.remove('placeholder');
        }

        function copyResult() {
            const output = document.getElementById('output');
            const text = output.textContent;
            
            if (text && !text.includes('apparirà qui')) {
                navigator.clipboard.writeText(text).then(() => {
                    const btn = document.getElementById('copyBtn');
                    btn.textContent = '✓ Copiato';
                    btn.classList.add('copied');
                    
                    setTimeout(() => {
                        btn.textContent = 'Copia';
                        btn.classList.remove('copied');
                    }, 2000);
                });
            }
        }

        // Enter per trasformare
        document.getElementById('inputText').addEventListener('keypress', function(e) {
            if (e.ctrlKey && e.key === 'Enter') {
                transformText();
            }
        });
    </script>
</body>
</html>
